<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🚀 WebMaster Pro - Ultimate Visual Editor</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #0f0f0f 0%, #1a1a1a 100%);
            color: #ffffff;
            overflow: hidden;
            height: 100vh;
        }

        /* Header */
        .editor-header {
            height: 60px;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            position: relative;
            z-index: 1000;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 18px;
            font-weight: 700;
            color: #ffffff;
        }

        .logo i {
            color: #00d4ff;
            font-size: 20px;
        }

        .header-tools {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .tool-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #ffffff;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .tool-btn:hover {
            background: rgba(0, 212, 255, 0.2);
            border-color: rgba(0, 212, 255, 0.4);
            transform: translateY(-1px);
        }

        .tool-btn.active {
            background: rgba(0, 212, 255, 0.3);
            border-color: rgba(0, 212, 255, 0.6);
        }

        /* Main Layout */
        .editor-container {
            display: flex;
            height: calc(100vh - 60px);
            position: relative;
        }

        /* Left Panel */
        .left-panel {
            width: 280px;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(20px);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            overflow-y: auto;
            transition: transform 0.3s ease;
        }

        .panel-section {
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            padding: 20px;
        }

        .section-title {
            font-size: 14px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .website-selector {
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #ffffff;
            padding: 10px;
            border-radius: 8px;
            font-size: 14px;
            margin-bottom: 15px;
        }

        .component-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .component-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 15px 10px;
            text-align: center;
            cursor: grab;
            transition: all 0.3s ease;
            font-size: 12px;
        }

        .component-item:hover {
            background: rgba(0, 212, 255, 0.1);
            border-color: rgba(0, 212, 255, 0.3);
            transform: translateY(-2px);
        }

        .component-item:active {
            cursor: grabbing;
            transform: scale(0.95);
        }

        .component-item i {
            font-size: 20px;
            margin-bottom: 8px;
            color: #00d4ff;
            display: block;
        }

        /* Main Editor Area */
        .main-editor {
            flex: 1;
            background: rgba(0, 0, 0, 0.3);
            position: relative;
            display: flex;
            flex-direction: column;
        }

        .editor-toolbar {
            height: 50px;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
        }

        .view-toggle {
            display: flex;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            overflow: hidden;
        }

        .view-btn {
            background: transparent;
            border: none;
            color: rgba(255, 255, 255, 0.7);
            padding: 8px 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 12px;
        }

        .view-btn.active {
            background: rgba(0, 212, 255, 0.3);
            color: #ffffff;
        }

        .editor-canvas {
            flex: 1;
            background: #ffffff;
            margin: 20px;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            position: relative;
        }

        .editor-iframe {
            width: 100%;
            height: 100%;
            border: none;
            background: #ffffff;
        }

        /* Right Panel */
        .right-panel {
            width: 300px;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(20px);
            border-left: 1px solid rgba(255, 255, 255, 0.1);
            overflow-y: auto;
            transition: transform 0.3s ease;
        }

        .settings-group {
            margin-bottom: 20px;
        }

        .settings-label {
            font-size: 12px;
            font-weight: 500;
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 8px;
            display: block;
        }

        .settings-input {
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #ffffff;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 14px;
        }

        .settings-input:focus {
            outline: none;
            border-color: rgba(0, 212, 255, 0.6);
            background: rgba(255, 255, 255, 0.15);
        }

        .color-picker {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .color-option {
            width: 30px;
            height: 30px;
            border-radius: 6px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .color-option:hover {
            transform: scale(1.1);
            border-color: rgba(255, 255, 255, 0.5);
        }

        .color-option.active {
            border-color: #ffffff;
            box-shadow: 0 0 0 2px rgba(0, 212, 255, 0.5);
        }

        /* AI Assistant */
        .ai-assistant {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #00d4ff, #ff6b6b);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(0, 212, 255, 0.3);
            z-index: 1000;
            transition: all 0.3s ease;
        }

        .ai-assistant:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 30px rgba(0, 212, 255, 0.5);
        }

        .ai-assistant i {
            font-size: 24px;
            color: #ffffff;
        }

        .ai-chat {
            position: fixed;
            bottom: 100px;
            right: 20px;
            width: 350px;
            height: 400px;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            display: none;
            flex-direction: column;
            z-index: 999;
            overflow: hidden;
        }

        .ai-chat.show {
            display: flex;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .ai-header {
            padding: 15px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .ai-header h3 {
            font-size: 16px;
            font-weight: 600;
        }

        .ai-close {
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            font-size: 18px;
        }

        .ai-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .ai-message {
            background: rgba(0, 212, 255, 0.1);
            border: 1px solid rgba(0, 212, 255, 0.2);
            border-radius: 12px;
            padding: 12px 16px;
            margin-bottom: 10px;
            font-size: 14px;
            line-height: 1.5;
        }

        .ai-input {
            padding: 15px 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .ai-input input {
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #ffffff;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 14px;
        }

        .ai-input input:focus {
            outline: none;
            border-color: rgba(0, 212, 255, 0.6);
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .left-panel {
                width: 250px;
            }
            .right-panel {
                width: 250px;
            }
        }

        @media (max-width: 768px) {
            .left-panel,
            .right-panel {
                position: absolute;
                top: 0;
                height: 100%;
                z-index: 100;
                transform: translateX(-100%);
            }

            .right-panel {
                right: 0;
                transform: translateX(100%);
            }

            .left-panel.show,
            .right-panel.show {
                transform: translateX(0);
            }

            .ai-chat {
                width: calc(100% - 40px);
                right: 20px;
                left: 20px;
            }
        }

        /* Loading Animation */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            flex-direction: column;
            gap: 20px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top: 3px solid #00d4ff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Success/Error Messages */
        .toast {
            position: fixed;
            top: 80px;
            right: 20px;
            background: rgba(0, 212, 255, 0.9);
            color: #ffffff;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 14px;
            z-index: 1001;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.error {
            background: rgba(244, 67, 54, 0.9);
        }

        .toast.success {
            background: rgba(76, 175, 80, 0.9);
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="editor-header">
        <div class="logo">
            <i class="fas fa-magic"></i>
            WebMaster Pro - Ultimate Editor
        </div>
        
        <div class="header-tools">
            <button class="tool-btn" onclick="togglePanel('left')">
                <i class="fas fa-cube"></i>
                רכיבים
            </button>
            <button class="tool-btn" onclick="saveWebsite()">
                <i class="fas fa-save"></i>
                שמירה
            </button>
            <button class="tool-btn" onclick="previewWebsite()">
                <i class="fas fa-eye"></i>
                תצוגה מקדימה
            </button>
            <button class="tool-btn" onclick="exportWebsite()">
                <i class="fas fa-download"></i>
                ייצוא
            </button>
            <button class="tool-btn" onclick="toggleTheme()">
                <i class="fas fa-moon"></i>
                מצב כהה
            </button>
            <button class="tool-btn" onclick="togglePanel('right')">
                <i class="fas fa-cog"></i>
                הגדרות
            </button>
        </div>
    </div>

    <!-- Main Container -->
    <div class="editor-container">
        <!-- Left Panel - Components -->
        <div class="left-panel" id="leftPanel">
            <!-- Website Selector -->
            <div class="panel-section">
                <div class="section-title">
                    <i class="fas fa-globe"></i>
                    בחירת אתר לעריכה
                </div>
                <select class="website-selector" id="websiteSelector" onchange="loadWebsite()">
                    <option value="">בחר אתר לעריכה...</option>
                    <option value="dr-michal-rosen">ד"ר מיכל רוזן - רפואה אסתטית (₪2,800)</option>
                    <option value="fitness-co">דני פיט - מאמן כושר (₪2,200)</option>
                    <option value="yoga-studio">סטודיו אוהם - יוגה (₪1,900)</option>
                    <option value="nutritionist">ד"ר שרה כהן - תזונאית (₪2,400)</option>
                    <option value="law-firm">משרד ברקוביץ - עו"ד (₪2,500)</option>
                    <option value="accountant">רינה לוי - חשבת (₪2,000)</option>
                    <option value="beauty-salon">מספרה BELLA - יופי (₪1,700)</option>
                    <option value="tutor">ד"ר רונית לוי - מורה (₪2,100)</option>
                    <option value="aesthetic-clinic">קליניקת יופי פרמיום (₪3,200)</option>
                    <option value="multibrawn">מולטיבראון - נופש (₪2,300)</option>
                    <option value="real-estate">נדל"ן פרמיום (₪2,700)</option>
                </select>
            </div>

            <!-- Basic Components -->
            <div class="panel-section">
                <div class="section-title">
                    <i class="fas fa-cube"></i>
                    רכיבים בסיסיים
                </div>
                <div class="component-grid">
                    <div class="component-item" draggable="true" data-component="text">
                        <i class="fas fa-font"></i>
                        טקסט
                    </div>
                    <div class="component-item" draggable="true" data-component="heading">
                        <i class="fas fa-heading"></i>
                        כותרת
                    </div>
                    <div class="component-item" draggable="true" data-component="image">
                        <i class="fas fa-image"></i>
                        תמונה
                    </div>
                    <div class="component-item" draggable="true" data-component="button">
                        <i class="fas fa-mouse-pointer"></i>
                        כפתור
                    </div>
                    <div class="component-item" draggable="true" data-component="video">
                        <i class="fas fa-video"></i>
                        וידאו
                    </div>
                    <div class="component-item" draggable="true" data-component="gallery">
                        <i class="fas fa-images"></i>
                        גלריה
                    </div>
                </div>
            </div>

            <!-- Advanced Components -->
            <div class="panel-section">
                <div class="section-title">
                    <i class="fas fa-puzzle-piece"></i>
                    רכיבים מתקדמים
                </div>
                <div class="component-grid">
                    <div class="component-item" draggable="true" data-component="services">
                        <i class="fas fa-concierge-bell"></i>
                        שירותים
                    </div>
                    <div class="component-item" draggable="true" data-component="testimonials">
                        <i class="fas fa-quote-left"></i>
                        המלצות
                    </div>
                    <div class="component-item" draggable="true" data-component="faq">
                        <i class="fas fa-question-circle"></i>
                        שאלות נפוצות
                    </div>
                    <div class="component-item" draggable="true" data-component="contact">
                        <i class="fas fa-envelope"></i>
                        טופס יצירת קשר
                    </div>
                    <div class="component-item" draggable="true" data-component="stats">
                        <i class="fas fa-chart-bar"></i>
                        סטטיסטיקות
                    </div>
                    <div class="component-item" draggable="true" data-component="blog">
                        <i class="fas fa-blog"></i>
                        בלוג
                    </div>
                </div>
            </div>

            <!-- AI Tools -->
            <div class="panel-section">
                <div class="section-title">
                    <i class="fas fa-robot"></i>
                    כלי AI
                </div>
                <button class="tool-btn" onclick="generateContent()" style="width: 100%; margin-bottom: 10px;">
                    <i class="fas fa-magic"></i>
                    יצירת תוכן AI
                </button>
                <button class="tool-btn" onclick="optimizeSEO()" style="width: 100%; margin-bottom: 10px;">
                    <i class="fas fa-search"></i>
                    אופטימיזציה SEO
                </button>
                <button class="tool-btn" onclick="suggestDesign()" style="width: 100%;">
                    <i class="fas fa-palette"></i>
                    הצעות עיצוב
                </button>
            </div>
        </div>

        <!-- Main Editor Area -->
        <div class="main-editor">
            <!-- Editor Toolbar -->
            <div class="editor-toolbar">
                <div class="view-toggle">
                    <button class="view-btn active" onclick="setView('desktop')">
                        <i class="fas fa-desktop"></i>
                        דסקטופ
                    </button>
                    <button class="view-btn" onclick="setView('tablet')">
                        <i class="fas fa-tablet-alt"></i>
                        טאבלט
                    </button>
                    <button class="view-btn" onclick="setView('mobile')">
                        <i class="fas fa-mobile-alt"></i>
                        מובייל
                    </button>
                </div>
                
                <div class="header-tools">
                    <button class="tool-btn" onclick="undoAction()">
                        <i class="fas fa-undo"></i>
                    </button>
                    <button class="tool-btn" onclick="redoAction()">
                        <i class="fas fa-redo"></i>
                    </button>
                    <button class="tool-btn" onclick="toggleRuler()">
                        <i class="fas fa-ruler"></i>
                    </button>
                </div>
            </div>

            <!-- Editor Canvas -->
            <div class="editor-canvas" id="editorCanvas">
                <div class="loading">
                    <div class="spinner"></div>
                    <p>טוען אדיטור...</p>
                </div>
                <iframe id="websiteFrame" class="editor-iframe" style="display: none;"></iframe>
            </div>
        </div>

        <!-- Right Panel - Settings -->
        <div class="right-panel" id="rightPanel">
            <!-- Element Settings -->
            <div class="panel-section">
                <div class="section-title">
                    <i class="fas fa-cog"></i>
                    הגדרות אלמנט
                </div>
                
                <div class="settings-group">
                    <label class="settings-label">טקסט</label>
                    <input type="text" class="settings-input" id="elementText" placeholder="הכנס טקסט...">
                </div>
                
                <div class="settings-group">
                    <label class="settings-label">גודל פונט</label>
                    <input type="range" class="settings-input" id="fontSize" min="12" max="72" value="16">
                </div>
                
                <div class="settings-group">
                    <label class="settings-label">צבע טקסט</label>
                    <div class="color-picker">
                        <div class="color-option" style="background: #000000" data-color="#000000"></div>
                        <div class="color-option" style="background: #ffffff" data-color="#ffffff"></div>
                        <div class="color-option" style="background: #00d4ff" data-color="#00d4ff"></div>
                        <div class="color-option" style="background: #ff6b6b" data-color="#ff6b6b"></div>
                        <div class="color-option" style="background: #4ecdc4" data-color="#4ecdc4"></div>
                        <div class="color-option" style="background: #45b7d1" data-color="#45b7d1"></div>
                        <div class="color-option" style="background: #f39c12" data-color="#f39c12"></div>
                        <div class="color-option" style="background: #e74c3c" data-color="#e74c3c"></div>
                    </div>
                </div>
                
                <div class="settings-group">
                    <label class="settings-label">צבע רקע</label>
                    <div class="color-picker">
                        <div class="color-option" style="background: transparent; border: 1px solid #ccc" data-bg="transparent"></div>
                        <div class="color-option" style="background: #ffffff" data-bg="#ffffff"></div>
                        <div class="color-option" style="background: #f8f9fa" data-bg="#f8f9fa"></div>
                        <div class="color-option" style="background: #e9ecef" data-bg="#e9ecef"></div>
                        <div class="color-option" style="background: #00d4ff" data-bg="#00d4ff"></div>
                        <div class="color-option" style="background: #ff6b6b" data-bg="#ff6b6b"></div>
                        <div class="color-option" style="background: #4ecdc4" data-bg="#4ecdc4"></div>
                        <div class="color-option" style="background: #2c3e50" data-bg="#2c3e50"></div>
                    </div>
                </div>
            </div>

            <!-- Layout Settings -->
            <div class="panel-section">
                <div class="section-title">
                    <i class="fas fa-th"></i>
                    הגדרות פריסה
                </div>
                
                <div class="settings-group">
                    <label class="settings-label">רוחב</label>
                    <input type="text" class="settings-input" id="elementWidth" placeholder="auto">
                </div>
                
                <div class="settings-group">
                    <label class="settings-label">גובה</label>
                    <input type="text" class="settings-input" id="elementHeight" placeholder="auto">
                </div>
                
                <div class="settings-group">
                    <label class="settings-label">מרווח פנימי</label>
                    <input type="range" class="settings-input" id="elementPadding" min="0" max="50" value="10">
                </div>
                
                <div class="settings-group">
                    <label class="settings-label">מרווח חיצוני</label>
                    <input type="range" class="settings-input" id="elementMargin" min="0" max="50" value="0">
                </div>
            </div>

            <!-- Advanced Settings -->
            <div class="panel-section">
                <div class="section-title">
                    <i class="fas fa-sliders-h"></i>
                    הגדרות מתקדמות
                </div>
                
                <div class="settings-group">
                    <label class="settings-label">עיגול פינות</label>
                    <input type="range" class="settings-input" id="borderRadius" min="0" max="30" value="0">
                </div>
                
                <div class="settings-group">
                    <label class="settings-label">שקיפות</label>
                    <input type="range" class="settings-input" id="opacity" min="0" max="100" value="100">
                </div>
                
                <div class="settings-group">
                    <label class="settings-label">צל</label>
                    <input type="range" class="settings-input" id="boxShadow" min="0" max="20" value="0">
                </div>
            </div>

            <!-- Integrations -->
            <div class="panel-section">
                <div class="section-title">
                    <i class="fas fa-plug"></i>
                    אינטגרציות
                </div>
                
                <button class="tool-btn" onclick="setupAnalytics()" style="width: 100%; margin-bottom: 10px;">
                    <i class="fab fa-google"></i>
                    Google Analytics
                </button>
                <button class="tool-btn" onclick="setupSocial()" style="width: 100%; margin-bottom: 10px;">
                    <i class="fas fa-share-alt"></i>
                    רשתות חברתיות
                </button>
                <button class="tool-btn" onclick="setupSEO()" style="width: 100%;">
                    <i class="fas fa-search"></i>
                    כלי SEO
                </button>
            </div>
        </div>
    </div>

    <!-- AI Assistant -->
    <div class="ai-assistant" onclick="toggleAI()">
        <i class="fas fa-robot"></i>
    </div>

    <!-- AI Chat -->
    <div class="ai-chat" id="aiChat">
        <div class="ai-header">
            <h3>🤖 AI Assistant</h3>
            <button class="ai-close" onclick="toggleAI()">×</button>
        </div>
        <div class="ai-messages" id="aiMessages">
            <div class="ai-message">
                שלום! אני כאן לעזור לך לעצב את האתר. איך אוכל לעזור?
            </div>
        </div>
        <div class="ai-input">
            <input type="text" placeholder="שאל אותי כל שאלה..." onkeypress="handleAIInput(event)">
        </div>
    </div>

    <script>
        // Global Variables
        let currentWebsite = '';
        let selectedElement = null;
        let editorHistory = [];
        let historyIndex = -1;
        let currentView = 'desktop';
        let isDarkMode = true;

        // Website Data
        const websites = {
            'dr-michal-rosen': {
                name: 'ד"ר מיכל רוזן - רפואה אסתטית',
                url: './websites/dr-michal-rosen.html',
                price: '₪2,800'
            },
            'fitness-co': {
                name: 'דני פיט - מאמן כושר',
                url: './websites/fitness-co.html',
                price: '₪2,200'
            },
            'yoga-studio': {
                name: 'סטודיו אוהם - יוגה',
                url: './websites/yoga-studio.html',
                price: '₪1,900'
            },
            'nutritionist': {
                name: 'ד"ר שרה כהן - תזונאית',
                url: './websites/nutritionist.html',
                price: '₪2,400'
            },
            'law-firm': {
                name: 'משרד ברקוביץ - עו"ד',
                url: './websites/law-firm.html',
                price: '₪2,500'
            },
            'accountant': {
                name: 'רינה לוי - חשבת שכר',
                url: './websites/accountant.html',
                price: '₪2,000'
            },
            'beauty-salon': {
                name: 'מספרה BELLA - יופי',
                url: './websites/beauty-salon.html',
                price: '₪1,700'
            },
            'tutor': {
                name: 'ד"ר רונית לוי - מורה פרטית',
                url: './websites/tutor.html',
                price: '₪2,100'
            },
            'aesthetic-clinic': {
                name: 'קליניקת יופי פרמיום',
                url: './websites/aesthetic-clinic.html',
                price: '₪3,200'
            },
            'multibrawn': {
                name: 'מולטיבראון - נופש ואירועים',
                url: './websites/multibrawn.html',
                price: '₪2,300'
            },
            'real-estate': {
                name: 'נדל"ן פרמיום',
                url: './websites/real-estate.html',
                price: '₪2,700'
            }
        };

        // Initialize Editor
        document.addEventListener('DOMContentLoaded', function() {
            initializeEditor();
            setupEventListeners();
            showToast('success', 'WebMaster Pro Editor נטען בהצלחה! 🚀');
        });

        function initializeEditor() {
            console.log('🚀 Initializing WebMaster Pro Ultimate Editor...');
            
            // Setup drag and drop
            setupDragAndDrop();
            
            // Setup keyboard shortcuts
            setupKeyboardShortcuts();
            
            // Load saved state
            loadEditorState();
            
            console.log('✅ Editor initialized successfully!');
        }

        function setupEventListeners() {
            // Color picker events
            document.querySelectorAll('.color-option').forEach(option => {
                option.addEventListener('click', function() {
                    const color = this.dataset.color || this.dataset.bg;
                    const isBackground = this.dataset.bg !== undefined;
                    applyColorToSelected(color, isBackground);
                });
            });

            // Settings inputs
            document.getElementById('elementText').addEventListener('input', function() {
                if (selectedElement) {
                    updateElementText(selectedElement, this.value);
                }
            });

            document.getElementById('fontSize').addEventListener('input', function() {
                if (selectedElement) {
                    updateElementStyle(selectedElement, 'fontSize', this.value + 'px');
                }
            });

            document.getElementById('elementPadding').addEventListener('input', function() {
                if (selectedElement) {
                    updateElementStyle(selectedElement, 'padding', this.value + 'px');
                }
            });

            document.getElementById('elementMargin').addEventListener('input', function() {
                if (selectedElement) {
                    updateElementStyle(selectedElement, 'margin', this.value + 'px');
                }
            });

            document.getElementById('borderRadius').addEventListener('input', function() {
                if (selectedElement) {
                    updateElementStyle(selectedElement, 'borderRadius', this.value + 'px');
                }
            });

            document.getElementById('opacity').addEventListener('input', function() {
                if (selectedElement) {
                    updateElementStyle(selectedElement, 'opacity', this.value / 100);
                }
            });

            document.getElementById('boxShadow').addEventListener('input', function() {
                if (selectedElement) {
                    updateElementStyle(selectedElement, 'boxShadow', `0 ${this.value}px ${this.value * 2}px rgba(0,0,0,0.1)`);
                }
            });
        }

        function loadWebsite() {
            const selector = document.getElementById('websiteSelector');
            const websiteId = selector.value;
            
            if (!websiteId) return;
            
            currentWebsite = websiteId;
            const website = websites[websiteId];
            
            showToast('info', `טוען ${website.name}...`);
            
            const iframe = document.getElementById('websiteFrame');
            const loading = document.querySelector('.loading');
            
            // Show loading
            iframe.style.display = 'none';
            loading.style.display = 'flex';
            
            // Load website
            iframe.onload = function() {
                setTimeout(() => {
                    loading.style.display = 'none';
                    iframe.style.display = 'block';
                    setupIframeEditor();
                    showToast('success', `${website.name} נטען בהצלחה!`);
                }, 1000);
            };
            
            iframe.src = website.url;
        }

        function setupIframeEditor() {
            const iframe = document.getElementById('websiteFrame');
            const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
            
            // Make elements editable
            const editableElements = iframeDoc.querySelectorAll('h1, h2, h3, p, button, a, span, div');
            
            editableElements.forEach(element => {
                element.style.cursor = 'pointer';
                element.style.outline = '2px solid transparent';
                element.style.transition = 'outline 0.3s ease';
                
                element.addEventListener('click', function(e) {
                    e.preventDefault();
                    selectElement(this);
                });
                
                element.addEventListener('mouseenter', function() {
                    if (this !== selectedElement) {
                        this.style.outline = '2px solid rgba(0, 212, 255, 0.5)';
                    }
                });
                
                element.addEventListener('mouseleave', function() {
                    if (this !== selectedElement) {
                        this.style.outline = 'none';
                    }
                });
            });
        }

        function selectElement(element) {
            // Remove previous selection
            if (selectedElement) {
                selectedElement.style.outline = 'none';
            }
            
            selectedElement = element;
            element.style.outline = '2px solid #00d4ff';
            
            // Update settings panel
            updateSettingsPanel(element);
            
            showToast('info', 'אלמנט נבחר לעריכה');
        }

        function updateSettingsPanel(element) {
            // Update text input
            const textInput = document.getElementById('elementText');
            textInput.value = element.textContent || '';
            
            // Update font size
            const fontSize = window.getComputedStyle(element).fontSize;
            document.getElementById('fontSize').value = parseInt(fontSize);
            
            // Update other properties
            const padding = window.getComputedStyle(element).padding;
            document.getElementById('elementPadding').value = parseInt(padding) || 0;
            
            const margin = window.getComputedStyle(element).margin;
            document.getElementById('elementMargin').value = parseInt(margin) || 0;
            
            const borderRadius = window.getComputedStyle(element).borderRadius;
            document.getElementById('borderRadius').value = parseInt(borderRadius) || 0;
            
            const opacity = window.getComputedStyle(element).opacity;
            document.getElementById('opacity').value = (parseFloat(opacity) * 100) || 100;
        }

        function updateElementText(element, text) {
            element.textContent = text;
            saveToHistory();
        }

        function updateElementStyle(element, property, value) {
            element.style[property] = value;
            saveToHistory();
        }

        function applyColorToSelected(color, isBackground = false) {
            if (!selectedElement) {
                showToast('error', 'אנא בחר אלמנט לעריכה');
                return;
            }
            
            if (isBackground) {
                selectedElement.style.backgroundColor = color;
            } else {
                selectedElement.style.color = color;
            }
            
            saveToHistory();
            showToast('success', 'צבע עודכן בהצלחה');
        }

        function setView(view) {
            currentView = view;
            
            // Update active button
            document.querySelectorAll('.view-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            const canvas = document.getElementById('editorCanvas');
            
            switch(view) {
                case 'mobile':
                    canvas.style.maxWidth = '375px';
                    canvas.style.margin = '20px auto';
                    break;
                case 'tablet':
                    canvas.style.maxWidth = '768px';
                    canvas.style.margin = '20px auto';
                    break;
                default:
                    canvas.style.maxWidth = 'none';
                    canvas.style.margin = '20px';
            }
            
            showToast('info', `עבר לתצוגת ${view}`);
        }

        function togglePanel(side) {
            const panel = document.getElementById(side + 'Panel');
            panel.classList.toggle('show');
        }

        function saveWebsite() {
            if (!currentWebsite) {
                showToast('error', 'אין אתר טעון לשמירה');
                return;
            }
            
            showToast('info', 'שומר אתר...');
            
            // Simulate save
            setTimeout(() => {
                showToast('success', 'האתר נשמר בהצלחה!');
                saveToHistory();
            }, 1500);
        }

        function previewWebsite() {
            if (!currentWebsite) {
                showToast('error', 'אין אתר טעון לתצוגה מקדימה');
                return;
            }
            
            const iframe = document.getElementById('websiteFrame');
            window.open(iframe.src, '_blank');
        }

        function exportWebsite() {
            if (!currentWebsite) {
                showToast('error', 'אין אתר טעון לייצוא');
                return;
            }
            
            showToast('info', 'מכין קבצים לייצוא...');
            
            // Simulate export
            setTimeout(() => {
                const link = document.createElement('a');
                link.download = `${currentWebsite}-export.html`;
                link.href = '#'; // Would be actual HTML content
                link.click();
                
                showToast('success', 'הייצוא הושלם!');
            }, 2000);
        }

        function toggleTheme() {
            isDarkMode = !isDarkMode;
            document.body.classList.toggle('light-mode', !isDarkMode);
            
            const btn = event.target.closest('.tool-btn');
            const icon = btn.querySelector('i');
            icon.className = isDarkMode ? 'fas fa-moon' : 'fas fa-sun';
            
            showToast('success', `עבר למצב ${isDarkMode ? 'כהה' : 'בהיר'}`);
        }

        function setupDragAndDrop() {
            const components = document.querySelectorAll('.component-item');
            const canvas = document.getElementById('editorCanvas');
            
            components.forEach(component => {
                component.addEventListener('dragstart', function(e) {
                    e.dataTransfer.setData('text/plain', this.dataset.component);
                });
            });
            
            canvas.addEventListener('dragover', function(e) {
                e.preventDefault();
            });
            
            canvas.addEventListener('drop', function(e) {
                e.preventDefault();
                const componentType = e.dataTransfer.getData('text/plain');
                addComponent(componentType, e.clientX, e.clientY);
            });
        }

        function addComponent(type, x, y) {
            showToast('info', `מוסיף רכיב: ${type}`);
            
            // This would add the actual component to the iframe
            // For now, just show a message
            setTimeout(() => {
                showToast('success', 'רכיב נוסף בהצלחה!');
                saveToHistory();
            }, 500);
        }

        function setupKeyboardShortcuts() {
            document.addEventListener('keydown', function(e) {
                if (e.ctrlKey || e.metaKey) {
                    switch(e.key) {
                        case 's':
                            e.preventDefault();
                            saveWebsite();
                            break;
                        case 'z':
                            e.preventDefault();
                            undoAction();
                            break;
                        case 'y':
                            e.preventDefault();
                            redoAction();
                            break;
                    }
                }
            });
        }

        function saveToHistory() {
            const iframe = document.getElementById('websiteFrame');
            if (iframe.contentDocument) {
                const state = iframe.contentDocument.body.innerHTML;
                editorHistory = editorHistory.slice(0, historyIndex + 1);
                editorHistory.push(state);
                historyIndex++;
                
                // Limit history size
                if (editorHistory.length > 50) {
                    editorHistory.shift();
                    historyIndex--;
                }
            }
        }

        function undoAction() {
            if (historyIndex > 0) {
                historyIndex--;
                const iframe = document.getElementById('websiteFrame');
                if (iframe.contentDocument) {
                    iframe.contentDocument.body.innerHTML = editorHistory[historyIndex];
                    setupIframeEditor();
                    showToast('info', 'פעולה בוטלה');
                }
            }
        }

        function redoAction() {
            if (historyIndex < editorHistory.length - 1) {
                historyIndex++;
                const iframe = document.getElementById('websiteFrame');
                if (iframe.contentDocument) {
                    iframe.contentDocument.body.innerHTML = editorHistory[historyIndex];
                    setupIframeEditor();
                    showToast('info', 'פעולה שוחזרה');
                }
            }
        }

        function loadEditorState() {
            const savedState = localStorage.getItem('webmaster-editor-state');
            if (savedState) {
                const state = JSON.parse(savedState);
                currentWebsite = state.currentWebsite;
                document.getElementById('websiteSelector').value = currentWebsite;
                if (currentWebsite) {
                    loadWebsite();
                }
            }
        }

        function saveEditorState() {
            const state = {
                currentWebsite: currentWebsite,
                isDarkMode: isDarkMode,
                currentView: currentView
            };
            localStorage.setItem('webmaster-editor-state', JSON.stringify(state));
        }

        // AI Functions
        function toggleAI() {
            const aiChat = document.getElementById('aiChat');
            aiChat.classList.toggle('show');
        }

        function handleAIInput(event) {
            if (event.key === 'Enter') {
                const input = event.target;
                const message = input.value.trim();
                
                if (message) {
                    addAIMessage('user', message);
                    input.value = '';
                    
                    // Simulate AI response
                    setTimeout(() => {
                        const response = generateAIResponse(message);
                        addAIMessage('ai', response);
                    }, 1000);
                }
            }
        }

        function addAIMessage(type, message) {
            const messagesContainer = document.getElementById('aiMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'ai-message';
            messageDiv.style.background = type === 'user' ? 'rgba(0, 212, 255, 0.2)' : 'rgba(0, 212, 255, 0.1)';
            messageDiv.textContent = message;
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function generateAIResponse(message) {
            const responses = [
                'אני מציע לשנות את הצבע לכחול כדי ליצור ניגודיות טובה יותר.',
                'כדאי להוסיף עוד תמונות כדי לעשות את האתר יותר אטרקטיבי.',
                'הטקסט הזה יהיה טוב יותר אם תקצר אותו ותעשה אותו יותר ישיר.',
                'אני ממליץ להוסיף כפתור call-to-action כאן.',
                'התוכן שלך מעולה! אולי כדאי להוסיף סקציית המלצות לקוחות?'
            ];
            
            return responses[Math.floor(Math.random() * responses.length)];
        }

        function generateContent() {
            showToast('info', 'AI מכין תוכן...');
            setTimeout(() => {
                showToast('success', 'תוכן נוצר בהצלחה!');
            }, 2000);
        }

        function optimizeSEO() {
            showToast('info', 'מבצע אופטימיזציה SEO...');
            setTimeout(() => {
                showToast('success', 'SEO אופטימיזציה הושלמה!');
            }, 2500);
        }

        function suggestDesign() {
            showToast('info', 'AI מכין הצעות עיצוב...');
            setTimeout(() => {
                showToast('success', 'הצעות עיצוב מוכנות!');
            }, 1500);
        }

        // Integration Functions
        function setupAnalytics() {
            showToast('info', 'מגדיר Google Analytics...');
            setTimeout(() => {
                showToast('success', 'Google Analytics מוגדר!');
            }, 1500);
        }

        function setupSocial() {
            showToast('info', 'מגדיר רשתות חברתיות...');
            setTimeout(() => {
                showToast('success', 'רשתות חברתיות מוגדרות!');
            }, 1000);
        }

        function setupSEO() {
            showToast('info', 'מגדיר כלי SEO...');
            setTimeout(() => {
                showToast('success', 'כלי SEO מוגדרים!');
            }, 1200);
        }

        function toggleRuler() {
            showToast('info', 'סרגל מדידה הופעל/בוטל');
        }

        // Utility Functions
        function showToast(type, message, duration = 3000) {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            
            document.body.appendChild(toast);
            
            setTimeout(() => toast.classList.add('show'), 100);
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => document.body.removeChild(toast), 300);
            }, duration);
        }

        // Auto-save every 30 seconds
        setInterval(() => {
            if (currentWebsite) {
                saveEditorState();
            }
        }, 30000);

        // Before page unload
        window.addEventListener('beforeunload', saveEditorState);

        console.log('🚀 WebMaster Pro Ultimate Editor loaded successfully!');
    </script>
</body>
</html>
