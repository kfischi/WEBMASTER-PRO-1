<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>🚀 WebMaster Pro - אדיטור ויזואלי מתקדם</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Assistant:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <style>
    :root {
      --primary: #4f46e5;
      --bg: #0f0f23;
      --glass-bg: rgba(255,255,255,0.08);
      --glass-border: rgba(255,255,255,0.12);
      --text: #ffffff;
      --text-secondary: #a1a1aa;
      --success: #10b981;
      --warning: #f59e0b;
      --error: #ef4444;
    }
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, var(--bg) 0%, #1e1b4b 50%, #312e81 100%);
      color: var(--text);
      height: 100vh;
      overflow: hidden;
      display: grid;
      grid-template-rows: 60px 1fr;
      grid-template-columns: 240px 1fr 280px;
    }

    .header {
      grid-column: 1 / -1;
      background: var(--glass-bg);
      backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--glass-border);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 20px;
    }

    .logo {
      font-size: 18px;
      font-weight: 700;
      color: var(--primary);
    }

    .header-actions {
      display: flex;
      gap: 10px;
    }

    .btn {
      background: var(--primary);
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .btn:hover {
      background: #3730a3;
      transform: translateY(-1px);
    }

    .btn.success { background: var(--success); }
    .btn.warning { background: var(--warning); }
    .btn.error { background: var(--error); }

    .sidebar {
      background: var(--glass-bg);
      backdrop-filter: blur(20px);
      border-right: 1px solid var(--glass-border);
      padding: 20px;
      overflow-y: auto;
    }

    .sidebar-right {
      background: var(--glass-bg);
      backdrop-filter: blur(20px);
      border-left: 1px solid var(--glass-border);
      padding: 20px;
      overflow-y: auto;
    }

    .main-content {
      background: white;
      position: relative;
      overflow: hidden;
    }

    .section-title {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 15px;
      color: var(--text);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .website-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .website-item {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid var(--glass-border);
      border-radius: 8px;
      padding: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
    }

    .website-item:hover {
      background: rgba(255, 255, 255, 0.1);
      transform: translateY(-1px);
    }

    .website-item.active {
      background: var(--primary);
      border-color: var(--primary);
    }

    .website-name {
      font-weight: 500;
      font-size: 13px;
      margin-bottom: 4px;
    }

    .website-category {
      font-size: 11px;
      color: var(--text-secondary);
      opacity: 0.8;
    }

    .website-price {
      position: absolute;
      top: 8px;
      left: 8px;
      background: var(--success);
      color: white;
      font-size: 10px;
      padding: 2px 6px;
      border-radius: 4px;
      font-weight: 600;
    }

    .tools-section {
      margin-top: 25px;
    }

    .tool-group {
      margin-bottom: 20px;
    }

    .tool-label {
      font-size: 12px;
      color: var(--text-secondary);
      margin-bottom: 6px;
      display: block;
    }

    .tool-input {
      width: 100%;
      padding: 8px 10px;
      border: 1px solid var(--glass-border);
      border-radius: 6px;
      background: rgba(255, 255, 255, 0.05);
      color: var(--text);
      font-size: 13px;
      transition: border-color 0.3s ease;
    }

    .tool-input:focus {
      outline: none;
      border-color: var(--primary);
    }

    .tool-input::placeholder {
      color: var(--text-secondary);
    }

    .color-palette {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 8px;
      margin-bottom: 15px;
    }

    .color-option {
      width: 35px;
      height: 35px;
      border-radius: 6px;
      cursor: pointer;
      border: 2px solid transparent;
      transition: all 0.3s ease;
    }

    .color-option:hover {
      border-color: white;
      transform: scale(1.1);
    }

    .preview-frame {
      width: 100%;
      height: 100%;
      border: none;
      background: white;
    }

    .loading {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100%;
      background: #f8f9fa;
      color: #666;
      font-size: 16px;
    }

    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 12px 20px;
      border-radius: 8px;
      color: white;
      font-weight: 500;
      z-index: 10000;
      transform: translateX(400px);
      transition: transform 0.3s ease;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }

    .notification.show {
      transform: translateX(0);
    }

    .notification.success { background: var(--success); }
    .notification.error { background: var(--error); }
    .notification.info { background: var(--primary); }
    .notification.warning { background: var(--warning); }

    .ai-section {
      border-top: 1px solid var(--glass-border);
      padding-top: 20px;
      margin-top: 20px;
    }

    .ai-input {
      width: 100%;
      min-height: 80px;
      resize: vertical;
      margin-bottom: 10px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid var(--glass-border);
      border-radius: 6px;
      padding: 10px;
      color: var(--text);
      font-family: inherit;
    }

    .ai-input:focus {
      outline: none;
      border-color: var(--primary);
    }

    .range-input {
      width: 100%;
      margin-bottom: 10px;
    }

    .export-section {
      border-top: 1px solid var(--glass-border);
      padding-top: 20px;
      margin-top: 20px;
    }

    @keyframes slideIn {
      from { transform: translateX(400px); }
      to { transform: translateX(0); }
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .fade-in {
      animation: fadeIn 0.5s ease;
    }
  </style>
</head>

<body>
  <!-- Header -->
  <div class="header">
    <div class="logo">
      <i class="fas fa-rocket"></i> WebMaster Pro
    </div>
    <div class="header-actions">
      <button class="btn" onclick="saveCurrentWebsite()">
        <i class="fas fa-save"></i> שמור
      </button>
      <button class="btn success" onclick="previewWebsite()">
        <i class="fas fa-eye"></i> תצוגה מקדימה
      </button>
      <button class="btn warning" onclick="exportWebsite()">
        <i class="fas fa-download"></i> ייצא
      </button>
    </div>
  </div>

  <!-- Sidebar Left -->
  <div class="sidebar">
    <div class="section-title">
      <i class="fas fa-globe"></i> אתרים זמינים
    </div>
    <div class="website-list" id="websiteList">
      <!-- יטען דינמית -->
    </div>

    <div class="tools-section">
      <div class="section-title">
        <i class="fas fa-tools"></i> כלי עריכה מהירה
      </div>
      
      <div class="tool-group">
        <label class="tool-label">חיפוש אתר</label>
        <input type="text" class="tool-input" id="websiteSearch" placeholder="חפש אתר..." onkeyup="filterWebsites()">
      </div>

      <div class="tool-group">
        <button class="btn" onclick="loadDemoWebsite()">
          <i class="fas fa-plus"></i> טען דמו חדש
        </button>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <div class="loading" id="loadingMessage">
      <i class="fas fa-spinner fa-spin"></i> טוען אתר...
    </div>
    <iframe class="preview-frame" id="previewFrame" style="display: none;"></iframe>
  </div>

  <!-- Sidebar Right -->
  <div class="sidebar-right">
    <div class="section-title">
      <i class="fas fa-palette"></i> עיצוב וסגנון
    </div>

    <div class="tool-group">
      <label class="tool-label">עריכת טקסט</label>
      <input type="text" class="tool-input" id="textInput" placeholder="הכנס טקסט חדש">
      <button class="btn" onclick="updateSelectedText()" style="margin-top: 8px;">
        <i class="fas fa-edit"></i> עדכן
      </button>
    </div>

    <div class="tool-group">
      <label class="tool-label">צבעי רקע</label>
      <div class="color-palette">
        <div class="color-option" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%)" onclick="changeBackgroundColor('linear-gradient(135deg, #667eea 0%, #764ba2 100%)')"></div>
        <div class="color-option" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%)" onclick="changeBackgroundColor('linear-gradient(135deg, #f093fb 0%, #f5576c 100%)')"></div>
        <div class="color-option" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)" onclick="changeBackgroundColor('linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)')"></div>
        <div class="color-option" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)" onclick="changeBackgroundColor('linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)')"></div>
        <div class="color-option" style="background: #667eea" onclick="changeBackgroundColor('#667eea')"></div>
        <div class="color-option" style="background: #f093fb" onclick="changeBackgroundColor('#f093fb')"></div>
        <div class="color-option" style="background: #4facfe" onclick="changeBackgroundColor('#4facfe')"></div>
        <div class="color-option" style="background: #43e97b" onclick="changeBackgroundColor('#43e97b')"></div>
      </div>
    </div>

    <div class="tool-group">
      <label class="tool-label">צבע טקסט</label>
      <input type="color" class="tool-input" id="textColorInput" value="#333333" onchange="changeTextColor(this.value)">
    </div>

    <div class="tool-group">
      <label class="tool-label">גודל גופן</label>
      <input type="range" class="range-input" id="fontSizeRange" min="12" max="48" value="16" onchange="changeFontSize(this.value)">
      <span id="fontSizeDisplay">16px</span>
    </div>

    <div class="ai-section">
      <div class="section-title">
        <i class="fas fa-robot"></i> עוזר AI
      </div>
      
      <div class="tool-group">
        <textarea class="ai-input" id="aiInput" placeholder="שאל את העוזר AI... (לדוגמה: 'הוסף כפתור קשר')"></textarea>
        <button class="btn" onclick="askAI()">
          <i class="fas fa-magic"></i> שאל AI
        </button>
      </div>
    </div>

    <div class="export-section">
      <div class="section-title">
        <i class="fas fa-file-export"></i> ייצוא ושמירה
      </div>
      
      <button class="btn success" onclick="exportHTML()">
        <i class="fas fa-code"></i> ייצא HTML
      </button>
      <button class="btn warning" onclick="exportImages()">
        <i class="fas fa-images"></i> ייצא תמונות
      </button>
      <button class="btn" onclick="shareWebsite()">
        <i class="fas fa-share"></i> שתף אתר
      </button>
    </div>
  </div>

  <script>
    // 🛠️ JavaScript מתוקן ומלא
    console.log('🚀 WebMaster Pro Editor מתחיל...');

    // משתנים גלובליים
    let currentWebsiteId = null;
    let selectedElement = null;
    let websiteDatabase = {};

    // רשימת האתרים המלאה
    const websites = [
      {
        id: 'dr-michal-rosen',
        name: 'ד"ר מיכל רוזן',
        category: 'רפואה אסתטית',
        price: '₪2,800',
        url: './websites/dr-michal-rosen.html',
        image: 'https://i.imghippo.com/files/Ayyb2287TOc.png'
      },
      {
        id: 'fitness-co',
        name: 'דני פיט',
        category: 'כושר ובריאות',
        price: '₪2,200',
        url: './websites/fitness-co.html',
        image: 'https://i.imghippo.com/files/WiRp8302YJs.png'
      },
      {
        id: 'yoga-studio',
        name: 'סטודיו אוהם',
        category: 'יוגה ומדיטציה',
        price: '₪1,900',
        url: './websites/yoga-studio.html',
        image: 'https://i.imghippo.com/files/eJk7179MXo.png'
      },
      {
        id: 'nutritionist',
        name: 'ד"ר שרה כהן',
        category: 'תזונה ודיאטה',
        price: '₪2,400',
        url: './websites/nutritionist.html',
        image: 'https://i.imghippo.com/files/rhNp2418oyE.png'
      },
      {
        id: 'law-firm',
        name: 'משרד ברקוביץ',
        category: 'משפטים ועו"ד',
        price: '₪2,500',
        url: './websites/law-firm.html',
        image: 'https://i.imghippo.com/files/hVyV3858OQ.png'
      },
      {
        id: 'accountant',
        name: 'רינה לוי',
        category: 'חשבת שכר',
        price: '₪2,000',
        url: './websites/accountant.html',
        image: 'https://i.imghippo.com/files/tGN5433dAU.png'
      },
      {
        id: 'beauty-salon',
        name: 'מספרה BELLA',
        category: 'יופי וקוסמטיקה',
        price: '₪1,700',
        url: './websites/beauty-salon.html',
        image: 'https://i.imghippo.com/files/xnK4816Hc.png'
      },
      {
        id: 'tutor',
        name: 'ד"ר רונית לוי',
        category: 'חינוך והוראה',
        price: '₪2,100',
        url: './websites/tutor.html',
        image: 'https://i.imghippo.com/files/Ceu2132Q.png'
      },
      {
        id: 'aesthetic-clinic',
        name: 'קליניקת יופי פרמיום',
        category: 'אסתטיקה רפואית',
        price: '₪3,200',
        url: './websites/aesthetic-clinic.html',
        image: 'https://i.imghippo.com/files/sWlf1880WKM.png'
      },
      {
        id: 'multibrawn',
        name: 'מולטיבראון',
        category: 'נופש ואירועים',
        price: '₪2,300',
        url: './websites/multibrawn.html',
        image: 'https://i.imghippo.com/files/pL5530Z.png'
      },
      {
        id: 'real-estate',
        name: 'נדל"ן פרמיום',
        category: 'נדל"ן ומקרקעין',
        price: '₪2,700',
        url: './websites/real-estate.html',
        image: 'https://i.imghippo.com/files/htWG9491QkE.png'
      }
    ];

    // פונקציות עזר
    function showNotification(message, type = 'info') {
      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      notification.textContent = message;
      document.body.appendChild(notification);
      
      setTimeout(() => notification.classList.add('show'), 100);
      setTimeout(() => {
        notification.classList.remove('show');
        setTimeout(() => notification.remove(), 300);
      }, 3000);
    }

    function loadWebsiteList() {
      const websiteList = document.getElementById('websiteList');
      websiteList.innerHTML = '';

      websites.forEach(website => {
        const item = document.createElement('div');
        item.className = 'website-item';
        item.onclick = () => loadWebsite(website.id);
        
        item.innerHTML = `
          <div class="website-price">${website.price}</div>
          <div class="website-name">${website.name}</div>
          <div class="website-category">${website.category}</div>
        `;
        
        websiteList.appendChild(item);
      });
    }

    function loadWebsite(websiteId) {
      const website = websites.find(w => w.id === websiteId);
      if (!website) {
        showNotification('אתר לא נמצא', 'error');
        return;
      }

      currentWebsiteId = websiteId;
      
      // עדכון UI
      document.querySelectorAll('.website-item').forEach(item => {
        item.classList.remove('active');
      });
      
      event.target.closest('.website-item').classList.add('active');
      
      // טעינת האתר
      const frame = document.getElementById('previewFrame');
      const loading = document.getElementById('loadingMessage');
      
      loading.style.display = 'flex';
      frame.style.display = 'none';
      
      frame.onload = function() {
        loading.style.display = 'none';
        frame.style.display = 'block';
        setupFrameEditing();
        showNotification(`${website.name} נטען בהצלחה!`, 'success');
      };

      frame.onerror = function() {
        loading.style.display = 'none';
        frame.style.display = 'block';
        frame.srcdoc = `
          <html>
            <body style="font-family: Arial; text-align: center; padding: 50px; color: #666;">
              <h2>דמו - ${website.name}</h2>
              <p>זהו דמו של האתר. קובץ ה-HTML לא נמצא במערכת.</p>
              <p>אתר זה בשווי ${website.price}</p>
              <button style="padding: 10px 20px; background: #4f46e5; color: white; border: none; border-radius: 5px; cursor: pointer; margin: 10px;">כפתור לדוגמה</button>
              <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; margin: 20px 0; border-radius: 10px;">
                <h3>סקציה צבעונית</h3>
                <p>זהו דמו של עיצוב מתקדם</p>
              </div>
            </body>
          </html>
        `;
        showNotification('נטען באמצעות דמו', 'warning');
      };
      
      frame.src = website.url;
    }

    function setupFrameEditing() {
      try {
        const frame = document.getElementById('previewFrame');
        const frameDoc = frame.contentDocument || frame.contentWindow.document;
        
        // הוספת סגנונות לעריכה
        const editStyle = frameDoc.createElement('style');
        editStyle.textContent = `
          .editable-element {
            transition: all 0.3s ease;
            cursor: pointer;
            min-height: 20px;
          }
          .editable-element:hover {
            outline: 2px dashed #4f46e5;
            background: rgba(79, 70, 229, 0.1);
          }
          .editable-element.selected {
            outline: 2px solid #4f46e5;
            background: rgba(79, 70, 229, 0.2);
          }
        `;
        frameDoc.head.appendChild(editStyle);

        // הפיכת אלמנטים לעריכים
        const editableElements = frameDoc.querySelectorAll('h1, h2, h3, h4, h5, h6, p, button, a, span');
        editableElements.forEach((element, index) => {
          element.classList.add('editable-element');
          element.dataset.editId = index;
          
          element.addEventListener('click', function(e) {
            e.preventDefault();
            selectElement(this);
          });
        });

      } catch (error) {
        console.error('שגיאה בהגדרת עריכה:', error);
        showNotification('אזהרה: לא ניתן להגדיר עריכה', 'warning');
      }
    }

    function selectElement(element) {
      // הסרת בחירה קודמת
      const frame = document.getElementById('previewFrame');
      const frameDoc = frame.contentDocument || frame.contentWindow.document;
      frameDoc.querySelectorAll('.selected').forEach(el => el.classList.remove('selected'));
      
      // בחירת אלמנט חדש
      element.classList.add('selected');
      selectedElement = element;
      
      // עדכון כלי העריכה
      document.getElementById('textInput').value = element.textContent;
      showNotification('אלמנט נבחר לעריכה', 'info');
    }

    function updateSelectedText() {
      if (!selectedElement) {
        showNotification('בחר אלמנט לעריכה', 'warning');
        return;
      }
      
      const newText = document.getElementById('textInput').value;
      selectedElement.textContent = newText;
      showNotification('טקסט עודכן בהצלחה!', 'success');
    }

    function changeBackgroundColor(color) {
      if (!selectedElement) {
        showNotification('בחר אלמנט לעריכה', 'warning');
        return;
      }
      
      selectedElement.style.background = color;
      showNotification('צבע רקע עודכן!', 'success');
    }

    function changeTextColor(color) {
      if (!selectedElement) {
        showNotification('בחר אלמנט לעריכה', 'warning');
        return;
      }
      
      selectedElement.style.color = color;
      showNotification('צבע טקסט עודכן!', 'success');
    }

    function changeFontSize(size) {
      document.getElementById('fontSizeDisplay').textContent = size + 'px';
      
      if (!selectedElement) {
        showNotification('בחר אלמנט לעריכה', 'warning');
        return;
      }
      
      selectedElement.style.fontSize = size + 'px';
      showNotification('גודל גופן עודכן!', 'success');
    }

    function filterWebsites() {
      const searchTerm = document.getElementById('websiteSearch').value.toLowerCase();
      const websiteItems = document.querySelectorAll('.website-item');
      
      websiteItems.forEach(item => {
        const name = item.querySelector('.website-name').textContent.toLowerCase();
        const category = item.querySelector('.website-category').textContent.toLowerCase();
        
        if (name.includes(searchTerm) || category.includes(searchTerm)) {
          item.style.display = 'block';
        } else {
          item.style.display = 'none';
        }
      });
    }

    function loadDemoWebsite() {
      const frame = document.getElementById('previewFrame');
      frame.srcdoc = `
        <!DOCTYPE html>
        <html lang="he" dir="rtl">
        <head>
          <meta charset="UTF-8">
          <meta name="viewport" content="width=device-width, initial-scale=1.0">
          <title>אתר דמו חדש</title>
          <style>
            * { margin: 0; padding: 0; box-sizing: border-box; }
            body { font-family: 'Inter', Arial, sans-serif; line-height: 1.6; }
            .hero { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 100px 20px; text-align: center; }
            .container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }
            .section { padding: 80px 20px; text-align: center; }
            button { background: #4f46e5; color: white; padding: 15px 30px; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; }
          </style>
        </head>
        <body>
          <div class="hero">
            <h1>ברוכים הבאים לאתר החדש</h1>
            <p>אתר מקצועי ויפהפה שנבנה עם WebMaster Pro</p>
            <button>צור קשר</button>
          </div>
          <div class="section">
            <div class="container">
              <h2>השירותים שלנו</h2>
              <p>אנחנו מציעים פתרונות מקצועיים ואמינים</p>
            </div>
          </div>
        </body>
        </html>
      `;
      
      document.getElementById('loadingMessage').style.display = 'none';
      frame.style.display = 'block';
      
      setTimeout(() => {
        setupFrameEditing();
        showNotification('דמו חדש נטען בהצלחה!', 'success');
      }, 500);
    }

    async function askAI() {
      const input = document.getElementById('aiInput').value;
      if (!input.trim()) {
        showNotification('הכנס שאלה לעוזר AI', 'warning');
        return;
      }

      showNotification('AI מעבד את הבקשה...', 'info');
      
      try {
        // חיבור לwindow.claude.complete אם קיים
        if (window.claude && window.claude.complete) {
          const response = await window.claude.complete(`אתה עוזר לבניית אתרים. המשתמש שואל: "${input}". תן תשובה קצרה ומעשית בעברית.`);
          showNotification(`AI: ${response.substring(0, 100)}...`, 'success');
        } else {
          // תשובות דמו
          const demoResponses = [
            'אני ממליץ להוסיף כפתור "צור קשר" בחלק העליון של האתר',
            'נסה לשנות את הצבעים לגוונים יותר מקצועיים',
            'הוסף עוד תמונות להפוך את האתר לחיוני יותר',
            'שקול להוסיף testimonials מלקוחות מרוצים',
            'ייתכן שכדאי לשפר את הטקסט ולהפוך אותו לקליט יותר'
          ];
          const randomResponse = demoResponses[Math.floor(Math.random() * demoResponses.length)];
          showNotification(`AI: ${randomResponse}`, 'success');
        }
      } catch (error) {
        showNotification('שגיאה בחיבור לAI - נסה שוב', 'error');
      }
      
      document.getElementById('aiInput').value = '';
    }

    function saveCurrentWebsite() {
      if (!currentWebsiteId) {
        showNotification('בחר אתר לשמירה', 'warning');
        return;
      }
      
      try {
        const frame = document.getElementById('previewFrame');
        const frameDoc = frame.contentDocument || frame.contentWindow.document;
        const htmlContent = frameDoc.documentElement.outerHTML;
        
        // שמירה ב-localStorage
        localStorage.setItem(`website_${currentWebsiteId}`, htmlContent);
        localStorage.setItem(`website_${currentWebsiteId}_timestamp`, new Date().toISOString());
        
        showNotification('האתר נשמר בהצלחה!', 'success');
      } catch (error) {
        showNotification('שגיאה בשמירה', 'error');
      }
    }

    function previewWebsite() {
      if (!currentWebsiteId) {
        showNotification('בחר אתר לתצוגה מקדימה', 'warning');
        return;
      }
      
      const frame = document.getElementById('previewFrame');
      const newWindow = window.open('', '_blank');
      
      try {
        const frameDoc = frame.contentDocument || frame.contentWindow.document;
        newWindow.document.write(frameDoc.documentElement.outerHTML);
        newWindow.document.close();
        showNotification('תצוגה מקדימה נפתחה!', 'success');
      } catch (error) {
        showNotification('שגיאה בפתיחת תצוגה מקדימה', 'error');
      }
    }

    function exportWebsite() {
      if (!currentWebsiteId) {
        showNotification('בחר אתר לייצוא', 'warning');
        return;
      }
      
      exportHTML();
    }

    function exportHTML() {
      try {
        const frame = document.getElementById('previewFrame');
        const frameDoc = frame.contentDocument || frame.contentWindow.document;
        const htmlContent = frameDoc.documentElement.outerHTML;
        
        const blob = new Blob([htmlContent], { type: 'text/html' });
        const url = URL.createObjectURL(blob);
        
        const a = document.createElement('a');
        a.href = url;
        a.download = `${currentWebsiteId || 'website'}.html`;
        a.click();
        
        URL.revokeObjectURL(url);
        showNotification('קובץ HTML יוצא בהצלחה!', 'success');
      } catch (error) {
        showNotification('שגיאה בייצוא HTML', 'error');
      }
    }

    function exportImages() {
      showNotification('תכונת ייצוא תמונות תהיה זמינה בקרוב', 'info');
    }

    function shareWebsite() {
      if (!currentWebsiteId) {
        showNotification('בחר אתר לשיתוף', 'warning');
        return;
      }
      
      const url = `${window.location.origin}/websites/${currentWebsiteId}.html`;
      
      if (navigator.share) {
        navigator.share({
          title: `אתר ${currentWebsiteId}`,
          url: url
        });
      } else {
        navigator.clipboard.writeText(url).then(() => {
          showNotification('קישור הועתק ללוח!', 'success');
        }).catch(() => {
          showNotification('לא ניתן להעתיק קישור', 'error');
        });
      }
    }

    // API Functions (עם fallback)
    async function apiCall(endpoint, method = 'GET', data = null) {
      try {
        const response = await fetch(`/.netlify/functions/${endpoint}`, {
          method,
          headers: { 'Content-Type': 'application/json' },
          body: data ? JSON.stringify(data) : null
        });
        
        if (!response.ok) throw new Error(`API Error: ${response.status}`);
        return await response.json();
      } catch (error) {
        console.error('API Call failed:', error);
        return { success: false, error: error.message };
      }
    }

    // Error Handling
    window.addEventListener('error', function(e) {
      console.error('🐛 JavaScript Error:', e.error);
      showNotification('התרחשה שגיאה - המערכת ממשיכה לפעול', 'warning');
      return true;
    });

    // אתחול המערכת
    document.addEventListener('DOMContentLoaded', function() {
      try {
        console.log('🚀 WebMaster Pro Editor נטען בהצלחה!');
        loadWebsiteList();
        showNotification('WebMaster Pro מוכן לעבודה!', 'success');
        
        // בדיקת חיבור לAPI
        apiCall('list-websites').then(result => {
          if (result.success) {
            showNotification('חיבור לשרת הצליח!', 'success');
          } else {
            console.log('פועל במצב לוקלי');
          }
        });
        
        console.log(`📊 נטענו ${websites.length} אתרים במערכת`);
        
      } catch (error) {
        console.error('שגיאה באתחול:', error);
        showNotification('המערכת נטענה עם התראות', 'warning');
      }
    });

    console.log('✅ WebMaster Pro Editor - מוכן לעבודה!');
  </script>
</body>
</html>
