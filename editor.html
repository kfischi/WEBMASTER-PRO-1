<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ğŸ¤– WebMaster Pro AI - ××“×™×˜×•×¨ ×•×™×–×•××œ×™ ××ª×§×“×</title>
  <meta name="description" content="××“×™×˜×•×¨ ×•×™×–×•××œ×™ ××ª×§×“× ×œ×¢×¨×™×›×ª 11 ××ª×¨×™× ××§×¦×•×¢×™×™× ×¢× AI ××•×‘× ×”">
  
  <!-- Fonts & Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Assistant:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet"/>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"/>
  
  <style>
    /* ===== CSS VARIABLES ===== */
    :root {
      --primary: #4f46e5;
      --primary-hover: #3730a3;
      --bg: #0f0f23;
      --bg-secondary: #1a1a40;
      --glass-bg: rgba(255,255,255,0.1);
      --glass-border: rgba(255,255,255,0.2);
      --text: #fff;
      --text-secondary: #cbd5e1;
      --success: #10b981;
      --warning: #f59e0b;
      --error: #ef4444;
    }

    /* ===== BASE STYLES ===== */
    * { 
      box-sizing: border-box; 
      margin: 0; 
      padding: 0; 
    }
    
    body { 
      display: grid; 
      grid-template-rows: auto 1fr; 
      grid-template-columns: 1fr; 
      height: 100vh;
      background: linear-gradient(135deg, var(--bg) 0%, var(--bg-secondary) 100%);
      color: var(--text); 
      font-family: 'Inter', 'Assistant', system-ui, sans-serif; 
      overflow: hidden; 
    }

    /* ===== MAIN LAYOUT ===== */
    .editor-container { 
      display: grid; 
      grid-template-columns: 280px 1fr 320px; 
      grid-template-rows: auto 1fr; 
      height: 100%; 
      gap: 1px;
      background: var(--glass-border);
    }

    /* ===== HEADER ===== */
    header.header { 
      grid-column: 1/-1; 
      background: var(--glass-bg); 
      backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--glass-border); 
      display: flex; 
      align-items: center; 
      padding: 0.75rem 1.5rem; 
      position: relative;
      z-index: 100;
    }
    
    header .logo { 
      font-size: 1.4rem; 
      font-weight: 700; 
      color: var(--text);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    header .logo i {
      color: var(--primary);
    }
    
    header .tools { 
      margin-left: auto; 
      display: flex; 
      gap: 0.75rem; 
    }
    
    header .tools button { 
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-hover) 100%);
      color: #fff; 
      border: none; 
      padding: 0.6rem 1.2rem; 
      border-radius: 0.5rem; 
      font-weight: 600;
      transition: all 0.3s ease;
      cursor: pointer;
      font-size: 0.9rem;
      box-shadow: 0 2px 8px rgba(79, 70, 229, 0.3);
    }
    
    header .tools button:hover { 
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(79, 70, 229, 0.4);
    }

    /* ===== SIDEBARS ===== */
    aside.sidebar-left, aside.sidebar-right {
      background: var(--glass-bg); 
      backdrop-filter: blur(20px); 
      border: 1px solid var(--glass-border);
      padding: 1.5rem; 
      overflow-y: auto;
      position: relative;
    }
    
    aside.sidebar-left { 
      grid-row: 2; 
      border-right: none;
    }
    
    aside.sidebar-right { 
      grid-row: 2; 
      border-left: none;
    }

    /* ===== CANVAS ===== */
    main.canvas { 
      position: relative; 
      background: #ffffff; 
      overflow: hidden;
    }
    
    #loading-overlay { 
      position: absolute; 
      inset: 0; 
      background: linear-gradient(135deg, rgba(15,15,35,0.9) 0%, rgba(26,26,64,0.9) 100%);
      backdrop-filter: blur(10px);
      display: flex; 
      align-items: center; 
      justify-content: center; 
      color: var(--text); 
      font-size: 1.3rem;
      font-weight: 600;
      visibility: hidden;
      z-index: 50;
    }
    
    #canvas-iframe { 
      width: 100%; 
      height: 100%; 
      border: none; 
      background: white;
    }

    /* ===== WEBSITES LIST ===== */
    .websites-list .website-item {
      display: flex; 
      gap: 0.75rem; 
      margin-bottom: 0.75rem; 
      padding: 0.75rem;
      cursor: pointer;
      transition: all 0.3s ease;
      border-radius: 0.5rem;
      border: 1px solid transparent;
    }
    
    .websites-list .website-item img { 
      width: 50px; 
      height: 50px; 
      border-radius: 8px; 
      object-fit: cover;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }
    
    .websites-list .website-item:hover {
      background: rgba(255,255,255,0.1);
      transform: translateX(-4px);
      border-color: var(--glass-border);
      box-shadow: 0 4px 16px rgba(0,0,0,0.2);
    }

    .websites-list .website-item div {
      flex: 1;
    }

    .websites-list .website-item .website-name {
      font-weight: 600;
      color: var(--text);
      font-size: 0.95rem;
    }

    /* ===== BLOCKS LIST ===== */
    .blocks-list .block-item {
      display: flex; 
      align-items: center; 
      gap: 0.75rem; 
      padding: 0.75rem; 
      margin-bottom: 0.5rem;
      cursor: pointer; 
      border-radius: 0.5rem; 
      border: 1px solid var(--glass-border);
      transition: all 0.3s ease;
      background: rgba(255,255,255,0.05);
    }
    
    .blocks-list .block-item:hover {
      background: rgba(255,255,255,0.15);
      transform: translateX(-4px);
      border-color: var(--primary);
      box-shadow: 0 4px 12px rgba(79, 70, 229, 0.2);
    }

    .blocks-list .block-item i {
      color: var(--primary);
      font-size: 1.1rem;
      width: 20px;
    }

    /* ===== PROPERTIES PANEL ===== */
    .properties-panel .property-section { 
      margin-bottom: 1.5rem;
      background: rgba(255,255,255,0.05);
      padding: 1rem;
      border-radius: 0.5rem;
      border: 1px solid var(--glass-border);
    }
    
    .property-section h3 { 
      margin-bottom: 0.75rem; 
      font-size: 1rem;
      color: var(--primary);
      font-weight: 600;
    }

    .property-section input,
    .property-section select,
    .property-section textarea {
      width: 100%;
      padding: 0.6rem;
      border: 1px solid var(--glass-border);
      border-radius: 0.4rem;
      background: rgba(255,255,255,0.1);
      color: var(--text);
      font-family: inherit;
      transition: all 0.2s ease;
    }

    .property-section input:focus,
    .property-section select:focus,
    .property-section textarea:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 2px rgba(79, 70, 229, 0.2);
    }

    .property-section button {
      background: var(--primary);
      color: white;
      border: none;
      padding: 0.6rem 1rem;
      border-radius: 0.4rem;
      cursor: pointer;
      transition: all 0.2s ease;
      font-weight: 500;
    }

    .property-section button:hover {
      background: var(--primary-hover);
      transform: translateY(-1px);
    }

    /* ===== SELECTED ELEMENT ===== */
    .selected {
      outline: 2px solid var(--primary) !important;
      outline-offset: 2px;
      background: rgba(79, 70, 229, 0.1) !important;
      transition: all 0.2s ease;
      position: relative;
    }

    .selected::before {
      content: 'âœï¸ ×¢×•×¨×š';
      position: absolute;
      top: -25px;
      left: 0;
      background: var(--primary);
      color: white;
      padding: 2px 8px;
      font-size: 11px;
      border-radius: 4px;
      font-weight: 600;
      z-index: 1000;
    }

    /* ===== AI CHAT ===== */
    #ai-chat {
      background: rgba(0,0,0,0.3);
      padding: 1rem;
      border-radius: 0.75rem;
      border: 1px solid var(--glass-border);
      backdrop-filter: blur(10px);
    }
    
    #ai-chat h3 {
      color: var(--primary);
      margin-bottom: 0.75rem;
      font-size: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    #ai-chat h3::before {
      content: 'ğŸ¤–';
    }
    
    .chat-message {
      padding: 0.75rem;
      margin-bottom: 0.5rem;
      border-radius: 0.5rem;
      word-wrap: break-word;
      font-size: 0.9rem;
      line-height: 1.4;
    }
    
    .chat-message.user {
      background: rgba(79,70,229,0.4);
      margin-left: 15%;
      border: 1px solid rgba(79,70,229,0.6);
    }
    
    .chat-message.ai {
      background: rgba(124,58,237,0.4);
      margin-right: 15%;
      border: 1px solid rgba(124,58,237,0.6);
    }

    /* ===== NOTIFICATIONS ===== */
    .notification { 
      position: fixed; 
      bottom: 2rem; 
      left: 50%; 
      transform: translateX(-50%);
      background: linear-gradient(135deg, var(--success) 0%, #059669 100%);
      color: #fff; 
      padding: 1rem 1.5rem; 
      border-radius: 0.75rem;
      font-weight: 600;
      box-shadow: 0 8px 32px rgba(0,0,0,0.3);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.2);
      animation: slideIn 0.4s ease-out, fadeOut 0.4s ease-out 2.5s forwards;
      z-index: 1000;
    }
    
    @keyframes slideIn {
      from { 
        transform: translateX(-50%) translateY(100px); 
        opacity: 0; 
      }
      to { 
        transform: translateX(-50%) translateY(0); 
        opacity: 1; 
      }
    }

    @keyframes fadeOut { 
      to { 
        opacity: 0; 
        transform: translateX(-50%) translateY(20px); 
      } 
    }

    /* ===== SEARCH BOX ===== */
    .search-box {
      margin-bottom: 1rem;
    }

    .search-box input {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid var(--glass-border);
      border-radius: 0.5rem;
      background: rgba(255,255,255,0.1);
      color: var(--text);
      font-size: 0.9rem;
      transition: all 0.2s ease;
    }

    .search-box input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 2px rgba(79, 70, 229, 0.2);
    }

    .search-box input::placeholder {
      color: var(--text-secondary);
    }

    /* ===== RESPONSIVE ===== */
    @media (max-width: 1200px) {
      .editor-container {
        grid-template-columns: 250px 1fr 280px;
      }
    }

    @media (max-width: 1024px) {
      .editor-container {
        grid-template-columns: 220px 1fr 260px;
      }
      
      aside.sidebar-left, aside.sidebar-right {
        padding: 1rem;
      }
    }

    /* ===== CUSTOM SCROLLBAR ===== */
    ::-webkit-scrollbar {
      width: 8px;
    }

    ::-webkit-scrollbar-track {
      background: rgba(255,255,255,0.1);
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb {
      background: var(--primary);
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: var(--primary-hover);
    }
  </style>
</head>
<body>

<div class="editor-container">
  <!-- ===== HEADER ===== -->
  <header class="header">
    <div class="logo">
      <i class="fas fa-magic"></i> 
      WebMaster Pro AI
    </div>
    <div class="tools">
      <button onclick="saveChanges()" title="×©××•×¨ ×©×™× ×•×™×™×">
        <i class="fas fa-save"></i> ×©××•×¨
      </button>
      <button onclick="exportWebsite()" title="×™×™×¦× ××ª×¨">
        <i class="fas fa-download"></i> ×™×™×¦×
      </button>
      <button onclick="openAIChat()" title="×¤×ª×— AI Assistant">
        <i class="fas fa-robot"></i> AI
      </button>
    </div>
  </header>

  <!-- ===== SIDEBAR LEFT: ××ª×¨×™× + ×‘×œ×•×§×™× ===== -->
  <aside class="sidebar-left">
    <!-- ×¨×©×™××ª ××ª×¨×™× -->
    <div class="websites-list">
      <div class="search-box">
        <input type="text" placeholder="ğŸ” ×—×™×¤×•×© ××ª×¨..." oninput="filterList(this.value)"/>
      </div>
      <!-- ××ª×¨×™× ×™×•×•×¦×¨×• ×“×™× ××™×ª -->
    </div>
    
    <hr style="margin: 1.5rem 0; border: none; border-top: 1px solid var(--glass-border);"/>
    
    <!-- ×¨×©×™××ª ×‘×œ×•×§×™× -->
    <div class="blocks-list">
      <h3><i class="fas fa-puzzle-piece"></i> ×‘×œ×•×§×™×</h3>
      <!-- ×‘×œ×•×§×™× ×™×•×•×¦×¨×• ×“×™× ××™×ª -->
    </div>
    
    <!-- AI Chat -->
    <div id="ai-chat" style="display:none; margin-top:1.5rem;">
      <h3>AI Assistant</h3>
      <div id="chat-messages" style="height:200px; overflow-y:auto; background:rgba(0,0,0,0.2); padding:0.75rem; border-radius:0.5rem; margin-bottom:0.75rem;"></div>
      <input id="ai-input" type="text" placeholder="×©××œ ××ª ×”-AI..." style="width:100%; padding:0.75rem; border-radius:0.5rem; border:1px solid var(--glass-border); margin-bottom:0.5rem;"/>
      <button onclick="askAI()" style="width:100%; padding:0.75rem; background:var(--primary); color:#fff; border:none; border-radius:0.5rem; cursor:pointer;">
        <i class="fas fa-paper-plane"></i> ×©×œ×—
      </button>
    </div>
  </aside>

  <!-- ===== CANVAS: ××™×–×•×¨ ×”×¢×¨×™×›×” ===== -->
  <main class="canvas">
    <div id="loading-overlay">
      <div style="text-align:center;">
        <i class="fas fa-spinner fa-spin" style="font-size:2rem; margin-bottom:1rem;"></i>
        <div>×˜×•×¢×Ÿ ××ª×¨...</div>
      </div>
    </div>
    <iframe id="canvas-iframe"></iframe>
  </main>

  <!-- ===== SIDEBAR RIGHT: ×××¤×™×™× ×™× ===== -->
  <aside class="sidebar-right properties-panel">
    <!-- ×¢×¨×™×›×ª ×˜×§×¡×˜ -->
    <div class="property-section">
      <h3><i class="fas fa-font"></i> ×¢×¨×™×›×ª ×˜×§×¡×˜</h3>
      <textarea id="text-editor" placeholder="×¢×¨×™×›×ª ×ª×•×›×Ÿ..." style="height:5rem; resize:vertical;"></textarea>
      <button onclick="updateProperty('innerText', document.getElementById('text-editor').value)" style="margin-top:0.75rem;">
        <i class="fas fa-check"></i> ×™×™×©× ×©×™× ×•×™×™×
      </button>
    </div>
    
    <!-- ×¦×‘×¢×™× -->
    <div class="property-section">
      <h3><i class="fas fa-palette"></i> ×¦×‘×¢×™×</h3>
      <div style="display:grid; gap:0.75rem;">
        <label style="display:flex; align-items:center; gap:0.5rem;">
          ×¦×‘×¢ ×˜×§×¡×˜: 
          <input type="color" id="text-color" onchange="updateProperty('color', this.value)" style="width:60px; height:40px; padding:2px;"/>
        </label>
        <label style="display:flex; align-items:center; gap:0.5rem;">
          ×¦×‘×¢ ×¨×§×¢: 
          <input type="color" id="bg-color" onchange="updateProperty('backgroundColor', this.value)" style="width:60px; height:40px; padding:2px;"/>
        </label>
      </div>
    </div>
    
    <!-- ×¤×•× ×˜ -->
    <div class="property-section">
      <h3><i class="fas fa-text-height"></i> ×˜×™×¤×•×’×¨×¤×™×”</h3>
      <div style="display:grid; gap:0.75rem;">
        <label>
          ××©×¤×—×ª ×¤×•× ×˜:
          <select id="font-family" onchange="updateProperty('fontFamily', this.value)">
            <option value="Inter">Inter</option>
            <option value="Assistant">Assistant</option>
            <option value="Arial">Arial</option>
            <option value="Georgia">Georgia</option>
            <option value="Times">Times</option>
          </select>
        </label>
        <label>
          ×’×•×“×œ ×¤×•× ×˜: <span id="font-size-display">16px</span>
          <input type="range" id="font-size" min="12" max="48" value="16" 
                 oninput="updateProperty('fontSize', this.value+'px'); document.getElementById('font-size-display').textContent = this.value+'px'"/>
        </label>
      </div>
    </div>

    <!-- ××™×“×¢ ×¢×œ ×”××œ×× ×˜ ×”× ×‘×—×¨ -->
    <div class="property-section">
      <h3><i class="fas fa-info-circle"></i> ××™×“×¢</h3>
      <div id="element-info" style="font-size:0.9rem; color:var(--text-secondary);">
        ×‘×—×¨ ××œ×× ×˜ ×œ×¢×¨×™×›×”
      </div>
    </div>
  </aside>
</div>

<script>
  // ===== × ×ª×•× ×™ ×”××ª×¨×™× =====
  const websites = [
    { id:'dr-michal-rosen', name:'×“\'×¨ ××™×›×œ ×¨×•×–×Ÿ', url:'./websites/dr-michal-rosen.html', image:'https://i.imghippo.com/files/Ayyb2287TOc.png', category:'×¨×¤×•××” ××¡×ª×˜×™×ª' },
    { id:'fitness-co', name:'×“× ×™ ×¤×™×˜', url:'./websites/fitness-co.html', image:'https://i.imghippo.com/files/WiRp8302YJs.png', category:'××××Ÿ ×›×•×©×¨' },
    { id:'yoga-studio', name:'×¡×˜×•×“×™×• ××•×”×', url:'./websites/yoga-studio.html', image:'https://i.imghippo.com/files/eJk7179MXo.png', category:'×™×•×’×” ×•××“×™×˜×¦×™×”' },
    { id:'nutritionist', name:'×“\'×¨ ×©×¨×” ×›×”×Ÿ', url:'./websites/nutritionist.html', image:'https://i.imghippo.com/files/rhNp2418oyE.png', category:'×ª×–×•× ××™×ª ×§×œ×™× ×™×ª' },
    { id:'law-firm', name:'××©×¨×“ ×‘×¨×§×•×‘×™×¥', url:'./websites/law-firm.html', image:'https://i.imghippo.com/files/hVyV3858OQ.png', category:'×¢×•×¨×›×™ ×“×™×Ÿ' },
    { id:'accountant', name:'×¨×™× ×” ×œ×•×™', url:'./websites/accountant.html', image:'https://i.imghippo.com/files/tGN5433dAU.png', category:'×—×©×‘×ª ×©×›×¨' },
    { id:'beauty-salon', name:'××¡×¤×¨×” BELLA', url:'./websites/beauty-salon.html', image:'https://i.imghippo.com/files/xnK4816Hc.png', category:'×™×•×¤×™ ×•×¢×™×¦×•×‘ ×©×™×¢×¨' },
    { id:'tutor', name:'×“\'×¨ ×¨×•× ×™×ª ×œ×•×™', url:'./websites/tutor.html', image:'https://i.imghippo.com/files/Ceu2132Q.png', category:'××•×¨×” ×¤×¨×˜×™×ª' },
    { id:'aesthetic-clinic', name:'×§×œ×™× ×™×§×ª ×™×•×¤×™ ×¤×¨××™×•×', url:'./websites/aesthetic-clinic.html', image:'https://i.imghippo.com/files/sWlf1880WKM.png', category:'××¡×ª×˜×™×§×” ×¨×¤×•××™×ª' },
    { id:'multibrawn', name:'××•×œ×˜×™×‘×¨××•×Ÿ', url:'./websites/multibrawn.html', image:'https://i.imghippo.com/files/pL5530Z.png', category:'× ×•×¤×© ×•××™×¨×•×¢×™×' },
    { id:'real-estate', name:'× ×“×œ"×Ÿ ×¤×¨××™×•×', url:'./websites/real-estate.html', image:'https://i.imghippo.com/files/htWG9491QkE.png', category:'×”×©×§×¢×•×ª × ×“×œ"×Ÿ' }
  ];

  // ===== ×‘×œ×•×§×™× =====
  const blockTypes = [
    { type: 'text', icon: 'fas fa-font', name: '×˜×§×¡×˜', template: '<p data-editable="true" style="cursor:pointer; padding:10px; margin:10px 0;">×˜×§×¡×˜ ×—×“×© - ×œ×—×¥ ×œ×¢×¨×™×›×”</p>' },
    { type: 'heading', icon: 'fas fa-heading', name: '×›×•×ª×¨×ª', template: '<h2 data-editable="true" style="cursor:pointer; padding:10px; margin:15px 0; color:#4f46e5;">×›×•×ª×¨×ª ×—×“×©×”</h2>' },
    { type: 'button', icon: 'fas fa-hand-pointer', name: '×›×¤×ª×•×¨', template: '<button data-editable="true" style="padding:12px 24px; background:#4f46e5; color:white; border:none; border-radius:6px; cursor:pointer; margin:10px; font-weight:600;">×›×¤×ª×•×¨ ×—×“×©</button>' },
    { type: 'image', icon: 'fas fa-image', name: '×ª××•× ×”', template: '<img data-editable="true" src="https://via.placeholder.com/300x200/4f46e5/white?text=×ª××•× ×”+×—×“×©×”" alt="×ª××•× ×” ×—×“×©×”" style="max-width:100%; height:auto; margin:10px 0; border-radius:8px; cursor:pointer;">' }
  ];

  // ===== ××©×ª× ×™ ××¢×¨×›×ª =====
  let currentWebsite = null;
  let currentSelectedElement = null;

  // ===== ××ª×—×•×œ ×¨×©×™××ª ××ª×¨×™× =====
  function initWebsites() {
    const list = document.querySelector('.websites-list');
    const searchBox = list.querySelector('.search-box');
    
    // ×× ×§×” ×¨×©×™××” ×§×™×™××ª
    list.querySelectorAll('.website-item').forEach(item => item.remove());
    
    websites.forEach(website => {
      const div = document.createElement('div');
      div.className = 'website-item';
      div.onclick = () => loadWebsite(website.id);
      div.innerHTML = `
        <img src="${website.image}" alt="${website.name}" loading="lazy"/>
        <div>
          <div class="website-name">${website.name}</div>
          <div style="font-size:0.8rem; color:var(--text-secondary); margin-top:2px;">${website.category}</div>
        </div>`;
      
      // ××•×¡×™×£ ××—×¨×™ search box
      searchBox.parentNode.insertBefore(div, searchBox.nextSibling);
    });
  }

  // ===== ×—×™×¤×•×© ××ª×¨×™× =====
  function filterList(query) {
    document.querySelectorAll('.website-item').forEach(item => {
      const name = item.querySelector('.website-name').textContent;
      const category = item.querySelector('div div:last-child').textContent;
      const matches = name.toLowerCase().includes(query.toLowerCase()) || 
                     category.toLowerCase().includes(query.toLowerCase());
      item.style.display = matches ? 'flex' : 'none';
    });
  }

  // ===== ××ª×—×•×œ ×‘×œ×•×§×™× =====
  function initBlocks() {
    const list = document.querySelector('.blocks-list');
    
    // ×× ×§×” ×‘×œ×•×§×™× ×§×™×™××™×
    list.querySelectorAll('.block-item').forEach(item => item.remove());
    
    blockTypes.forEach(block => {
      const div = document.createElement('div');
      div.className = 'block-item';
      div.onclick = () => addBlock(block.type);
      div.title = `×”×•×¡×£ ${block.name}`;
      div.innerHTML = `<i class="${block.icon}"></i> ${block.name}`;
      list.appendChild(div);
    });
  }

  // ===== ×”×•×¡×¤×ª ×‘×œ×•×§ =====
  function addBlock(blockType) {
    const iframe = document.getElementById('canvas-iframe');
    if (!iframe.contentDocument) {
      showNotification('×˜×¢×Ÿ ××ª×¨ ×ª×—×™×œ×”', 'warning');
      return;
    }
    
    const block = blockTypes.find(b => b.type === blockType);
    const doc = iframe.contentDocument;
    const newElement = doc.createElement('div');
    newElement.innerHTML = block.template;
    
    const elementToAdd = newElement.firstElementChild;
    
    // ××•×¡×™×£ event listeners ×œ××œ×× ×˜ ×”×—×“×©
    elementToAdd.addEventListener('click', (e) => {
      e.preventDefault();
      selectElement(elementToAdd);
    });
    
    // ××•×¡×™×£ ×œ×¡×•×£ ×”×’×•×£ ××• ××—×¨×™ ×”××œ×× ×˜ ×”× ×‘×—×¨
    if (currentSelectedElement && currentSelectedElement.parentNode) {
      currentSelectedElement.parentNode.insertBefore(elementToAdd, currentSelectedElement.nextSibling);
    } else {
      doc.body.appendChild(elementToAdd);
    }
    
    // ×‘×•×—×¨ ××ª ×”××œ×× ×˜ ×”×—×“×©
    selectElement(elementToAdd);
    
    showNotification(`× ×•×¡×£ ${block.name} ×‘×”×¦×œ×—×”`, 'success');
  }

  // ===== ×˜×¢×™× ×ª ××ª×¨ =====
  function loadWebsite(id) {
    const site = websites.find(w => w.id === id);
    if (!site) {
      showNotification('××ª×¨ ×œ× × ××¦×', 'error');
      return;
    }
    
    currentWebsite = id;
    const iframe = document.getElementById('canvas-iframe');
    const overlay = document.getElementById('loading-overlay');
    
    // ××¦×™×’ loading
    overlay.style.visibility = 'visible';
    
    // ×˜×•×¢×Ÿ ××ª ×”××ª×¨
    iframe.src = site.url;
    
    iframe.onload = () => {
      overlay.style.visibility = 'hidden';
      const doc = iframe.contentDocument;
      
      if (!doc) {
        showNotification('×©×’×™××” ×‘×˜×¢×™× ×ª ×”××ª×¨', 'error');
        return;
      }
      
      // ××•×¡×™×£ CSS ×œ××ª×¨ ×¢×‘×•×¨ ×‘×—×™×¨×”
      const style = doc.createElement('style');
      style.textContent = `
        .selected {
          outline: 2px solid #4f46e5 !important;
          outline-offset: 2px;
          background: rgba(79, 70, 229, 0.1) !important;
          transition: all 0.2s ease;
          position: relative;
        }
        .selected::before {
          content: 'âœï¸ ×¢×•×¨×š';
          position: absolute;
          top: -25px;
          left: 0;
          background: #4f46e5;
          color: white;
          padding: 2px 8px;
          font-size: 11px;
          border-radius: 4px;
          font-weight: 600;
          z-index: 1000;
        }
      `;
      doc.head.appendChild(style);
      
      // ××•×¡×™×£ ×™×›×•×œ×ª ×¢×¨×™×›×” ×œ×›×œ ×”××œ×× ×˜×™× ×”×¨×œ×•×•× ×˜×™×™×
      doc.querySelectorAll('h1, h2, h3, h4, h5, h6, p, span, div.content, button, a').forEach(el => {
        // ××“×œ×’ ×¢×œ ××œ×× ×˜×™× ××¡×•×™××™×
        if (el.closest('nav') || el.closest('script') || el.closest('style')) return;
        
        el.setAttribute('data-editable', 'true');
        el.style.cursor = 'pointer';
        el.addEventListener('click', (e) => {
          e.preventDefault();
          e.stopPropagation();
          selectElement(el);
        });
      });
      
      showNotification(`× ×˜×¢×Ÿ: ${site.name}`, 'success');
    };
    
    iframe.onerror = () => {
      overlay.style.visibility = 'hidden';
      showNotification('×©×’×™××” ×‘×˜×¢×™× ×ª ×”××ª×¨', 'error');
    };
  }

  // ===== ×‘×—×™×¨×ª ××œ×× ×˜ =====
  function selectElement(el) {
    // ××¡×™×¨ ×‘×—×™×¨×” ×§×•×“××ª
    if (currentSelectedElement) {
      currentSelectedElement.classList.remove('selected');
    }
    
    // ×‘×•×—×¨ ××œ×× ×˜ ×—×“×©
    currentSelectedElement = el;
    el.classList.add('selected');
    
    // ××¢×“×›×Ÿ panel ×××¤×™×™× ×™×
    const textEditor = document.getElementById('text-editor');
    const elementInfo = document.getElementById('element-info');
    
    textEditor.value = el.innerText || el.textContent || '';
    
    // ××¦×™×’ ××™×“×¢ ×¢×œ ×”××œ×× ×˜
    const tagName = el.tagName.toLowerCase();
    const classes = el.className ? ` (${el.className})` : '';
    elementInfo.innerHTML = `
      <strong>××œ×× ×˜ × ×‘×—×¨:</strong><br>
      ${tagName}${classes}<br>
      <small>×œ×—×¥ ×¢×œ ×××¤×™×™×Ÿ ×œ×¢×¨×™×›×”</small>
    `;
    
    // ××¢×“×›×Ÿ color pickers
    const computedStyle = getComputedStyle(el);
    document.getElementById('text-color').value = rgbToHex(computedStyle.color);
    document.getElementById('bg-color').value = rgbToHex(computedStyle.backgroundColor);
    
    showNotification('××œ×× ×˜ × ×‘×—×¨ ×œ×¢×¨×™×›×”', 'info');
  }

  // ===== ×¢×“×›×•×Ÿ ×××¤×™×™×Ÿ =====
  function updateProperty(prop, val) {
    if (!currentSelectedElement) {
      showNotification('×‘×—×¨ ××œ×× ×˜ ×ª×—×™×œ×”', 'warning');
      return;
    }
    
    if (prop === 'innerText') {
      currentSelectedElement.innerText = val;
    } else {
      currentSelectedElement.style[prop] = val;
    }
    
    saveChanges();
    showNotification('×”×××¤×™×™×Ÿ ×¢×•×“×›×Ÿ', 'success');
  }

  // ===== ×©××™×¨×” =====
  function saveChanges() {
    const iframe = document.getElementById('canvas-iframe');
    if (!iframe.contentDocument) {
      showNotification('××™×Ÿ ××ª×¨ ×œ×©××™×¨×”', 'warning');
      return;
    }
    
    try {
      const html = iframe.contentDocument.documentElement.outerHTML;
      localStorage.setItem(`webmaster_pro_${currentWebsite}`, html);
      localStorage.setItem('webmaster_pro_last_saved', new Date().toISOString());
      showNotification('×”×©×™× ×•×™×™× × ×©××¨×• ×‘×”×¦×œ×—×”', 'success');
    } catch (error) {
      console.error('Save error:', error);
      showNotification('×©×’×™××” ×‘×©××™×¨×”', 'error');
    }
  }

  // ===== ×™×™×¦×•× =====
  function exportWebsite() {
    const iframe = document.getElementById('canvas-iframe');
    if (!iframe.contentDocument) {
      showNotification('××™×Ÿ ××ª×¨ ×œ×™×™×¦×•×', 'warning');
      return;
    }
    
    try {
      const html = iframe.contentDocument.documentElement.outerHTML;
      const blob = new Blob([html], { type: 'text/html;charset=utf-8' });
      const url = URL.createObjectURL(blob);
      
      const a = document.createElement('a');
      a.href = url;
      a.download = `${currentWebsite || 'website'}.html`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      
      showNotification('×”××ª×¨ ×™×•×¦× ×‘×”×¦×œ×—×”', 'success');
    } catch (error) {
      console.error('Export error:', error);
      showNotification('×©×’×™××” ×‘×™×™×¦×•×', 'error');
    }
  }

  // ===== AI Assistant =====
  async function aiAssistant(prompt) {
    try {
      if (typeof window.claude === 'undefined' || typeof window.claude.complete !== 'function') {
        throw new Error('AI ×œ× ×–××™×Ÿ ×‘××¡×’×¨×ª ×–×•');
      }
      
      const response = await window.claude.complete(`
        ××ª×” ×¢×•×–×¨ ××§×¦×•×¢×™ ×œ×¢×™×¦×•×‘ ××ª×¨×™× ×•-UX/UI. ×”××©×ª××© ×¢×•×¨×š ××ª×¨ ×¢× ×”××“×™×˜×•×¨ ×©×œ× ×•.
        
        ×©××œ×ª ×”××©×ª××©: ${prompt}
        
        ×ª×Ÿ ×ª×©×•×‘×” ××•×¢×™×œ×” ×•××§×¦×•×¢×™×ª. ×× ××ª×” ××¦×™×¢ ×©×™× ×•×™×™ CSS ××• HTML, ×ª×Ÿ ×“×•×’×××•×ª ×§×•× ×§×¨×˜×™×•×ª.
        
        ×ª×©×•×‘×” ×‘-JSON:
        {
          "suggestion": "×”×¢×¦×” ×”××§×¦×•×¢×™×ª ×©×œ×š",
          "code": "×§×•×“ CSS/HTML ×× ×¨×œ×•×•× ×˜×™ (××• ×¨×™×§)",
          "explanation": "×”×¡×‘×¨ ××¤×•×¨×˜ ××™×š ×œ×™×©×"
        }
      `);
      
      return JSON.parse(response);
    } catch (error) {
      console.error('AI Error:', error);
      return {
        suggestion: '××¦×˜×¢×¨, ×™×© ×‘×¢×™×” ×‘×—×™×‘×•×¨ ×œ-AI. × ×¡×” ×©×•×‘ ×××•×—×¨ ×™×•×ª×¨.',
        code: '',
        explanation: '×©×™×¨×•×ª ×”-AI ×–×× ×™ ×œ× ×–××™×Ÿ.'
      };
    }
  }

  async function askAI() {
    const input = document.getElementById('ai-input');
    const question = input.value.trim();
    
    if (!question) {
      showNotification('×›×ª×‘ ×©××œ×” ×ª×—×™×œ×”', 'warning');
      return;
    }
    
    // ××•×¡×™×£ ×”×•×“×¢×ª ××©×ª××©
    addChatMessage(question, 'user');
    input.value = '';
    
    // ××¦×™×’ ×©×”AI ×—×•×©×‘
    const thinkingMsg = addChatMessage('AI ×—×•×©×‘...', 'ai');
    
    try {
      const response = await aiAssistant(question);
      
      // ××¡×™×¨ ×”×•×“×¢×ª "×—×•×©×‘"
      thinkingMsg.remove();
      
      // ××•×¡×™×£ ×ª×©×•×‘×ª AI
      addChatMessage(response.suggestion || '×œ× ×–××™×Ÿ ×›×¨×’×¢', 'ai');
      
      // ×× ×™×© ×§×•×“, ××¦×™×’ ××•×ª×•
      if (response.code) {
        addChatMessage(`×§×•×“ ××•×¦×¢:\n${response.code}`, 'ai');
      }
      
    } catch (error) {
      thinkingMsg.remove();
      addChatMessage('××¦×˜×¢×¨, ×™×© ×‘×¢×™×” ×‘×—×™×‘×•×¨ ×œ-AI', 'ai');
    }
  }

  // ===== ×”×•×“×¢×•×ª ×¦'××˜ =====
  function addChatMessage(msg, type) {
    const box = document.getElementById('chat-messages');
    const div = document.createElement('div');
    div.className = `chat-message ${type}`;
    div.style.whiteSpace = 'pre-wrap';
    div.textContent = msg;
    
    box.appendChild(div);
    box.scrollTop = box.scrollHeight;
    
    return div; // ××—×–×™×¨ ××ª ×”××œ×× ×˜ ×œ××—×™×§×” ×× × ×“×¨×©
  }

  // ===== ×¤×ª×™×—×ª/×¡×’×™×¨×ª AI ×¦'××˜ =====
  function openAIChat() {
    const chat = document.getElementById('ai-chat');
    const isVisible = chat.style.display !== 'none';
    chat.style.display = isVisible ? 'none' : 'block';
    
    if (!isVisible) {
      // ××ª××§×“ ×‘×©×“×” ×”×§×œ×˜
      setTimeout(() => {
        document.getElementById('ai-input').focus();
      }, 100);
    }
  }

  // ===== ×”×•×“×¢×•×ª ×œ××©×ª××© =====
  function showNotification(txt, type = 'success') {
    const notification = document.createElement('div');
    notification.className = 'notification';
    notification.textContent = txt;
    
    // ×¦×‘×¢×™× ×œ×¤×™ ×¡×•×’
    if (type === 'error') {
      notification.style.background = 'linear-gradient(135deg, var(--error) 0%, #dc2626 100%)';
    } else if (type === 'warning') {
      notification.style.background = 'linear-gradient(135deg, var(--warning) 0%, #d97706 100%)';
    } else if (type === 'info') {
      notification.style.background = 'linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%)';
    }
    
    document.body.appendChild(notification);
    
    // ××¡×™×¨ ××—×¨×™ 3 ×©× ×™×•×ª
    setTimeout(() => {
      if (notification.parentNode) {
        notification.remove();
      }
    }, 3000);
  }

  // ===== ×¤×•× ×§×¦×™×•×ª ×¢×–×¨ =====
  function rgbToHex(rgb) {
    if (!rgb || rgb === 'rgba(0, 0, 0, 0)' || rgb === 'transparent') return '#000000';
    
    const result = rgb.match(/\d+/g);
    if (!result || result.length < 3) return '#000000';
    
    return "#" + ((1 << 24) + (+result[0] << 16) + (+result[1] << 8) + +result[2]).toString(16).slice(1);
  }

  // ===== ××ª×—×•×œ ×”××¤×œ×™×§×¦×™×” =====
  document.addEventListener('DOMContentLoaded', () => {
    try {
      initWebsites();
      initBlocks();
      
      // ××¦×™×’ ×”×•×“×¢×ª ×‘×¨×•×›×™× ×”×‘××™×
      setTimeout(() => {
        showNotification('ğŸš€ WebMaster Pro AI ××•×›×Ÿ ×œ×¢×‘×•×“×”!', 'info');
      }, 500);
      
      console.log('âœ… WebMaster Pro AI Editor loaded successfully');
      console.log(`ğŸ“Š ${websites.length} websites available for editing`);
      
    } catch (error) {
      console.error('Initialization error:', error);
      showNotification('×©×’×™××” ×‘××ª×—×•×œ ×”××¢×¨×›×ª', 'error');
    }
  });

  // ===== Event Listeners × ×•×¡×¤×™× =====
  
  // Enter ×‘-AI input
  document.addEventListener('DOMContentLoaded', () => {
    const aiInput = document.getElementById('ai-input');
    aiInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        askAI();
      }
    });
  });

  // Keyboard shortcuts
  document.addEventListener('keydown', (e) => {
    // Ctrl+S ×œ×©××™×¨×”
    if (e.ctrlKey && e.key === 's') {
      e.preventDefault();
      saveChanges();
    }
    
    // Ctrl+E ×œ×¤×ª×™×—×ª AI
    if (e.ctrlKey && e.key === 'e') {
      e.preventDefault();
      openAIChat();
    }
    
    // ESC ×œ×‘×™×˜×•×œ ×‘×—×™×¨×”
    if (e.key === 'Escape' && currentSelectedElement) {
      currentSelectedElement.classList.remove('selected');
      currentSelectedElement = null;
      document.getElementById('element-info').textContent = '×‘×—×¨ ××œ×× ×˜ ×œ×¢×¨×™×›×”';
    }
  });

  // ===== ×”×’× ×” ××¤× ×™ ××™×‘×•×“ × ×ª×•× ×™× =====
  window.addEventListener('beforeunload', (e) => {
    if (currentWebsite) {
      const message = '×™×© ×œ×š ×©×™× ×•×™×™× ×©×œ× × ×©××¨×•. ×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ×¢×–×•×‘?';
      e.returnValue = message;
      return message;
    }
  });

  // Export functions for debugging
  window.WebMasterPro = {
    websites,
    blockTypes,
    loadWebsite,
    saveChanges,
    exportWebsite,
    currentWebsite: () => currentWebsite,
    currentElement: () => currentSelectedElement
  };
</script>

</body>
</html>
