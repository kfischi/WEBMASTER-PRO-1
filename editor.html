<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸš€ WebMaster Pro - ××“×™×˜×•×¨ ×•×™×–×•××œ×™ ××ª×§×“×</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Assistant:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <style>
    :root {
      --primary: #4f46e5;
      --bg: #0f0f23;
      --glass-bg: rgba(255,255,255,0.08);
      --glass-border: rgba(255,255,255,0.12);
      --text: #ffffff;
      --text-secondary: #a1a1aa;
      --success: #10b981;
      --warning: #f59e0b;
      --error: #ef4444;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, var(--bg) 0%, #1e1b4b 50%, #312e81 100%);
      color: var(--text);
      height: 100vh;
      overflow: hidden;
      display: grid;
      grid-template-rows: 60px 1fr;
      grid-template-columns: 240px 1fr 280px;
    }

    /* Header */
    .header {
      grid-column: 1 / -1;
      background: var(--glass-bg);
      backdrop-filter: blur(20px) saturate(180%) contrast(120%);
      border-bottom: 1px solid var(--glass-border);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 1.5rem;
      box-shadow: 0 4px 24px rgba(0,0,0,0.1);
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-weight: 800;
      font-size: 1.25rem;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .header-tools {
      display: flex;
      gap: 0.5rem;
    }

    /* Sidebars */
    .sidebar {
      background: var(--glass-bg);
      backdrop-filter: blur(20px) saturate(180%) contrast(120%);
      border: 1px solid var(--glass-border);
      padding: 1.5rem;
      overflow-y: auto;
      scrollbar-width: thin;
      scrollbar-color: var(--glass-border) transparent;
    }

    .sidebar::-webkit-scrollbar {
      width: 6px;
    }

    .sidebar::-webkit-scrollbar-track {
      background: transparent;
    }

    .sidebar::-webkit-scrollbar-thumb {
      background: var(--glass-border);
      border-radius: 3px;
    }

    .sidebar h3 {
      margin-bottom: 1rem;
      font-size: 0.875rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--text-secondary);
      font-weight: 600;
    }

    /* Canvas */
    .canvas {
      background: #ffffff;
      position: relative;
      overflow: auto;
    }

    #canvas-content {
      width: 100%;
      height: 100%;
      padding: 2rem;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      min-height: 100%;
    }

    #canvas-content.drag-over {
      outline: 3px dashed var(--primary);
      outline-offset: -3px;
      background: rgba(79, 70, 229, 0.05);
    }

    /* Buttons */
    .btn {
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: 0.75rem;
      font-weight: 600;
      font-size: 0.875rem;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      display: flex;
      align-items: center;
      gap: 0.5rem;
      position: relative;
      overflow: hidden;
    }

    .btn::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
      transform: translateX(-100%);
      transition: transform 0.6s;
    }

    .btn:hover::before {
      transform: translateX(100%);
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--primary) 0%, #7c3aed 100%);
      color: white;
      box-shadow: 0 4px 14px rgba(79, 70, 229, 0.4);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(79, 70, 229, 0.6);
    }

    .btn-secondary {
      background: var(--glass-bg);
      color: var(--text);
      border: 1px solid var(--glass-border);
    }

    .btn-secondary:hover {
      background: rgba(255,255,255,0.1);
      transform: translateY(-1px);
    }

    .tool-btn {
      width: 100%;
      margin-bottom: 0.75rem;
      justify-content: flex-start;
    }

    /* Website Items */
    .websites-list {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .website-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 1rem;
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      border-radius: 0.75rem;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }

    .website-item::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg, rgba(79, 70, 229, 0.1) 0%, rgba(124, 58, 237, 0.1) 100%);
      opacity: 0;
      transition: opacity 0.3s;
    }

    .website-item:hover::before {
      opacity: 1;
    }

    .website-item:hover {
      transform: translateX(-4px) translateY(-2px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.15);
      border-color: var(--primary);
    }

    .website-item img {
      width: 48px;
      height: 48px;
      border-radius: 0.5rem;
      object-fit: cover;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }

    .website-info {
      flex: 1;
      z-index: 1;
    }

    .website-name {
      font-weight: 600;
      margin-bottom: 0.25rem;
    }

    .website-price {
      font-size: 0.75rem;
      color: var(--success);
      font-weight: 500;
    }

    /* Block Items */
    .blocks-list {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .block-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.875rem;
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      border-radius: 0.5rem;
      cursor: grab;
      transition: all 0.2s;
      user-select: none;
    }

    .block-item:active {
      cursor: grabbing;
    }

    .block-item:hover {
      background: rgba(255,255,255,0.12);
      transform: translateX(-2px);
      border-color: var(--primary);
    }

    .block-icon {
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1rem;
    }

    /* Draggable Elements */
    .draggable {
      position: relative;
      border: 2px dashed transparent;
      border-radius: 4px;
      transition: all 0.2s;
    }

    .draggable:hover {
      border-color: var(--primary);
      background: rgba(79, 70, 229, 0.05);
    }

    .draggable.selected {
      border-color: var(--primary);
      background: rgba(79, 70, 229, 0.1);
      box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.2);
    }

    .draggable.dragging {
      opacity: 0.6;
      transform: scale(0.98);
    }

    /* Notifications */
    .notification {
      position: fixed;
      top: 80px;
      left: 50%;
      transform: translateX(-50%);
      padding: 1rem 1.5rem;
      border-radius: 0.75rem;
      color: white;
      font-weight: 600;
      z-index: 10000;
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255,255,255,0.2);
      box-shadow: 0 8px 32px rgba(0,0,0,0.2);
      animation: slideDown 0.4s cubic-bezier(0.4, 0, 0.2, 1), fadeOut 0.4s ease-in-out 2.6s forwards;
    }

    .notification.success {
      background: linear-gradient(135deg, var(--success) 0%, #059669 100%);
    }

    .notification.warning {
      background: linear-gradient(135deg, var(--warning) 0%, #d97706 100%);
    }

    .notification.error {
      background: linear-gradient(135deg, var(--error) 0%, #dc2626 100%);
    }

    .notification.info {
      background: linear-gradient(135deg, var(--primary) 0%, #7c3aed 100%);
    }

    /* Modals */
    .modal {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.8);
      backdrop-filter: blur(8px);
      z-index: 9999;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 2rem;
    }

    .modal.active {
      display: flex;
    }

    .modal-content {
      background: var(--bg);
      border: 1px solid var(--glass-border);
      border-radius: 1rem;
      padding: 2rem;
      max-width: 90vw;
      max-height: 90vh;
      overflow: auto;
      box-shadow: 0 24px 48px rgba(0,0,0,0.3);
    }

    /* Form Elements */
    .input {
      width: 100%;
      padding: 0.75rem;
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      border-radius: 0.5rem;
      color: var(--text);
      font-size: 0.875rem;
      transition: all 0.2s;
    }

    .input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
    }

    .input::placeholder {
      color: var(--text-secondary);
    }

    /* Animations */
    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateX(-50%) translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
      }
    }

    @keyframes fadeOut {
      from {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
      }
      to {
        opacity: 0;
        transform: translateX(-50%) translateY(-20px);
      }
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes slideInLeft {
      from { transform: translateX(-100%); }
      to { transform: translateX(0); }
    }

    @keyframes bounce {
      0%, 20%, 53%, 80%, to {
        transform: translateY(0);
      }
      40%, 43% {
        transform: translateY(-30px);
      }
      70% {
        transform: translateY(-15px);
      }
      90% {
        transform: translateY(-4px);
      }
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }

    @keyframes shimmer {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }

    /* Responsive Design */
    @media (max-width: 1024px) {
      body {
        grid-template-columns: 200px 1fr 240px;
      }
    }

    @media (max-width: 768px) {
      body {
        grid-template-columns: 1fr;
        grid-template-rows: 60px 1fr;
      }
      
      .sidebar {
        display: none;
      }
      
      .canvas {
        grid-column: 1;
      }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="logo">
      <i class="fas fa-magic"></i>
      <span>WebMaster Pro</span>
    </div>
    <div class="header-tools">
      <button class="btn btn-secondary" onclick="undoAction()">
        <i class="fas fa-undo"></i>
        <span>×‘×™×˜×•×œ</span>
      </button>
      <button class="btn btn-secondary" onclick="redoAction()">
        <i class="fas fa-redo"></i>
        <span>×—×–×¨×”</span>
      </button>
      <button class="btn btn-primary" onclick="saveChanges()">
        <i class="fas fa-save"></i>
        <span>×©××™×¨×”</span>
      </button>
      <button class="btn btn-primary" onclick="exportWebsite()">
        <i class="fas fa-download"></i>
        <span>×™×™×¦×•×</span>
      </button>
    </div>
  </header>

  <!-- Left Sidebar -->
  <aside class="sidebar">
    <h3>ğŸŒ ××ª×¨×™×</h3>
    <div class="websites-list"></div>

    <h3>ğŸ§© ×‘×œ×•×§×™×</h3>
    <div class="blocks-list"></div>

    <h3>ğŸ¨ ×›×œ×™× ××ª×§×“××™×</h3>
    <button class="btn tool-btn btn-primary" onclick="magicDesign()">
      <i class="fas fa-magic"></i>
      <span>Magic Design</span>
    </button>
    <button class="btn tool-btn btn-secondary" onclick="openVideoEditor()">
      <i class="fas fa-video"></i>
      <span>×¢×¨×™×›×ª ×•×™×“××•</span>
    </button>
    <button class="btn tool-btn btn-secondary" onclick="optimizeWebsite()">
      <i class="fas fa-bolt"></i>
      <span>××•×¤×˜×™××™×–×¦×™×”</span>
    </button>
    <button class="btn tool-btn btn-secondary" onclick="generateSEO()">
      <i class="fas fa-chart-line"></i>
      <span>SEO ××•×˜×•××˜×™</span>
    </button>
    <button class="btn tool-btn btn-secondary" onclick="openAIChat()">
      <i class="fas fa-robot"></i>
      <span>AI Chat</span>
    </button>
  </aside>

  <!-- Canvas -->
  <main class="canvas">
    <div id="canvas-content">
      <div style="text-align: center; padding: 4rem 2rem; color: #6b7280;">
        <i class="fas fa-mouse-pointer" style="font-size: 3rem; margin-bottom: 1rem; color: #4f46e5;"></i>
        <h2 style="margin-bottom: 1rem; color: #374151;">×‘×—×¨ ××ª×¨ ×œ×¢×¨×™×›×”</h2>
        <p>×œ×—×¥ ×¢×œ ××—×“ ×”××ª×¨×™× ××”×¨×©×™××” ×›×“×™ ×œ×”×ª×—×™×œ ×œ×¢×¨×•×š ××•×ª×•</p>
      </div>
    </div>
  </main>

  <!-- Right Sidebar -->
  <aside class="sidebar">
    <h3>âš™ï¸ ×××¤×™×™× ×™×</h3>
    <div style="margin-bottom: 1.5rem;">
      <label style="display: block; margin-bottom: 0.5rem; font-size: 0.875rem; color: var(--text-secondary);">×¢×¨×™×›×ª ×˜×§×¡×˜</label>
      <textarea id="text-editor" class="input" style="height: 80px; resize: vertical;" placeholder="×‘×—×¨ ××œ×× ×˜ ×œ×¢×¨×™×›×”..."></textarea>
      <button class="btn btn-primary" style="width: 100%; margin-top: 0.5rem;" onclick="updateSelectedText()">
        <i class="fas fa-check"></i>
        <span>×¢×“×›×Ÿ ×˜×§×¡×˜</span>
      </button>
    </div>

    <div style="margin-bottom: 1.5rem;">
      <label style="display: block; margin-bottom: 0.5rem; font-size: 0.875rem; color: var(--text-secondary);">×¦×‘×¢×™×</label>
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem;">
        <div>
          <label style="display: block; margin-bottom: 0.25rem; font-size: 0.75rem;">×¦×‘×¢ ×˜×§×¡×˜</label>
          <input type="color" id="text-color" class="input" onchange="updateProperty('color', this.value)" style="height: 40px; padding: 0; cursor: pointer;">
        </div>
        <div>
          <label style="display: block; margin-bottom: 0.25rem; font-size: 0.75rem;">×¦×‘×¢ ×¨×§×¢</label>
          <input type="color" id="bg-color" class="input" onchange="updateProperty('backgroundColor', this.value)" style="height: 40px; padding: 0; cursor: pointer;">
        </div>
      </div>
    </div>

    <div style="margin-bottom: 1.5rem;">
      <label style="display: block; margin-bottom: 0.5rem; font-size: 0.875rem; color: var(--text-secondary);">×¤×•× ×˜</label>
      <select id="font-family" class="input" style="margin-bottom: 0.5rem;" onchange="updateProperty('fontFamily', this.value)">
        <option>Inter</option>
        <option>Assistant</option>
        <option>Arial</option>
        <option>Georgia</option>
        <option>Times New Roman</option>
      </select>
      <input type="range" id="font-size" min="12" max="48" value="16" class="input" style="margin-bottom: 0.5rem;" oninput="updateProperty('fontSize', this.value + 'px'); document.getElementById('font-size-value').textContent = this.value + 'px'">
      <div style="text-align: center; font-size: 0.75rem; color: var(--text-secondary);">
        ×’×•×“×œ: <span id="font-size-value">16px</span>
      </div>
    </div>

    <div style="margin-bottom: 1.5rem;">
      <label style="display: block; margin-bottom: 0.5rem; font-size: 0.875rem; color: var(--text-secondary);">×× ×™××¦×™×•×ª</label>
      <select class="input" onchange="addAnimation(this.value)">
        <option value="">×‘×—×¨ ×× ×™××¦×™×”</option>
        <option value="fadeIn">Fade In</option>
        <option value="slideInLeft">Slide In</option>
        <option value="bounce">Bounce</option>
        <option value="pulse">Pulse</option>
      </select>
    </div>

    <div style="margin-bottom: 1.5rem;">
      <label style="display: block; margin-bottom: 0.5rem; font-size: 0.875rem; color: var(--text-secondary);">×ª××•× ×•×ª</label>
      <input type="file" id="image-upload" accept="image/*" style="display: none;" onchange="handleImageUpload(this.files[0])">
      <button class="btn btn-secondary tool-btn" onclick="document.getElementById('image-upload').click()">
        <i class="fas fa-image"></i>
        <span>×”×—×œ×£ ×ª××•× ×”</span>
      </button>
    </div>

    <h3>ğŸ“± ×ª×¦×•×’×•×ª</h3>
    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 0.5rem;">
      <button class="btn btn-secondary" onclick="previewMobile()" style="font-size: 0.75rem; padding: 0.5rem;">
        <i class="fas fa-mobile-alt"></i>
      </button>
      <button class="btn btn-secondary" onclick="previewTablet()" style="font-size: 0.75rem; padding: 0.5rem;">
        <i class="fas fa-tablet-alt"></i>
      </button>
      <button class="btn btn-secondary" onclick="previewDesktop()" style="font-size: 0.75rem; padding: 0.5rem;">
        <i class="fas fa-desktop"></i>
      </button>
    </div>
  </aside>

  <!-- AI Chat Modal -->
  <div id="ai-chat-modal" class="modal">
    <div class="modal-content" style="width: 600px; height: 500px;">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
        <h2 style="margin: 0;">ğŸ¤– AI Assistant</h2>
        <button class="btn btn-secondary" onclick="closeAIChat()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div id="chat-messages" style="height: 300px; overflow-y: auto; background: var(--glass-bg); border-radius: 0.5rem; padding: 1rem; margin-bottom: 1rem; border: 1px solid var(--glass-border);"></div>
      <div style="display: flex; gap: 0.5rem;">
        <input type="text" id="ai-input" class="input" placeholder="×©××œ ××ª ×”-AI..." style="flex: 1;" onkeypress="if(event.key==='Enter') askAI()">
        <button class="btn btn-primary" onclick="askAI()">
          <i class="fas fa-paper-plane"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- Video Editor Modal -->
  <div id="video-editor-modal" class="modal">
    <div class="modal-content" style="width: 800px; height: 600px;">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
        <h2 style="margin: 0;">ğŸ¬ ×¢×¨×™×›×ª ×•×™×“××•</h2>
        <button class="btn btn-secondary" onclick="closeVideoEditor()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div style="margin-bottom: 1.5rem;">
        <input type="file" id="video-upload" accept="video/*" style="display: none;" onchange="handleVideoUpload(this.files[0])">
        <button class="btn btn-primary" onclick="document.getElementById('video-upload').click()">
          <i class="fas fa-upload"></i>
          <span>×”×¢×œ×” ×•×™×“××•</span>
        </button>
      </div>

      <div style="position: relative; margin-bottom: 1.5rem;">
        <video id="video-preview" controls style="width: 100%; max-height: 300px; background: #000; border-radius: 0.5rem;"></video>
        <div id="video-overlays" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none;"></div>
      </div>

      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 0.75rem;">
        <button class="btn btn-secondary" onclick="trimVideo()">
          <i class="fas fa-cut"></i>
          <span>×—×ª×•×š</span>
        </button>
        <button class="btn btn-secondary" onclick="addVideoText()">
          <i class="fas fa-text"></i>
          <span>×”×•×¡×£ ×˜×§×¡×˜</span>
        </button>
        <button class="btn btn-secondary" onclick="addVideoFilter()">
          <i class="fas fa-filter"></i>
          <span>×¤×™×œ×˜×¨</span>
        </button>
        <button class="btn btn-primary" onclick="exportVideo()">
          <i class="fas fa-download"></i>
          <span>×™×™×¦×</span>
        </button>
      </div>
    </div>
  </div>

  <script>
    // ===== GLOBAL VARIABLES =====
    let selectedElement = null;
    let draggedElement = null;
    let undoHistory = [];
    let redoHistory = [];
    let maxHistorySize = 50;
    let videoEditor = null;

    // ===== WEBSITE DATA =====
    const websites = [
      {id:'dr-michal-rosen', name:'×“"×¨ ××™×›×œ ×¨×•×–×Ÿ', url:'./websites/dr-michal-rosen.html', image:'https://i.imghippo.com/files/Ayyb2287TOc.png', category:'medical', price:'â‚ª2,800'},
      {id:'fitness-co', name:'×“× ×™ ×¤×™×˜', url:'./websites/fitness-co.html', image:'https://i.imghippo.com/files/WiRp8302YJs.png', category:'lifestyle', price:'â‚ª2,200'},
      {id:'yoga-studio', name:'×¡×˜×•×“×™×• ××•×”×', url:'./websites/yoga-studio.html', image:'https://i.imghippo.com/files/eJk7179MXo.png', category:'lifestyle', price:'â‚ª1,900'},
      {id:'nutritionist', name:'×“"×¨ ×©×¨×” ×›×”×Ÿ', url:'./websites/nutritionist.html', image:'https://i.imghippo.com/files/rhNp2418oyE.png', category:'medical', price:'â‚ª2,400'},
      {id:'law-firm', name:'××©×¨×“ ×‘×¨×§×•×‘×™×¥', url:'./websites/law-firm.html', image:'https://i.imghippo.com/files/hVyV3858OQ.png', category:'business', price:'â‚ª2,500'},
      {id:'accountant', name:'×¨×™× ×” ×œ×•×™', url:'./websites/accountant.html', image:'https://i.imghippo.com/files/tGN5433dAU.png', category:'business', price:'â‚ª2,000'},
      {id:'beauty-salon', name:'××¡×¤×¨×” BELLA', url:'./websites/beauty-salon.html', image:'https://i.imghippo.com/files/xnK4816Hc.png', category:'lifestyle', price:'â‚ª1,700'},
      {id:'tutor', name:'×“"×¨ ×¨×•× ×™×ª ×œ×•×™', url:'./websites/tutor.html', image:'https://i.imghippo.com/files/Ceu2132Q.png', category:'education', price:'â‚ª2,100'},
      {id:'aesthetic-clinic', name:'×§×œ×™× ×™×§×ª ×™×•×¤×™ ×¤×¨××™×•×', url:'./websites/aesthetic-clinic.html', image:'https://i.imghippo.com/files/sWlf1880WKM.png', category:'premium', price:'â‚ª3,200'},
      {id:'multibrawn', name:'××•×œ×˜×™×‘×¨××•×Ÿ', url:'./websites/multibrawn.html', image:'https://i.imghippo.com/files/pL5530Z.png', category:'lifestyle', price:'â‚ª2,300'},
      {id:'real-estate', name:'× ×“×œ"×Ÿ ×¤×¨××™×•×', url:'./websites/real-estate.html', image:'https://i.imghippo.com/files/htWG9491QkE.png', category:'premium', price:'â‚ª2,700'}
    ];

    // ===== BLOCK TYPES =====
    const blockTypes = [
      {
        type: 'text',
        icon: 'fas fa-font',
        name: '×˜×§×¡×˜',
        template: '<p class="draggable" style="padding: 1rem; margin: 0.5rem 0; cursor: pointer;">×˜×§×¡×˜ ×—×“×© - ×œ×—×¥ ×œ×¢×¨×™×›×”</p>'
      },
      {
        type: 'heading',
        icon: 'fas fa-heading',
        name: '×›×•×ª×¨×ª',
        template: '<h2 class="draggable" style="padding: 1rem; margin: 0.5rem 0; cursor: pointer;">×›×•×ª×¨×ª ×—×“×©×”</h2>'
      },
      {
        type: 'button',
        icon: 'fas fa-hand-pointer',
        name: '×›×¤×ª×•×¨',
        template: '<button class="draggable" style="padding: 12px 24px; background: #4f46e5; color: white; border: none; border-radius: 8px; cursor: pointer; margin: 0.5rem; font-weight: 600;">×›×¤×ª×•×¨ ×—×“×©</button>'
      },
      {
        type: 'image',
        icon: 'fas fa-image',
        name: '×ª××•× ×”',
        template: '<img class="draggable" src="https://via.placeholder.com/300x200/4f46e5/ffffff?text=×ª××•× ×”" style="max-width: 100%; height: auto; border-radius: 8px; margin: 0.5rem 0; cursor: pointer;" alt="×ª××•× ×” ×—×“×©×”">'
      },
      {
        type: 'container',
        icon: 'fas fa-square',
        name: '××™×›×œ',
        template: '<div class="draggable" style="padding: 2rem; border: 2px dashed #e5e7eb; border-radius: 8px; margin: 0.5rem 0; cursor: pointer; text-align: center; color: #6b7280;">××™×›×œ ×—×“×© - ×’×¨×•×¨ ×œ×›××Ÿ ××œ×× ×˜×™×</div>'
      }
    ];

    // ===== UTILITY FUNCTIONS =====
    function showNotification(message, type = 'info') {
      // Remove existing notifications
      document.querySelectorAll('.notification').forEach(n => n.remove());
      
      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      notification.textContent = message;
      
      document.body.appendChild(notification);
      
      // Auto remove after animation
      setTimeout(() => {
        if (notification.parentNode) {
          notification.remove();
        }
      }, 3000);
    }

    function saveToHistory() {
      const currentState = document.getElementById('canvas-content').innerHTML;
      undoHistory.push(currentState);
      
      // Limit history size
      if (undoHistory.length > maxHistorySize) {
        undoHistory.shift();
      }
      
      // Clear redo history when new action is performed
      redoHistory = [];
    }

    function generateId() {
      return 'el_' + Math.random().toString(36).substr(2, 9);
    }

    // ===== CORE EDITING FUNCTIONS =====
    async function loadWebsiteDirectly(id) {
      saveToHistory();
      
      const website = websites.find(w => w.id === id);
      if (!website) {
        showNotification('××ª×¨ ×œ× × ××¦×', 'error');
        return;
      }

      try {
        showNotification('×˜×•×¢×Ÿ ××ª×¨...', 'info');
        currentWebsiteId = id;
        
        // Try to load from Supabase first
        let content = null;
        try {
          const savedWebsite = await loadFromSupabase(id);
          if (savedWebsite && savedWebsite.content) {
            content = savedWebsite.content;
            showNotification('× ×˜×¢×Ÿ ××”×©×¨×ª', 'success');
          }
        } catch (supabaseError) {
          console.log('No saved version in Supabase, loading original');
        }
        
        // If no saved version, load original
        if (!content) {
          const response = await fetch(website.url);
          if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          }
          content = await response.text();
          showNotification('× ×˜×¢×Ÿ ××ª×¨ ××§×•×¨×™', 'info');
        }
        
        const canvas = document.getElementById('canvas-content');
        canvas.innerHTML = content;

        // Make all relevant elements editable and draggable
        const editableSelectors = 'h1, h2, h3, h4, h5, h6, p, span, div, button, a, li';
        canvas.querySelectorAll(editableSelectors).forEach(el => {
          // Skip elements that are too small or likely containers
          if (el.offsetWidth < 20 || el.offsetHeight < 20) return;
          if (el.children.length > 3) return; // Skip complex containers
          
          makeElementEditable(el);
        });

        // Make images replaceable
        canvas.querySelectorAll('img').forEach(img => {
          makeImageReplaceable(img);
        });

        showNotification(`××ª×¨ "${website.name}" × ×˜×¢×Ÿ ×‘×”×¦×œ×—×”!`, 'success');
        
      } catch (error) {
        console.error('Error loading website:', error);
        showNotification('×©×’×™××” ×‘×˜×¢×™× ×ª ×”××ª×¨: ' + error.message, 'error');
      }
    }

    function getCurrentWebsiteName() {
      if (!currentWebsiteId) return '××ª×¨ ×œ×œ× ×©×';
      const website = websites.find(w => w.id === currentWebsiteId);
      return website ? website.name : '××ª×¨ ×œ×œ× ×©×';
    }

    function getCurrentTemplateId() {
      return currentWebsiteId || 'custom';
    }

    function makeElementEditable(element) {
      element.classList.add('draggable');
      element.contentEditable = true;
      element.style.cursor = 'pointer';
      
      // Add unique ID if doesn't exist
      if (!element.id) {
        element.id = generateId();
      }

      // Click to select
      element.addEventListener('click', (e) => {
        e.stopPropagation();
        selectElement(element);
      });

      // Save on input
      element.addEventListener('input', () => {
        saveChanges();
      });

      // Make draggable
      makeElementDraggable(element);
    }

    function makeImageReplaceable(img) {
      img.classList.add('draggable');
      img.style.cursor = 'pointer';
      
      if (!img.id) {
        img.id = generateId();
      }

      img.addEventListener('click', (e) => {
        e.stopPropagation();
        selectElement(img);
        
        // Show image replacement option
        const shouldReplace = confirm('×”×× ×‘×¨×¦×•× ×š ×œ×”×—×œ×™×£ ××ª ×”×ª××•× ×”?');
        if (shouldReplace) {
          document.getElementById('image-upload').click();
        }
      });

      makeElementDraggable(img);
    }

    function selectElement(element) {
      // Remove previous selection
      document.querySelectorAll('.selected').forEach(el => {
        el.classList.remove('selected');
      });

      // Select new element
      element.classList.add('selected');
      selectedElement = element;

      // Update properties panel
      updatePropertiesPanel(element);
      
      showNotification('××œ×× ×˜ × ×‘×—×¨ ×œ×¢×¨×™×›×”', 'info');
    }

    function updatePropertiesPanel(element) {
      const textEditor = document.getElementById('text-editor');
      const textColor = document.getElementById('text-color');
      const bgColor = document.getElementById('bg-color');
      const fontFamily = document.getElementById('font-family');
      const fontSize = document.getElementById('font-size');
      const fontSizeValue = document.getElementById('font-size-value');

      // Update text editor
      if (element.tagName === 'IMG') {
        textEditor.value = element.alt || '';
        textEditor.placeholder = '×ª×™××•×¨ ×ª××•× ×” (Alt text)';
      } else {
        textEditor.value = element.textContent || '';
        textEditor.placeholder = '×¢×¨×•×š ××ª ×”×˜×§×¡×˜ ×›××Ÿ...';
      }

      // Update color inputs
      const computedStyle = window.getComputedStyle(element);
      textColor.value = rgbToHex(computedStyle.color);
      bgColor.value = rgbToHex(computedStyle.backgroundColor);

      // Update font controls
      fontFamily.value = computedStyle.fontFamily.split(',')[0].replace(/['"]/g, '');
      const currentFontSize = parseInt(computedStyle.fontSize);
      fontSize.value = currentFontSize;
      fontSizeValue.textContent = currentFontSize + 'px';
    }

    function updateSelectedText() {
      if (!selectedElement) {
        showNotification('×œ× × ×‘×—×¨ ××œ×× ×˜ ×œ×¢×¨×™×›×”', 'warning');
        return;
      }

      const newText = document.getElementById('text-editor').value;
      
      if (selectedElement.tagName === 'IMG') {
        selectedElement.alt = newText;
        showNotification('×ª×™××•×¨ ×”×ª××•× ×” ×¢×•×“×›×Ÿ', 'success');
      } else {
        selectedElement.textContent = newText;
        showNotification('×”×˜×§×¡×˜ ×¢×•×“×›×Ÿ ×‘×”×¦×œ×—×”', 'success');
      }
      
      saveChanges();
    }

    function updateProperty(property, value) {
      if (!selectedElement) {
        showNotification('×œ× × ×‘×—×¨ ××œ×× ×˜ ×œ×¢×¨×™×›×”', 'warning');
        return;
      }

      selectedElement.style[property] = value;
      saveChanges();
      showNotification(`${property} ×¢×•×“×›×Ÿ`, 'success');
    }

    // ===== DRAG AND DROP =====
    function makeElementDraggable(element) {
      element.draggable = true;
      
      element.addEventListener('dragstart', (e) => {
        draggedElement = element;
        element.classList.add('dragging');
        e.dataTransfer.effectAllowed = 'move';
      });

      element.addEventListener('dragend', () => {
        element.classList.remove('dragging');
        draggedElement = null;
      });
    }

    function initDragAndDrop() {
      const canvas = document.getElementById('canvas-content');

      canvas.addEventListener('dragover', (e) => {
        e.preventDefault();
        canvas.classList.add('drag-over');
        
        if (draggedElement) {
          const afterElement = getDragAfterElement(canvas, e.clientY);
          if (afterElement == null) {
            canvas.appendChild(draggedElement);
          } else {
            canvas.insertBefore(draggedElement, afterElement);
          }
        }
      });

      canvas.addEventListener('dragleave', (e) => {
        if (!canvas.contains(e.relatedTarget)) {
          canvas.classList.remove('drag-over');
        }
      });

      canvas.addEventListener('drop', (e) => {
        e.preventDefault();
        canvas.classList.remove('drag-over');

        const blockType = e.dataTransfer.getData('block-type');
        if (blockType) {
          addBlockToCanvas(blockType, e.clientX, e.clientY);
        }
        
        if (draggedElement) {
          saveToHistory();
          showNotification('××œ×× ×˜ ×”×•×¢×‘×¨ ×‘×”×¦×œ×—×”', 'success');
        }
      });
    }

    function getDragAfterElement(container, y) {
      const draggableElements = [...container.querySelectorAll('.draggable:not(.dragging)')];
      
      return draggableElements.reduce((closest, child) => {
        const box = child.getBoundingClientRect();
        const offset = y - box.top - box.height / 2;
        
        if (offset < 0 && offset > closest.offset) {
          return { offset: offset, element: child };
        } else {
          return closest;
        }
      }, { offset: Number.NEGATIVE_INFINITY }).element;
    }

    function addBlockToCanvas(blockType, x, y) {
      const block = blockTypes.find(b => b.type === blockType);
      if (!block) return;

      saveToHistory();
      
      const tempDiv = document.createElement('div');
      tempDiv.innerHTML = block.template;
      const newElement = tempDiv.firstElementChild;
      
      makeElementEditable(newElement);
      
      const canvas = document.getElementById('canvas-content');
      canvas.appendChild(newElement);
      
      showNotification(`${block.name} × ×•×¡×£ ×‘×”×¦×œ×—×”`, 'success');
      
      // Auto-select the new element
      setTimeout(() => selectElement(newElement), 100);
    }

    // ===== HISTORY MANAGEMENT =====
    function undoAction() {
      if (undoHistory.length === 0) {
        showNotification('××™×Ÿ ×¤×¢×•×œ×•×ª ×œ×‘×™×˜×•×œ', 'warning');
        return;
      }

      const currentState = document.getElementById('canvas-content').innerHTML;
      redoHistory.push(currentState);
      
      const previousState = undoHistory.pop();
      document.getElementById('canvas-content').innerHTML = previousState;
      
      // Re-initialize editable elements
      reinitializeEditableElements();
      
      showNotification('×¤×¢×•×œ×” ×‘×•×˜×œ×”', 'success');
    }

    function redoAction() {
      if (redoHistory.length === 0) {
        showNotification('××™×Ÿ ×¤×¢×•×œ×•×ª ×œ×—×–×¨×”', 'warning');
        return;
      }

      const currentState = document.getElementById('canvas-content').innerHTML;
      undoHistory.push(currentState);
      
      const nextState = redoHistory.pop();
      document.getElementById('canvas-content').innerHTML = nextState;
      
      // Re-initialize editable elements
      reinitializeEditableElements();
      
      showNotification('×¤×¢×•×œ×” ×‘×•×¦×¢×” ××—×“×©', 'success');
    }

    function reinitializeEditableElements() {
      const canvas = document.getElementById('canvas-content');
      
      canvas.querySelectorAll('.draggable').forEach(el => {
        // Remove existing event listeners by cloning
        const newEl = el.cloneNode(true);
        el.parentNode.replaceChild(newEl, el);
        
        // Re-initialize
        if (newEl.tagName === 'IMG') {
          makeImageReplaceable(newEl);
        } else {
          makeElementEditable(newEl);
        }
      });
    }

    // ===== SUPABASE INTEGRATION =====
    let currentWebsiteId = null;
    let currentUserId = null;

    async function saveToSupabase(websiteId, content, name, templateId) {
      try {
        const response = await fetch('/.netlify/functions/save-website', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            websiteId: websiteId,
            content: content,
            name: name,
            templateId: templateId,
            userId: currentUserId,
            isPublished: false
          })
        });

        const result = await response.json();
        
        if (!response.ok) {
          throw new Error(result.error || 'Save failed');
        }

        return result;
      } catch (error) {
        console.error('Supabase save error:', error);
        throw error;
      }
    }

    async function loadFromSupabase(websiteId) {
      try {
        const response = await fetch(`/.netlify/functions/load-website?websiteId=${websiteId}`);
        const result = await response.json();
        
        if (!response.ok) {
          throw new Error(result.error || 'Load failed');
        }

        return result.website;
      } catch (error) {
        console.error('Supabase load error:', error);
        throw error;
      }
    }

    // ===== SAVE AND EXPORT =====
    async function saveChanges() {
      try {
        const content = document.getElementById('canvas-content').innerHTML;
        
        // Save to localStorage (backup)
        localStorage.setItem('webmaster_pro_current_site', content);
        localStorage.setItem('webmaster_pro_save_time', new Date().toISOString());
        
        // Save to Supabase (primary)
        if (currentWebsiteId) {
          showNotification('×©×•××¨ ×œ×©×¨×ª...', 'info');
          
          await saveToSupabase(
            currentWebsiteId,
            content,
            getCurrentWebsiteName(),
            getCurrentTemplateId()
          );
          
          showNotification('× ×©××¨ ×‘×”×¦×œ×—×” ×œ×©×¨×ª!', 'success');
        } else {
          showNotification('×”×©×™× ×•×™×™× × ×©××¨×• ××§×•××™×ª', 'success');
        }
        
        // Update undo history if this is a user action (not automatic)
        if (event && event.isTrusted) {
          saveToHistory();
        }
        
      } catch (error) {
        console.error('Save error:', error);
        showNotification('×©×’×™××” ×‘×©××™×¨×”: ' + error.message, 'error');
        
        // Still show success for localStorage save
        showNotification('× ×©××¨ ××§×•××™×ª (×’×™×‘×•×™)', 'warning');
      }
    }

    function exportWebsite() {
      try {
        const content = document.getElementById('canvas-content').innerHTML;
        
        // Create a complete HTML document
        const fullHTML = `<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>××ª×¨ ××™×•×¦× - WebMaster Pro</title>
    <style>
        body { font-family: 'Arial', sans-serif; margin: 0; padding: 20px; }
        .draggable { border: none !important; }
        .selected { box-shadow: none !important; }
        * { cursor: default !important; }
    </style>
</head>
<body>
${content}
</body>
</html>`;

        const blob = new Blob([fullHTML], { type: 'text/html;charset=utf-8' });
        const url = URL.createObjectURL(blob);
        
        const a = document.createElement('a');
        a.href = url;
        a.download = `website-${new Date().toISOString().slice(0, 10)}.html`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        
        URL.revokeObjectURL(url);
        
        showNotification('×”××ª×¨ ×™×•×¦× ×‘×”×¦×œ×—×”!', 'success');
      } catch (error) {
        console.error('Export error:', error);
        showNotification('×©×’×™××” ×‘×™×™×¦×•×: ' + error.message, 'error');
      }
    }

    // ===== IMAGE HANDLING WITH COMPRESSION =====
    async function compressImageInBrowser(file, quality = 0.8, maxWidth = 1200) {
      return new Promise((resolve) => {
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        const img = new Image();
        
        img.onload = () => {
          // Calculate new dimensions
          let { width, height } = img;
          if (width > maxWidth) {
            height = (height * maxWidth) / width;
            width = maxWidth;
          }
          
          canvas.width = width;
          canvas.height = height;
          
          // Draw and compress
          ctx.drawImage(img, 0, 0, width, height);
          canvas.toBlob(resolve, 'image/jpeg', quality);
        };
        
        img.src = URL.createObjectURL(file);
      });
    }

    async function handleImageUpload(file) {
      if (!file || !file.type.startsWith('image/')) {
        showNotification('×× × ×‘×—×¨ ×§×•×‘×¥ ×ª××•× ×” ×ª×§×™×Ÿ', 'error');
        return;
      }

      const maxSize = 5 * 1024 * 1024; // 5MB
      if (file.size > maxSize) {
        showNotification('×’×•×“×œ ×”×ª××•× ×” ×’×“×•×œ ××“×™ (××§×¡×™××•× 5MB)', 'error');
        return;
      }

      try {
        showNotification('×“×•×—×¡ ×ª××•× ×”...', 'info');
        
        // Compress image in browser
        const compressedFile = await compressImageInBrowser(file, 0.8, 1200);
        const compressionRatio = ((file.size - compressedFile.size) / file.size * 100).toFixed(1);
        
        if (compressionRatio > 0) {
          showNotification(`×ª××•× ×” ×“×•×—×¡×” ×‘-${compressionRatio}%`, 'success');
        }

        // Convert to data URL for use
        const reader = new FileReader();
        reader.onload = (e) => {
          if (selectedElement && selectedElement.tagName === 'IMG') {
            selectedElement.src = e.target.result;
            showNotification('×”×ª××•× ×” ×”×•×—×œ×¤×” ×‘×”×¦×œ×—×”', 'success');
            saveChanges();
          } else {
            // Create new image element
            const img = document.createElement('img');
            img.src = e.target.result;
            img.style.maxWidth = '100%';
            img.style.height = 'auto';
            img.style.borderRadius = '8px';
            img.style.margin = '0.5rem 0';
            img.alt = '×ª××•× ×” ×—×“×©×”';
            
            makeImageReplaceable(img);
            
            const canvas = document.getElementById('canvas-content');
            canvas.appendChild(img);
            
            showNotification('×ª××•× ×” ×—×“×©×” × ×•×¡×¤×”', 'success');
            saveChanges();
          }
        };
        
        reader.readAsDataURL(compressedFile);
        
      } catch (error) {
        console.error('Image processing error:', error);
        showNotification('×©×’×™××” ×‘×¢×™×‘×•×“ ×”×ª××•× ×”', 'error');
      }
    }

    // Advanced image optimization (optional - for future TinyPNG integration)
    async function optimizeImageWithAPI(imageData) {
      try {
        const response = await fetch('/.netlify/functions/compress-image', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ 
            imageData: imageData,
            filename: 'image.jpg'
          })
        });

        const result = await response.json();
        
        if (result.success) {
          return result.compressedData;
        } else {
          throw new Error(result.error);
        }
      } catch (error) {
        console.log('API compression not available, using browser compression');
        return imageData; // Fallback to original
      }
    }

    // ===== ANIMATIONS =====
    function addAnimation(animationType) {
      if (!selectedElement) {
        showNotification('×‘×—×¨ ××œ×× ×˜ ×§×•×“×', 'warning');
        return;
      }

      if (!animationType) return;

      const animations = {
        fadeIn: 'fadeIn 1s ease-in-out',
        slideInLeft: 'slideInLeft 0.8s ease-out',
        bounce: 'bounce 2s infinite',
        pulse: 'pulse 2s infinite'
      };

      selectedElement.style.animation = animations[animationType];
      
      showNotification(`×× ×™××¦×™×” ${animationType} × ×•×¡×¤×”`, 'success');
      saveChanges();
    }

    // ===== RESPONSIVE PREVIEW =====
    function previewMobile() {
      const canvas = document.getElementById('canvas-content');
      canvas.style.width = '375px';
      canvas.style.margin = '0 auto';
      canvas.style.transition = 'all 0.3s ease';
      showNotification('×ª×¦×•×’×ª ××•×‘×™×™×œ', 'info');
    }

    function previewTablet() {
      const canvas = document.getElementById('canvas-content');
      canvas.style.width = '768px';
      canvas.style.margin = '0 auto';
      canvas.style.transition = 'all 0.3s ease';
      showNotification('×ª×¦×•×’×ª ×˜××‘×œ×˜', 'info');
    }

    function previewDesktop() {
      const canvas = document.getElementById('canvas-content');
      canvas.style.width = '100%';
      canvas.style.margin = '0';
      canvas.style.transition = 'all 0.3s ease';
      showNotification('×ª×¦×•×’×ª ×“×¡×§×˜×•×¤', 'info');
    }

    // ===== AI INTEGRATION =====
    async function aiAssistant(prompt) {
      try {
        const response = await window.claude.complete(`
××ª×” ××•××—×” ×¢×™×¦×•×‘ ××ª×¨×™× ×•-UX/UI. ×¢×–×•×¨ ×œ××©×ª××© ×¢× ×”×©××œ×” ×”×‘××”:
${prompt}

×ª×Ÿ ×ª×©×•×‘×” ××•×¢×™×œ×” ×•××§×¦×•×¢×™×ª. ×× ×¦×¨×™×š, ×ª×Ÿ ×’× ×”×¦×¢×•×ª ×œ×©×™×¤×•×¨ ×”×¢×™×¦×•×‘.
        `);
        return response;
      } catch (error) {
        console.error('AI Error:', error);
        return '××¦×˜×¢×¨, ×©×™×¨×•×ª ×”AI ×œ× ×–××™×Ÿ ×›×¨×’×¢. ×‘×“×•×§ ××ª ×”×—×™×‘×•×¨ ×œ-API.';
      }
    }

    function openAIChat() {
      document.getElementById('ai-chat-modal').classList.add('active');
      document.getElementById('ai-input').focus();
    }

    function closeAIChat() {
      document.getElementById('ai-chat-modal').classList.remove('active');
    }

    async function askAI() {
      const input = document.getElementById('ai-input');
      const question = input.value.trim();
      
      if (!question) return;

      // Add user message
      addChatMessage(question, 'user');
      input.value = '';

      // Add loading message
      const loadingMsg = addChatMessage('AI ×—×•×©×‘...', 'ai loading');

      try {
        const response = await aiAssistant(question);
        
        // Remove loading message
        loadingMsg.remove();
        
        // Add AI response
        addChatMessage(response, 'ai');
      } catch (error) {
        loadingMsg.textContent = '×©×’×™××” ×‘×ª×§×©×•×¨×ª ×¢× AI';
        loadingMsg.className = 'chat-message ai error';
      }
    }

    function addChatMessage(message, type) {
      const messagesContainer = document.getElementById('chat-messages');
      const messageEl = document.createElement('div');
      messageEl.className = `chat-message ${type}`;
      messageEl.textContent = message;
      
      const styles = {
        'chat-message': {
          padding: '0.75rem',
          marginBottom: '0.5rem',
          borderRadius: '0.75rem',
          wordWrap: 'break-word',
          maxWidth: '85%'
        },
        'user': {
          background: 'linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%)',
          color: 'white',
          marginLeft: 'auto',
          marginRight: '0'
        },
        'ai': {
          background: 'var(--glass-bg)',
          border: '1px solid var(--glass-border)',
          marginRight: 'auto',
          marginLeft: '0'
        },
        'loading': {
          opacity: '0.7',
          fontStyle: 'italic'
        }
      };
      
      Object.assign(messageEl.style, styles['chat-message']);
      if (type.includes('user')) Object.assign(messageEl.style, styles.user);
      if (type.includes('ai')) Object.assign(messageEl.style, styles.ai);
      if (type.includes('loading')) Object.assign(messageEl.style, styles.loading);
      
      messagesContainer.appendChild(messageEl);
      messagesContainer.scrollTop = messagesContainer.scrollHeight;
      
      return messageEl;
    }

    // ===== MAGIC DESIGN =====
    async function magicDesign() {
      const businessType = prompt('××™×–×” ×¡×•×’ ×¢×¡×§? (×œ×“×•×’××”: ××¡×¢×“×”, ×¨×•×¤×, ×¢×•×¨×š ×“×™×Ÿ, ××¡×¤×¨×”)');
      if (!businessType) return;

      showNotification('AI ×™×•×¦×¨ ×¢×™×¦×•×‘ ××•×ª××...', 'info');
      
      const templates = {
        '××¡×¢×“×”': createRestaurantTemplate(businessType),
        '×¨×•×¤×': createDoctorTemplate(businessType),
        '×¢×•×¨×š ×“×™×Ÿ': createLawyerTemplate(businessType),
        '××¡×¤×¨×”': createSalonTemplate(businessType),
        '×›×•×©×¨': createFitnessTemplate(businessType),
        '× ×“×œ×Ÿ': createRealEstateTemplate(businessType)
      };

      let selectedTemplate = templates['×¨×•×¤×']; // Default

      // Find matching template
      for (const [key, template] of Object.entries(templates)) {
        if (businessType.includes(key)) {
          selectedTemplate = template;
          break;
        }
      }

      saveToHistory();
      
      const canvas = document.getElementById('canvas-content');
      canvas.innerHTML = selectedTemplate;

      // Make all elements editable
      canvas.querySelectorAll('h1, h2, h3, p, button, img').forEach(el => {
        if (el.tagName === 'IMG') {
          makeImageReplaceable(el);
        } else {
          makeElementEditable(el);
        }
      });

      showNotification(`×¢×™×¦×•×‘ ××•×ª×× ×œ${businessType} × ×•×¦×¨!`, 'success');
    }

    function createRestaurantTemplate(businessName) {
      return `
        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 4rem 2rem; text-align: center; color: white; border-radius: 1rem; margin-bottom: 2rem;">
          <h1 style="font-size: 3rem; margin-bottom: 1rem; font-weight: 800;">${businessName}</h1>
          <p style="font-size: 1.3rem; margin-bottom: 2rem; opacity: 0.9;">×—×•×•×™×” ×§×•×œ×™× ×¨×™×ª ×™×•×¦××ª ×“×•×¤×Ÿ</p>
          <button style="background: #ff6b6b; color: white; padding: 1rem 2rem; border: none; border-radius: 25px; font-size: 1.1rem; cursor: pointer; font-weight: 600; box-shadow: 0 4px 15px rgba(0,0,0,0.2);">×”×–××Ÿ ××§×•× ×¢×›×©×™×•</button>
        </div>
        <div style="padding: 3rem 2rem; max-width: 1000px; margin: 0 auto;">
          <h2 style="text-align: center; margin-bottom: 3rem; font-size: 2.5rem; color: #333;">×”×ª×¤×¨×™×˜ ×©×œ× ×•</h2>
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem;">
            <div style="text-align: center; padding: 2rem; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); background: white;">
              <h3 style="color: #667eea; margin-bottom: 1rem;">×× ×•×ª ×¨××©×•× ×•×ª</h3>
              <p style="color: #666;">××‘×—×¨ ×× ×•×ª ×¤×ª×™×—×” ×˜×¨×™×•×ª ×•××¤×ª×™×¢×•×ª ×©××›×™× ×•×ª ××ª ×”×—×™×š ×œ×—×•×•×™×”</p>
            </div>
            <div style="text-align: center; padding: 2rem; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); background: white;">
              <h3 style="color: #667eea; margin-bottom: 1rem;">×× ×•×ª ×¢×™×§×¨×™×•×ª</h3>
              <p style="color: #666;">×× ×•×ª ×¢×™×§×¨×™×•×ª ××¢×•×œ×•×ª ×©××›×™× ×™× ×”×©×¤×™× ×”××•×‘×™×œ×™× ×©×œ× ×•</p>
            </div>
          </div>
        </div>
      `;
    }

    function createDoctorTemplate(businessName) {
      return `
        <div style="background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%); padding: 4rem 2rem; text-align: center; color: white; border-radius: 1rem; margin-bottom: 2rem;">
          <h1 style="font-size: 3rem; margin-bottom: 1rem; font-weight: 800;">${businessName}</h1>
          <p style="font-size: 1.3rem; margin-bottom: 2rem; opacity: 0.9;">×¨×¤×•××” ××ª×§×“××ª ×•××›×¤×ª×™×ª</p>
          <button style="background: #00b894; color: white; padding: 1rem 2rem; border: none; border-radius: 25px; font-size: 1.1rem; cursor: pointer; font-weight: 600; box-shadow: 0 4px 15px rgba(0,0,0,0.2);">×§×‘×¢ ×ª×•×¨ ×¢×›×©×™×•</button>
        </div>
        <div style="padding: 3rem 2rem; max-width: 1000px; margin: 0 auto;">
          <h2 style="text-align: center; margin-bottom: 3rem; font-size: 2.5rem; color: #333;">×”×©×™×¨×•×ª×™× ×©×œ× ×•</h2>
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem;">
            <div style="text-align: center; padding: 2rem; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); background: white;">
              <h3 style="color: #74b9ff; margin-bottom: 1rem;">×‘×“×™×§×•×ª ××§×™×¤×•×ª</h3>
              <p style="color: #666;">××‘×—×•×Ÿ ××“×•×™×§ ×•××”×™×¨ ×¢× ×˜×›× ×•×œ×•×’×™×” ×—×“×™×©×”</p>
            </div>
            <div style="text-align: center; padding: 2rem; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); background: white;">
              <h3 style="color: #74b9ff; margin-bottom: 1rem;">×˜×™×¤×•×œ×™× ××ª×§×“××™×</h3>
              <p style="color: #666;">×©×™×˜×•×ª ×˜×™×¤×•×œ ×—×“×©× ×™×•×ª ×•×™×¢×™×œ×•×ª</p>
            </div>
          </div>
        </div>
      `;
    }

    function createLawyerTemplate(businessName) {
      return `
        <div style="background: linear-gradient(135deg, #2d3748 0%, #1a202c 100%); padding: 4rem 2rem; text-align: center; color: white; border-radius: 1rem; margin-bottom: 2rem;">
          <h1 style="font-size: 3rem; margin-bottom: 1rem; font-weight: 800;">${businessName}</h1>
          <p style="font-size: 1.3rem; margin-bottom: 2rem; opacity: 0.9;">×™×™×¦×•×’ ××©×¤×˜×™ ××§×¦×•×¢×™ ×•×× ×•×¡×”</p>
          <button style="background: #f6ad55; color: #1a202c; padding: 1rem 2rem; border: none; border-radius: 25px; font-size: 1.1rem; cursor: pointer; font-weight: 600; box-shadow: 0 4px 15px rgba(0,0,0,0.2);">×™×¢×•×¥ ××©×¤×˜×™ ×¢×›×©×™×•</button>
        </div>
        <div style="padding: 3rem 2rem; max-width: 1000px; margin: 0 auto;">
          <h2 style="text-align: center; margin-bottom: 3rem; font-size: 2.5rem; color: #333;">×ª×—×•××™ ×”×ª××—×•×ª</h2>
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem;">
            <div style="text-align: center; padding: 2rem; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); background: white;">
              <h3 style="color: #2d3748; margin-bottom: 1rem;">×“×™× ×™ ××©×¤×—×”</h3>
              <p style="color: #666;">×œ×™×•×•×™ ××©×¤×˜×™ ×‘×ª×—×•× ×”××©×¤×—×” ×•×”×’×™×¨×•×©×™×Ÿ</p>
            </div>
            <div style="text-align: center; padding: 2rem; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); background: white;">
              <h3 style="color: #2d3748; margin-bottom: 1rem;">×“×™× ×™ ×¢×‘×•×“×”</h3>
              <p style="color: #666;">×™×™×¦×•×’ ×¢×•×‘×“×™× ×•××¢×¡×™×§×™× ×‘×¡×›×¡×•×›×™ ×¢×‘×•×“×”</p>
            </div>
          </div>
        </div>
      `;
    }

    function createSalonTemplate(businessName) {
      return `
        <div style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); padding: 4rem 2rem; text-align: center; color: white; border-radius: 1rem; margin-bottom: 2rem;">
          <h1 style="font-size: 3rem; margin-bottom: 1rem; font-weight: 800;">${businessName}</h1>
          <p style="font-size: 1.3rem; margin-bottom: 2rem; opacity: 0.9;">×™×•×¤×™ ×•×¡×˜×™×™×œ ×‘×¨××” ×”×’×‘×•×”×” ×‘×™×•×ª×¨</p>
          <button style="background: #4ecdc4; color: white; padding: 1rem 2rem; border: none; border-radius: 25px; font-size: 1.1rem; cursor: pointer; font-weight: 600; box-shadow: 0 4px 15px rgba(0,0,0,0.2);">×§×‘×¢ ×ª×•×¨ ×¢×›×©×™×•</button>
        </div>
        <div style="padding: 3rem 2rem; max-width: 1000px; margin: 0 auto;">
          <h2 style="text-align: center; margin-bottom: 3rem; font-size: 2.5rem; color: #333;">×”×©×™×¨×•×ª×™× ×©×œ× ×•</h2>
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem;">
            <div style="text-align: center; padding: 2rem; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); background: white;">
              <h3 style="color: #f5576c; margin-bottom: 1rem;">×ª×¡×¤×•×¨×ª ×•×¢×™×¦×•×‘</h3>
              <p style="color: #666;">×ª×¡×¤×•×¨×•×ª ××•×“×¨× ×™×•×ª ×•×¢×™×¦×•×‘ ×©×™×¢×¨ ×™×¦×™×¨×ª×™</p>
            </div>
            <div style="text-align: center; padding: 2rem; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); background: white;">
              <h3 style="color: #f5576c; margin-bottom: 1rem;">×˜×™×¤×•×œ×™ ×™×•×¤×™</h3>
              <p style="color: #666;">×˜×™×¤×•×œ×™ ×¤× ×™× ××ª×§×“××™× ×•×¢×™×¦×•×‘ ×’×‘×•×ª</p>
            </div>
          </div>
        </div>
      `;
    }

    function createFitnessTemplate(businessName) {
      return `
        <div style="background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%); padding: 4rem 2rem; text-align: center; color: #333; border-radius: 1rem; margin-bottom: 2rem;">
          <h1 style="font-size: 3rem; margin-bottom: 1rem; font-weight: 800; color: #2d3748;">${businessName}</h1>
          <p style="font-size: 1.3rem; margin-bottom: 2rem; opacity: 0.8;">×”×“×¨×š ×©×œ×š ×œ×—×™×™× ×‘×¨×™××™× ×•×¤×¢×™×œ×™×</p>
          <button style="background: #4299e1; color: white; padding: 1rem 2rem; border: none; border-radius: 25px; font-size: 1.1rem; cursor: pointer; font-weight: 600; box-shadow: 0 4px 15px rgba(0,0,0,0.2);">×”×ª×—×œ ××™××•× ×™×</button>
        </div>
        <div style="padding: 3rem 2rem; max-width: 1000px; margin: 0 auto;">
          <h2 style="text-align: center; margin-bottom: 3rem; font-size: 2.5rem; color: #333;">×”×ª×•×›× ×™×•×ª ×©×œ× ×•</h2>
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem;">
            <div style="text-align: center; padding: 2rem; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); background: white;">
              <h3 style="color: #4299e1; margin-bottom: 1rem;">××™××•× ×™× ××™×©×™×™×</h3>
              <p style="color: #666;">×ª×•×›× ×™×ª ××™××•× ×™× ××•×ª×××ª ××™×©×™×ª ×¢× ××“×¨×™×š ×× ×•×¡×”</p>
            </div>
            <div style="text-align: center; padding: 2rem; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); background: white;">
              <h3 style="color: #4299e1; margin-bottom: 1rem;">×©×™×¢×•×¨×™ ×§×‘×•×¦×”</h3>
              <p style="color: #666;">××™××•× ×™× ×‘×§×‘×•×¦×•×ª ×§×˜× ×•×ª ×‘××•×•×™×¨×” ×ª×•××›×ª ×•××”× ×”</p>
            </div>
          </div>
        </div>
      `;
    }

    function createRealEstateTemplate(businessName) {
      return `
        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 4rem 2rem; text-align: center; color: white; border-radius: 1rem; margin-bottom: 2rem;">
          <h1 style="font-size: 3rem; margin-bottom: 1rem; font-weight: 800;">${businessName}</h1>
          <p style="font-size: 1.3rem; margin-bottom: 2rem; opacity: 0.9;">×”×‘×™×ª ×”×—×“×© ×©×œ×š ××—×›×” ×œ×š</p>
          <button style="background: #48bb78; color: white; padding: 1rem 2rem; border: none; border-radius: 25px; font-size: 1.1rem; cursor: pointer; font-weight: 600; box-shadow: 0 4px 15px rgba(0,0,0,0.2);">×‘×•××• × ××¦× ×‘×™×ª</button>
        </div>
        <div style="padding: 3rem 2rem; max-width: 1000px; margin: 0 auto;">
          <h2 style="text-align: center; margin-bottom: 3rem; font-size: 2.5rem; color: #333;">×”×©×™×¨×•×ª×™× ×©×œ× ×•</h2>
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem;">
            <div style="text-align: center; padding: 2rem; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); background: white;">
              <h3 style="color: #667eea; margin-bottom: 1rem;">××›×™×¨×ª ×“×™×¨×•×ª</h3>
              <p style="color: #666;">××›×™×¨×” ××§×¦×•×¢×™×ª ×¢× ×”×¢×¨×›×ª ×©×•×•×™ ××“×•×™×§×ª</p>
            </div>
            <div style="text-align: center; padding: 2rem; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); background: white;">
              <h3 style="color: #667eea; margin-bottom: 1rem;">×”×©×›×¨×ª × ×›×¡×™×</h3>
              <p style="color: #666;">×”×©×›×¨×” ×¢× ×œ×™×•×•×™ ××œ× ×•××¦×™××ª ×“×™×™×¨×™× ××™×›×•×ª×™×™×</p>
            </div>
          </div>
        </div>
      `;
    }

    // ===== VIDEO EDITOR =====
    class VideoEditor {
      constructor() {
        this.videoElement = null;
        this.overlays = [];
        this.startTime = 0;
        this.endTime = 0;
      }

      init() {
        this.videoElement = document.getElementById('video-preview');
        this.overlaysContainer = document.getElementById('video-overlays');
      }

      handleUpload(file) {
        if (!file || !file.type.startsWith('video/')) {
          showNotification('×× × ×‘×—×¨ ×§×•×‘×¥ ×•×™×“××• ×ª×§×™×Ÿ', 'error');
          return;
        }

        if (file.size > 100 * 1024 * 1024) { // 100MB limit
          showNotification('×§×•×‘×¥ ×”×•×™×“××• ×’×“×•×œ ××“×™ (××§×¡×™××•× 100MB)', 'error');
          return;
        }

        this.videoElement.src = URL.createObjectURL(file);
        this.videoElement.onloadedmetadata = () => {
          this.endTime = this.videoElement.duration;
          showNotification(`×•×™×“××• ×”×•×¢×œ×” ×‘×”×¦×œ×—×” (${Math.round(this.endTime)} ×©× ×™×•×ª)`, 'success');
        };
      }

      trim() {
        if (!this.videoElement.src) {
          showNotification('×× × ×”×¢×œ×” ×•×™×“××• ×ª×—×™×œ×”', 'warning');
          return;
        }

        const start = parseFloat(prompt('×©× ×™×™×” ×”×ª×—×œ×”:', '0') || '0');
        const end = parseFloat(prompt('×©× ×™×™×” ×¡×™×•×:', this.videoElement.duration) || this.videoElement.duration);

        if (start >= 0 && end > start && end <= this.videoElement.duration) {
          this.startTime = start;
          this.endTime = end;
          this.videoElement.currentTime = start;
          
          // Visual indicator for trim range
          this.showTrimIndicator(start, end);
          
          showNotification(`×•×™×“××• × ×—×ª×š: ${start.toFixed(1)}-${end.toFixed(1)} ×©× ×™×•×ª`, 'success');
        } else {
          showNotification('×–×× ×™× ×œ× ×ª×§×™× ×™×', 'error');
        }
      }

      showTrimIndicator(start, end) {
        // Create a simple trim indicator
        const indicator = document.createElement('div');
        indicator.style.cssText = `
          position: absolute;
          bottom: 10px;
          left: 10px;
          background: rgba(0,0,0,0.8);
          color: white;
          padding: 5px 10px;
          border-radius: 5px;
          font-size: 12px;
          z-index: 10;
        `;
        indicator.textContent = `×—×ª×•×š: ${start.toFixed(1)}s - ${end.toFixed(1)}s`;
        
        this.overlaysContainer.appendChild(indicator);
        
        // Remove after 3 seconds
        setTimeout(() => indicator.remove(), 3000);
      }

      addText() {
        if (!this.videoElement.src) {
          showNotification('×× × ×”×¢×œ×” ×•×™×“××• ×ª×—×™×œ×”', 'warning');
          return;
        }

        const text = prompt('×”×›× ×¡ ×˜×§×¡×˜:');
        if (!text) return;

        const x = parseInt(prompt('××™×§×•× X (0-100%):', '50') || '50');
        const y = parseInt(prompt('××™×§×•× Y (0-100%):', '50') || '50');

        const textOverlay = document.createElement('div');
        textOverlay.style.cssText = `
          position: absolute;
          top: ${y}%;
          left: ${x}%;
          transform: translate(-50%, -50%);
          color: white;
          font-size: 24px;
          font-weight: bold;
          text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
          background: rgba(0,0,0,0.5);
          padding: 10px 15px;
          border-radius: 8px;
          z-index: 10;
          cursor: pointer;
        `;
        textOverlay.textContent = text;
        
        // Click to remove
        textOverlay.onclick = () => {
          if (confirm('×”×× ×œ××—×•×§ ××ª ×”×˜×§×¡×˜?')) {
            textOverlay.remove();
            this.overlays = this.overlays.filter(o => o !== textOverlay);
          }
        };

        this.overlaysContainer.appendChild(textOverlay);
        this.overlays.push(textOverlay);
        
        showNotification('×˜×§×¡×˜ × ×•×¡×£ ×œ×•×™×“××•', 'success');
      }

      addFilter() {
        if (!this.videoElement.src) {
          showNotification('×× × ×”×¢×œ×” ×•×™×“××• ×ª×—×™×œ×”', 'warning');
          return;
        }

        const filters = {
          'none': 'none',
          'grayscale': 'grayscale(100%)',
          'sepia': 'sepia(100%)',
          'blur': 'blur(2px)',
          'brightness': 'brightness(1.5)',
          'contrast': 'contrast(1.5)',
          'saturate': 'saturate(2)'
        };

        const filterName = prompt('×‘×—×¨ ×¤×™×œ×˜×¨:\n' + Object.keys(filters).join('\n'), 'none');
        
        if (filters[filterName]) {
          this.videoElement.style.filter = filters[filterName];
          showNotification(`×¤×™×œ×˜×¨ ${filterName} ×”×•×—×œ`, 'success');
        }
      }

      export() {
        if (!this.videoElement.src) {
          showNotification('×× × ×”×¢×œ×” ×•×™×“××• ×ª×—×™×œ×”', 'warning');
          return;
        }

        // Create canvas for frame export
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        
        canvas.width = this.videoElement.videoWidth || 640;
        canvas.height = this.videoElement.videoHeight || 480;

        // Draw current frame
        ctx.drawImage(this.videoElement, 0, 0, canvas.width, canvas.height);

        // Add text overlays to canvas
        this.overlays.forEach(overlay => {
          const rect = overlay.getBoundingClientRect();
          const videoRect = this.videoElement.getBoundingClientRect();
          
          const x = (rect.left - videoRect.left) / videoRect.width * canvas.width;
          const y = (rect.top - videoRect.top) / videoRect.height * canvas.height;
          
          ctx.fillStyle = 'white';
          ctx.font = '24px Arial';
          ctx.strokeStyle = 'black';
          ctx.lineWidth = 2;
          ctx.strokeText(overlay.textContent, x, y);
          ctx.fillText(overlay.textContent, x, y);
        });

        // Export as image (frame)
        canvas.toBlob((blob) => {
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = `video-frame-${Date.now()}.png`;
          a.click();
          URL.revokeObjectURL(url);
          
          showNotification('×¤×¨×™×™× × ×•×›×—×™ ×™×•×¦× ×‘×”×¦×œ×—×”', 'success');
        });
      }
    }

    function openVideoEditor() {
      document.getElementById('video-editor-modal').classList.add('active');
      if (!videoEditor) {
        videoEditor = new VideoEditor();
        videoEditor.init();
      }
    }

    function closeVideoEditor() {
      document.getElementById('video-editor-modal').classList.remove('active');
    }

    function handleVideoUpload(file) {
      if (videoEditor) {
        videoEditor.handleUpload(file);
      }
    }

    function trimVideo() {
      if (videoEditor) {
        videoEditor.trim();
      }
    }

    function addVideoText() {
      if (videoEditor) {
        videoEditor.addText();
      }
    }

    function addVideoFilter() {
      if (videoEditor) {
        videoEditor.addFilter();
      }
    }

    function exportVideo() {
      if (videoEditor) {
        videoEditor.export();
      }
    }

    // ===== OPTIMIZATION AND SEO =====
    function optimizeWebsite() {
      showNotification('××ª×—×™×œ ××•×¤×˜×™××™×–×¦×™×”...', 'info');
      
      const canvas = document.getElementById('canvas-content');
      let optimizations = 0;

      // Optimize images
      canvas.querySelectorAll('img').forEach(img => {
        if (img.naturalWidth > 1200) {
          img.style.maxWidth = '100%';
          img.style.height = 'auto';
          img.loading = 'lazy';
          optimizations++;
        }
      });

      // Add meta viewport if missing
      if (!document.querySelector('meta[name="viewport"]')) {
        const viewport = document.createElement('meta');
        viewport.name = 'viewport';
        viewport.content = 'width=device-width, initial-scale=1.0';
        document.head.appendChild(viewport);
        optimizations++;
      }

      // Optimize CSS (remove unused styles)
      const styles = document.querySelectorAll('style');
      styles.forEach(style => {
        if (style.textContent.trim() === '') {
          style.remove();
          optimizations++;
        }
      });

      showNotification(`××•×¤×˜×™××™×–×¦×™×” ×”×•×©×œ××”! ${optimizations} ×©×™×¤×•×¨×™× ×‘×•×¦×¢×•`, 'success');
    }

    function generateSEO() {
      showNotification('×™×•×¦×¨ SEO ××•×˜×•××˜×™...', 'info');
      
      const canvas = document.getElementById('canvas-content');
      
      // Extract title from first h1
      const h1 = canvas.querySelector('h1');
      const title = h1 ? h1.textContent.trim() : '××ª×¨ ××§×¦×•×¢×™';
      
      // Extract description from first paragraph
      const firstP = canvas.querySelector('p');
      const description = firstP ? firstP.textContent.trim().substring(0, 160) : '××ª×¨ ××§×¦×•×¢×™ ×©× ×‘× ×” ×¢× WebMaster Pro';

      // Update document title
      document.title = title;

      // Add or update meta description
      let metaDesc = document.querySelector('meta[name="description"]');
      if (!metaDesc) {
        metaDesc = document.createElement('meta');
        metaDesc.name = 'description';
        document.head.appendChild(metaDesc);
      }
      metaDesc.content = description;

      // Add Open Graph tags
      const ogTags = [
        { property: 'og:title', content: title },
        { property: 'og:description', content: description },
        { property: 'og:type', content: 'website' },
        { property: 'og:locale', content: 'he_IL' }
      ];

      ogTags.forEach(tag => {
        let ogTag = document.querySelector(`meta[property="${tag.property}"]`);
        if (!ogTag) {
          ogTag = document.createElement('meta');
          ogTag.setAttribute('property', tag.property);
          document.head.appendChild(ogTag);
        }
        ogTag.content = tag.content;
      });

      // Add structured data (JSON-LD)
      const structuredData = {
        "@context": "https://schema.org",
        "@type": "Organization",
        "name": title,
        "description": description,
        "url": window.location.href
      };

      let scriptTag = document.querySelector('script[type="application/ld+json"]');
      if (!scriptTag) {
        scriptTag = document.createElement('script');
        scriptTag.type = 'application/ld+json';
        document.head.appendChild(scriptTag);
      }
      scriptTag.textContent = JSON.stringify(structuredData, null, 2);

      // Add alt texts to images without them
      canvas.querySelectorAll('img:not([alt])').forEach((img, index) => {
        img.alt = `×ª××•× ×” ${index + 1} - ${title}`;
      });

      showNotification('SEO tags × ×•×¦×¨×• ×‘×”×¦×œ×—×”!', 'success');
    }

    // ===== UTILITY FUNCTIONS =====
    function rgbToHex(rgb) {
      if (rgb.startsWith('#')) return rgb;
      
      const result = rgb.match(/\d+/g);
      if (!result || result.length < 3) return '#000000';
      
      return '#' + result.slice(0, 3).map(num => {
        const hex = parseInt(num).toString(16);
        return hex.length === 1 ? '0' + hex : hex;
      }).join('');
    }

    // ===== KEYBOARD SHORTCUTS =====
    function initKeyboardShortcuts() {
      document.addEventListener('keydown', (e) => {
        // Ctrl+S - Save
        if (e.ctrlKey && e.key === 's') {
          e.preventDefault();
          saveChanges();
        }
        
        // Ctrl+Z - Undo
        if (e.ctrlKey && e.key === 'z' && !e.shiftKey) {
          e.preventDefault();
          undoAction();
        }
        
        // Ctrl+Shift+Z or Ctrl+Y - Redo
        if ((e.ctrlKey && e.shiftKey && e.key === 'Z') || (e.ctrlKey && e.key === 'y')) {
          e.preventDefault();
          redoAction();
        }
        
        // Delete - Remove selected element
        if (e.key === 'Delete' && selectedElement) {
          e.preventDefault();
          if (confirm('×”×× ×œ××—×•×§ ××ª ×”××œ×× ×˜ ×”× ×‘×—×¨?')) {
            selectedElement.remove();
            selectedElement = null;
            saveChanges();
            showNotification('××œ×× ×˜ × ××—×§', 'success');
          }
        }
        
        // Escape - Deselect
        if (e.key === 'Escape' && selectedElement) {
          selectedElement.classList.remove('selected');
          selectedElement = null;
          showNotification('×”×‘×—×™×¨×” ×‘×•×˜×œ×”', 'info');
        }
      });
    }

    // ===== INITIALIZATION =====
    function initWebsitesList() {
      const container = document.querySelector('.websites-list');
      container.innerHTML = '';
      
      websites.forEach(website => {
        const item = document.createElement('div');
        item.className = 'website-item';
        item.onclick = () => loadWebsiteDirectly(website.id);
        
        item.innerHTML = `
          <img src="${website.image}" alt="${website.name}" loading="lazy">
          <div class="website-info">
            <div class="website-name">${website.name}</div>
            <div class="website-price">${website.price}</div>
          </div>
        `;
        
        container.appendChild(item);
      });
    }

    function initBlocksList() {
      const container = document.querySelector('.blocks-list');
      container.innerHTML = '';
      
      blockTypes.forEach(block => {
        const item = document.createElement('div');
        item.className = 'block-item';
        item.draggable = true;
        item.dataset.type = block.type;
        
        item.innerHTML = `
          <div class="block-icon">
            <i class="${block.icon}"></i>
          </div>
          <span>${block.name}</span>
        `;
        
        // Add drag start event
        item.addEventListener('dragstart', (e) => {
          e.dataTransfer.setData('block-type', block.type);
          e.dataTransfer.effectAllowed = 'copy';
        });
        
        container.appendChild(item);
      });
    }

    async function initializeEditor() {
      try {
        // Initialize user session (basic for now)
        currentUserId = localStorage.getItem('webmaster_user_id') || generateUserId();
        localStorage.setItem('webmaster_user_id', currentUserId);
        
        // Initialize components
        initWebsitesList();
        initBlocksList();
        initDragAndDrop();
        initKeyboardShortcuts();
        
        // Test Supabase connection
        await testSupabaseConnection();
        
        // Load saved website if exists
        const savedContent = localStorage.getItem('webmaster_pro_current_site');
        if (savedContent) {
          const shouldLoad = confirm('× ××¦× ××ª×¨ ×©××•×¨. ×”×× ×œ×˜×¢×•×Ÿ ××•×ª×•?');
          if (shouldLoad) {
            document.getElementById('canvas-content').innerHTML = savedContent;
            reinitializeEditableElements();
            showNotification('××ª×¨ ×©××•×¨ × ×˜×¢×Ÿ', 'success');
          }
        }
        
        // Welcome message
        setTimeout(() => {
          showNotification('×‘×¨×•×›×™× ×”×‘××™× ×œ-WebMaster Pro! ×‘×—×¨ ××ª×¨ ××”×¨×©×™××” ×›×“×™ ×œ×”×ª×—×™×œ', 'info');
        }, 1000);
        
        console.log('ğŸš€ WebMaster Pro Editor initialized successfully!');
        console.log('ğŸ“Š Available websites:', websites.length);
        console.log('ğŸ§© Available blocks:', blockTypes.length);
        console.log('ğŸ‘¤ User ID:', currentUserId);
        
      } catch (error) {
        console.error('Initialization error:', error);
        showNotification('×©×’×™××” ×‘××ª×—×•×œ ×”××“×™×˜×•×¨', 'error');
      }
    }

    function generateUserId() {
      return 'user_' + Math.random().toString(36).substr(2, 9) + '_' + Date.now().toString(36);
    }

    async function testSupabaseConnection() {
      try {
        showNotification('×‘×•×“×§ ×—×™×‘×•×¨ ×œ×©×¨×ª...', 'info');
        
        const response = await fetch('/.netlify/functions/list-websites');
        const result = await response.json();
        
        if (response.ok) {
          showNotification('×—×™×‘×•×¨ ×œ×©×¨×ª ×ª×§×™×Ÿ âœ…', 'success');
          console.log('âœ… Supabase connection OK');
        } else {
          throw new Error(result.error);
        }
        
      } catch (error) {
        console.warn('âš ï¸ Supabase connection failed:', error);
        showNotification('×—×™×‘×•×¨ ×œ×©×¨×ª × ×›×©×œ - ×¢×•×‘×“ ×‘××¦×‘ ××§×•××™', 'warning');
      }
    }

    // Start the application
    document.addEventListener('DOMContentLoaded', initializeEditor);

    // Auto-save every 30 seconds
    setInterval(() => {
      if (document.getElementById('canvas-content').innerHTML.trim() !== '') {
        const content = document.getElementById('canvas-content').innerHTML;
        localStorage.setItem('webmaster_pro_autosave', content);
        localStorage.setItem('webmaster_pro_autosave_time', new Date().toISOString());
      }
    }, 30000);

    // Prevent accidental page leave
    window.addEventListener('beforeunload', (e) => {
      const content = document.getElementById('canvas-content').innerHTML;
      const saved = localStorage.getItem('webmaster_pro_current_site') || '';
      
      if (content !== saved && content.trim() !== '') {
        e.preventDefault();
        e.returnValue = '×™×© ×œ×š ×©×™× ×•×™×™× ×©×œ× × ×©××¨×•. ×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ×¢×–×•×‘?';
        return e.returnValue;
      }
    });

    // Global error handler
    window.addEventListener('error', (e) => {
      console.error('Global error:', e.error);
      showNotification('××™×¨×¢×” ×©×’×™××” ×œ× ×¦×¤×•×™×”. ×‘×“×•×§ ××ª ×”×§×•× ×¡×•×œ ×œ×¤×¨×˜×™× × ×•×¡×¤×™×.', 'error');
    });

    // Performance monitoring
    if ('performance' in window) {
      window.addEventListener('load', () => {
        const loadTime = performance.now();
        console.log(`âš¡ Editor loaded in ${loadTime.toFixed(2)}ms`);
      });
    }
  </script>
</body>
</html>
