import React, { useState, useEffect, useRef } from 'react';
import { 
  Edit3, 
  Type, 
  Image, 
  Palette, 
  Layout, 
  Smartphone, 
  Monitor, 
  Tablet,
  Save,
  Eye,
  Wand2,
  Brain,
  Sparkles,
  MessageSquare,
  Download,
  Settings,
  RotateCcw,
  RotateCw,
  Layers,
  Grid,
  Zap
} from 'lucide-react';

// Load Google Fonts
const loadGoogleFonts = () => {
  const link = document.createElement('link');
  link.href = 'https://fonts.googleapis.com/css2?family=Assistant:wght@300;400;500;600;700&family=Heebo:wght@300;400;500;600;700&family=Rubik:wght@300;400;500;600;700&family=Open+Sans:wght@300;400;500;600;700&family=Montserrat:wght@300;400;500;600;700&family=Poppins:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700&family=Roboto:wght@300;400;500;600;700&display=swap';
  link.rel = 'stylesheet';
  document.head.appendChild(link);
};

const WebMasterProEditor = () => {
  // Load fonts on component mount
  useEffect(() => {
    loadGoogleFonts();
  }, []);

  const [selectedElement, setSelectedElement] = useState(null);
  const [aiMode, setAiMode] = useState(false);
  const [device, setDevice] = useState('desktop');
  const [activePanel, setActivePanel] = useState('sites');
  const [aiChat, setAiChat] = useState([]);
  const [aiInput, setAiInput] = useState('');
  const [isAiProcessing, setIsAiProcessing] = useState(false);
  const [previewMode, setPreviewMode] = useState(false);
  const [currentSite, setCurrentSite] = useState('medical-aesthetic');
  const [isEditing, setIsEditing] = useState(null);
  const [siteData, setSiteData] = useState({});
  const [selectedFont, setSelectedFont] = useState('Assistant');
  const [selectedColor, setSelectedColor] = useState('#000000');
  const [fontSize, setFontSize] = useState(16);
  const [lastSaved, setLastSaved] = useState(null);
  const previewRef = useRef(null);

  // Available fonts
  const availableFonts = [
    { name: 'Assistant', value: 'Assistant, sans-serif', type: '×¢×‘×¨×™×ª ××•×“×¨× ×™' },
    { name: 'Heebo', value: 'Heebo, sans-serif', type: '×¢×‘×¨×™×ª × ×§×™' },
    { name: 'Rubik', value: 'Rubik, sans-serif', type: '×¢×‘×¨×™×ª ×¢×’×•×œ' },
    { name: 'Open Sans', value: 'Open Sans, sans-serif', type: '×× ×’×œ×™×ª ×§×œ××¡×™' },
    { name: 'Montserrat', value: 'Montserrat, sans-serif', type: '××•×“×¨× ×™ ××œ×’× ×˜×™' },
    { name: 'Poppins', value: 'Poppins, sans-serif', type: '×˜×¨× ×“×™ ×•×¢×›×©×•×•×™' }
  ];

  // Color palettes
  const colorPalettes = {
    medical: ['#EC4899', '#F472B6', '#FBE2E3', '#1F2937', '#6B7280'],
    business: ['#3B82F6', '#60A5FA', '#DBEAFE', '#1F2937', '#6B7280'],
    fitness: ['#EF4444', '#F87171', '#FEE2E2', '#1F2937', '#6B7280'],
    legal: ['#6B7280', '#9CA3AF', '#F3F4F6', '#1F2937', '#374151'],
    creative: ['#8B5CF6', '#A78BFA', '#EDE9FE', '#1F2937', '#6B7280'],
    nature: ['#10B981', '#34D399', '#D1FAE5', '#1F2937', '#6B7280']
  };

  // Real WebMaster Pro Sites - Simplified for demo
  const demoSites = {
    'medical-aesthetic': {
      name: '×“"×¨ ××™×›×œ ×¨×•×–×Ÿ - ×¨×¤×•××” ××¡×ª×˜×™×ª',
      category: '×¨×¤×•××”',
      price: 'â‚ª2,800',
      color: '#EC4899',
      palette: 'medical',
      content: {
        hero: {
          title: '×“"×¨ ××™×›×œ ×¨×•×–×Ÿ',
          subtitle: '×¨×¤×•××” ××¡×ª×˜×™×ª ×•×˜×™×¤×•×œ×™ ×™×•×¤×™ ××ª×§×“××™×',
          description: '××•××—×™×ª ×‘×¨×¤×•××” ××¡×ª×˜×™×ª ×¢× × ×™×¡×™×•×Ÿ ×©×œ ××¢×œ 15 ×©× ×”. ××ª××—×” ×‘×˜×™×¤×•×œ×™ ×‘×•×˜×•×§×¡, ××™×œ×•×™ ×§××˜×™× ×•×˜×™×¤×•×œ×™ ×¢×•×¨ ××ª×§×“××™×.',
          cta: '×§×‘×¢×™ ×ª×•×¨ ×œ×™×™×¢×•×¥ ×—×™× ×'
        },
        services: [
          { title: '×˜×™×¤×•×œ×™ ×‘×•×˜×•×§×¡', desc: '×”×–×¨×§×•×ª ×‘×•×˜×•×§×¡ ××§×¦×•×¢×™×•×ª ×œ×× ×™×¢×ª ×”×–×“×§× ×•×ª', price: 'â‚ª800-1,200', icon: 'ğŸ’‰' },
          { title: '××™×œ×•×™ ×§××˜×™×', desc: '×˜×™×¤×•×œ×™ ×”×™××œ×•×¨×•×Ÿ ××™×›×•×ª×™×™× ×œ××™×œ×•×™ ×•×—×™×“×•×© × ×¤×—', price: 'â‚ª1,000-2,000', icon: 'ğŸ’‹' },
          { title: '×˜×™×¤×•×œ×™ ×¢×•×¨', desc: '×¤×™×œ×™× ×’ ×›×™××™ ×•××™×§×¨×•-× ×™×™×“×œ×™× ×’ ×œ×©×™×¤×•×¨ ××¨×§× ×”×¢×•×¨', price: 'â‚ª600-1,500', icon: 'âœ¨' }
        ],
        contact: {
          phone: '03-1234567',
          whatsapp: '052-1234567',
          email: 'info@dr-rosen.co.il',
          address: '×¨×—×•×‘ ×“×™×–× ×’×•×£ 100, ×ª×œ ××‘×™×‘',
          hours: '×¨××©×•×Ÿ-×—××™×©×™: 9:00-19:00'
        }
      }
    },
    'fitness-pro': {
      name: '×“× ×™ ×¤×™×˜ - ××××Ÿ ×›×•×©×¨',
      category: '×›×•×©×¨',
      price: 'â‚ª2,200',
      color: '#EF4444',
      palette: 'fitness',
      content: {
        hero: {
          title: '×“× ×™ ×¤×™×˜',
          subtitle: '××××Ÿ ×›×•×©×¨ ××™×©×™ ××§×¦×•×¢×™',
          description: '××××Ÿ ×›×•×©×¨ ××•×¡××š ×¢× × ×™×¡×™×•×Ÿ ×©×œ 10+ ×©× ×”. ××ª××—×” ×‘××™××•× ×™× ××™×©×™×™× ×•×ª×•×›× ×™×•×ª ×›×•×©×¨ ××•×ª×××•×ª.',
          cta: '×”×ª×—×œ ××ª ×”××¡×¢ ×©×œ×š'
        },
        services: [
          { title: '××™××•×Ÿ ××™×©×™', desc: '××™××•× ×™× ××™×©×™×™× ××•×ª×××™× ×œ×¨××ª×š ×•×œ××˜×¨×•×ª ×©×œ×š', price: 'â‚ª250 ×œ××™××•×Ÿ', icon: 'ğŸ’ª' },
          { title: '×ª×•×›× ×™×•×ª ×›×•×©×¨', desc: '×ª×•×›× ×™×•×ª ××™××•×Ÿ ××§×¦×•×¢×™×•×ª ×œ×‘×™×ª ××• ×—×“×¨ ×›×•×©×¨', price: 'â‚ª399 ×œ×—×•×“×©', icon: 'ğŸ ' },
          { title: '×™×™×¢×•×¥ ×ª×–×•× ×ª×™', desc: '×ª×¤×¨×™×˜×™× ×‘×¨×™××™× ×•××•×ª×××™× ××™×©×™×ª', price: 'â‚ª199 ×œ×—×•×“×©', icon: 'ğŸ¥—' }
        ],
        contact: {
          phone: '03-9876543',
          whatsapp: '052-9876543',
          email: 'danny@fitnessco.co.il',
          address: '××¨×›×– ×›×•×©×¨ ×¤×¨×™××™×•×, ×¨××ª ×’×Ÿ',
          hours: '×¨××©×•×Ÿ-×—××™×©×™: 6:00-22:00'
        }
      }
    },
    'law-firm': {
      name: '××©×¨×“ ×‘×¨×§×•×‘×™×¥ - ×¢×•×¨×›×™ ×“×™×Ÿ',
      category: '××©×¤×˜×™',
      price: 'â‚ª2,500',
      color: '#6B7280',
      palette: 'legal',
      content: {
        hero: {
          title: '××©×¨×“ ×‘×¨×§×•×‘×™×¥',
          subtitle: '×¢×•×¨×›×™ ×“×™×Ÿ ××§×¦×•×¢×™×™× ×•×× ×•×¡×™×',
          description: '××©×¨×“ ×¢×•×¨×›×™ ×“×™×Ÿ ××•×‘×™×œ ×¢× × ×™×¡×™×•×Ÿ ×©×œ 25+ ×©× ×”. ××ª××—×” ×‘×“×™× ×™ ×—×‘×¨×•×ª, × ×“×œ"×Ÿ ×•××©×¤×—×”.',
          cta: '×§×‘×¢ ×™×™×¢×•×¥ ××©×¤×˜×™'
        },
        services: [
          { title: '×“×™× ×™ ×—×‘×¨×•×ª', desc: '×™×™×¢×•×¥ ××©×¤×˜×™ ××§×¦×•×¢×™ ×œ×”×§××ª ×—×‘×¨×•×ª ×•×”×¡×›××™× ×¢×¡×§×™×™×', price: '×™×™×¢×•×¥ ×œ×œ× ×¢×œ×•×ª', icon: 'ğŸ¢' },
          { title: '×“×™× ×™ × ×“×œ"×Ÿ', desc: '×œ×™×•×•×™ ××©×¤×˜×™ ××œ× ×‘×¢×¡×§××•×ª ×§× ×™×™×” ×•××›×™×¨×”', price: '×œ×¤×™ ×”×¡×›×', icon: 'ğŸ ' },
          { title: '×“×™× ×™ ××©×¤×—×”', desc: '×˜×™×¤×•×œ ××§×¦×•×¢×™ ×•×¨×’×™×© ×‘×¢× ×™×™× ×™ ×’×™×¨×•×©×™×Ÿ ×•××©××•×¨×ª', price: '×™×™×¢×•×¥ ×¨××©×•× ×™ ×—×™× ×', icon: 'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦' }
        ],
        contact: {
          phone: '03-6666666',
          email: 'office@barkowitz-law.co.il',
          address: '×¨×—×•×‘ ×”××¨×‘×¢×” 12, ×ª×œ ××‘×™×‘',
          hours: '×¨××©×•×Ÿ-×—××™×©×™: 8:30-17:30'
        }
      }
    }
  };

  // Initialize site data and update on site change
  useEffect(() => {
    const newSiteData = demoSites[currentSite];
    if (newSiteData) {
      setSiteData(newSiteData);
      setIsEditing(null);
      setSelectedElement(null);
      setAiChat([]);
    }
  }, [currentSite]);

  // Auto-save functionality
  useEffect(() => {
    const saveData = () => {
      if (siteData && Object.keys(siteData).length > 0) {
        localStorage.setItem('webmaster-site-data', JSON.stringify(siteData));
        setLastSaved(new Date());
      }
    };
    
    const timer = setTimeout(saveData, 2000);
    return () => clearTimeout(timer);
  }, [siteData]);

  // Update site content
  const updateContent = (path, value) => {
    setSiteData(prev => {
      const newData = { ...prev };
      const keys = path.split('.');
      let current = newData;
      
      for (let i = 0; i < keys.length - 1; i++) {
        if (!current[keys[i]]) current[keys[i]] = {};
        current = current[keys[i]];
      }
      
      current[keys[keys.length - 1]] = value;
      return newData;
    });
  };

  // Text editing functions
  const startEditing = (elementId) => {
    setIsEditing(elementId);
    setSelectedElement(elementId);
  };

  const stopEditing = () => {
    setIsEditing(null);
  };

  const handleTextChange = (path, value) => {
    updateContent(path, value);
  };

  // AI Chat with Claude
  const sendToAI = async () => {
    if (!aiInput.trim() || isAiProcessing) return;
    
    setIsAiProcessing(true);
    const userMessage = aiInput;
    setAiInput('');
    
    setAiChat(prev => [...prev, { type: 'user', content: userMessage }]);
    
    try {
      const currentSiteInfo = siteData;
      const prompt = `
        ×× ×™ ×¢×•×‘×“ ×¢×œ ×¢×¨×™×›×ª ××ª×¨ ×‘-WebMaster Pro ×¢×‘×•×¨ "${currentSiteInfo.name}".
        
        ×¤×¨×˜×™ ×”××ª×¨:
        - ×©×: ${currentSiteInfo.name}
        - ×§×˜×’×•×¨×™×”: ${currentSiteInfo.category}
        - ××—×™×¨: ${currentSiteInfo.price}
        - ×¦×‘×¢ ×¨××©×™: ${currentSiteInfo.color}
        
        ×”×©××œ×”/×‘×§×©×” ×©×œ×™: ${userMessage}
        
        ×ª×Ÿ ×œ×™ ×ª×©×•×‘×” ××¢×©×™×ª ×•×¡×¤×¦×™×¤×™×ª ×©×ª×¢×–×•×¨ ×œ×™ ×œ×©×¤×¨ ××ª ×”××ª×¨ ×”×–×” ×‘×“×™×•×§.
        ×ª×©×•×‘×” ×§×¦×¨×”, ××§×¦×•×¢×™×ª ×•××•×ª×××ª ×œ×¢×¡×§ ×”×¡×¤×¦×™×¤×™:
      `;
      
      const response = await window.claude.complete(prompt);
      setAiChat(prev => [...prev, { type: 'ai', content: response }]);
      
    } catch (error) {
      setAiChat(prev => [...prev, { 
        type: 'ai', 
        content: '××¦×˜×¢×¨, ×™×© ×‘×¢×™×” ×‘×—×™×‘×•×¨ ×œ-AI. × ×¡×” ×©×•×‘ ×‘×¢×•×“ ×¨×’×¢.' 
      }]);
    }
    
    setIsAiProcessing(false);
  };

  // Quick AI Actions
  const quickAIActions = [
    { 
      icon: 'âœï¸', 
      text: `×›×ª×‘ ×ª×•×›×Ÿ ×¢×‘×•×¨ ${siteData.category}`,
      prompt: `×›×ª×•×‘ ×ª×•×›×Ÿ ××§×¦×•×¢×™ ×œ×“×£ ×”×‘×™×ª ×©×œ ${siteData.name} (${siteData.category})`
    },
    { 
      icon: 'ğŸ¨', 
      text: `×¦×‘×¢×™× ××ª××™××™× ×œ${siteData.category}`,
      prompt: `×”×¦×¢ ×¤×œ×˜×ª ×¦×‘×¢×™× ××§×¦×•×¢×™×ª ×œ××¢×¡×§ ××¡×•×’ ${siteData.category}`
    },
    { 
      icon: 'ğŸ“¸', 
      text: `×¨×¢×™×•× ×•×ª ×ª××•× ×•×ª`,
      prompt: `×”×¦×¢ ×¨×¢×™×•× ×•×ª ×œ×ª××•× ×•×ª ××§×¦×•×¢×™×•×ª ×œ××ª×¨ ${siteData.name}`
    },
    { 
      icon: 'ğŸ”', 
      text: `SEO ××•×ª××`,
      prompt: `×ª×Ÿ ×”××œ×¦×•×ª SEO ×œ×¢×¡×§ ${siteData.name} ×‘×ª×—×•× ${siteData.category}`
    }
  ];

  const executeQuickAction = async (action) => {
    setAiInput(action.prompt);
    setTimeout(() => sendToAI(), 100);
  };

  // Basic tools
  const basicTools = {
    sites: [
      {
        icon: Grid,
        name: '× ×™×”×•×œ ××ª×¨×™×',
        desc: `${Object.keys(demoSites).length} ××ª×¨×™× ×‘××¢×¨×›×ª`,
        action: () => setActivePanel('sites')
      }
    ],
    text: [
      { icon: Type, name: '×¢×¨×™×›×ª ×˜×§×¡×˜', desc: '×©×™× ×•×™ ×ª×•×›×Ÿ ×•×›×•×ª×¨×•×ª', action: () => setActivePanel('text') },
      { icon: Edit3, name: '×¢×™×¦×•×‘ ×¤×•× ×˜×™×', desc: '×’×•×“×œ, ×¦×‘×¢, ×¡×’× ×•×Ÿ', action: () => setActivePanel('text') }
    ],
    design: [
      { icon: Palette, name: '×¦×‘×¢×™× ×•×’×¨×“×™×× ×˜×™×', desc: '×¤×œ×˜×•×ª ××•×›× ×•×ª', action: () => setActivePanel('design') },
      { icon: Image, name: '×¨×§×¢×™× ×•×ª××•× ×•×ª', desc: '×¡×¤×¨×™×™×” ××§×¦×•×¢×™×ª', action: () => setActivePanel('design') }
    ]
  };

  const DeviceSelector = () => (
    <div className="flex bg-gray-100 rounded-lg p-1">
      {[
        { id: 'desktop', icon: Monitor },
        { id: 'tablet', icon: Tablet },
        { id: 'mobile', icon: Smartphone }
      ].map(d => (
        <button
          key={d.id}
          onClick={() => setDevice(d.id)}
          className={`flex items-center gap-2 px-3 py-2 rounded-md transition-all ${
            device === d.id ? 'bg-white shadow-sm text-blue-600' : 'text-gray-600 hover:bg-gray-50'
          }`}
        >
          <d.icon size={16} />
          <span className="hidden sm:inline capitalize">{d.id}</span>
        </button>
      ))}
    </div>
  );

  const EditableText = ({ path, className, style, placeholder, multiline = false }) => {
    const value = path.split('.').reduce((obj, key) => obj?.[key], siteData) || placeholder;
    const isCurrentlyEditing = isEditing === path;

    if (isCurrentlyEditing) {
      return multiline ? (
        <textarea
          value={value}
          onChange={(e) => handleTextChange(path, e.target.value)}
          onBlur={stopEditing}
          className={`${className} border-2 border-blue-400 bg-white resize-none`}
          style={{ ...style, minHeight: '60px' }}
          autoFocus
          rows={3}
        />
      ) : (
        <input
          value={value}
          onChange={(e) => handleTextChange(path, e.target.value)}
          onBlur={stopEditing}
          className={`${className} border-2 border-blue-400 bg-white`}
          style={style}
          autoFocus
        />
      );
    }

    return (
      <div
        className={`${className} cursor-pointer hover:bg-blue-50 hover:outline hover:outline-2 hover:outline-blue-300 transition-all rounded-sm`}
        style={style}
        onClick={() => startEditing(path)}
        title="×œ×—×¥ ×œ×¢×¨×™×›×”"
      >
        {value}
      </div>
    );
  };

  const PreviewFrame = () => {
    const site = siteData;
    if (!site || !site.content) return <div>×˜×•×¢×Ÿ...</div>;

    return (
      <div 
        className={`
          bg-white rounded-lg shadow-lg transition-all duration-300 mx-auto overflow-auto
          ${device === 'desktop' ? 'w-full h-full' : ''}
          ${device === 'tablet' ? 'w-[768px] h-[600px]' : ''}
          ${device === 'mobile' ? 'w-[375px] h-[600px]' : ''}
        `}
        style={{ minHeight: '500px' }}
      >
        <div className="h-full overflow-y-auto">
          {/* Hero Section */}
          <div 
            className="relative p-8 text-white min-h-[400px] flex flex-col justify-center"
            style={{ 
              background: `linear-gradient(135deg, ${site.color}dd, ${site.color}aa)`
            }}
          >
            <div className="max-w-4xl mx-auto text-center">
              <EditableText
                path="content.hero.title"
                className="text-5xl font-bold mb-4 text-white"
                style={{ fontFamily: selectedFont, textShadow: '2px 2px 4px rgba(0,0,0,0.5)' }}
                placeholder="×›×•×ª×¨×ª ×¨××©×™×ª"
              />
              <EditableText
                path="content.hero.subtitle"
                className="text-2xl mb-6 text-white"
                style={{ fontFamily: selectedFont, textShadow: '1px 1px 2px rgba(0,0,0,0.5)' }}
                placeholder="×ª×ª ×›×•×ª×¨×ª"
              />
              <EditableText
                path="content.hero.description"
                className="text-lg mb-8 max-w-2xl mx-auto text-white"
                style={{ fontFamily: selectedFont, textShadow: '1px 1px 2px rgba(0,0,0,0.5)' }}
                placeholder="×ª×™××•×¨ ×§×¦×¨"
                multiline={true}
              />
              <EditableText
                path="content.hero.cta"
                className="inline-block px-8 py-4 bg-white text-black font-bold rounded-full text-xl hover:scale-105 transition-transform shadow-lg"
                style={{ fontFamily: selectedFont, color: site.color }}
                placeholder="×§×¨×™××” ×œ×¤×¢×•×œ×”"
              />
            </div>
          </div>

          {/* Services Section */}
          <div className="py-16 px-8">
            <div className="max-w-6xl mx-auto">
              <h3 className="text-3xl font-bold text-center mb-12" style={{ color: site.color, fontFamily: selectedFont }}>
                ×”×©×™×¨×•×ª×™× ×©×œ× ×•
              </h3>
              <div className="grid grid-cols-1 md:grid-cols-3 gap-8">
                {site.content.services?.map((service, i) => (
                  <div key={i} className="bg-white p-6 rounded-lg shadow-md hover:shadow-lg transition-shadow">
                    <div 
                      className="w-16 h-16 rounded-full mb-4 mx-auto flex items-center justify-center text-2xl"
                      style={{ backgroundColor: `${site.color}22` }}
                    >
                      {service.icon || 'â­'}
                    </div>
                    <EditableText
                      path={`content.services.${i}.title`}
                      className="font-bold text-center mb-2"
                      style={{ fontFamily: selectedFont }}
                      placeholder={`×©×™×¨×•×ª ${i + 1}`}
                    />
                    <EditableText
                      path={`content.services.${i}.desc`}
                      className="text-gray-600 text-center text-sm mb-3"
                      style={{ fontFamily: selectedFont }}
                      placeholder="×ª×™××•×¨ ×”×©×™×¨×•×ª"
                      multiline={true}
                    />
                    {service.price && (
                      <div className="text-center">
                        <span className="text-lg font-bold" style={{ color: site.color }}>
                          {service.price}
                        </span>
                      </div>
                    )}
                  </div>
                ))}
              </div>
            </div>
          </div>

          {/* Contact Section */}
          <div className="py-16 px-8 bg-gray-100">
            <div className="max-w-4xl mx-auto text-center">
              <h3 className="text-3xl font-bold mb-8" style={{ color: site.color, fontFamily: selectedFont }}>
                ×¦×•×¨ ×§×©×¨
              </h3>
              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                {site.content.contact && (
                  <>
                    <div className="bg-white p-6 rounded-lg shadow-md">
                      <div className="text-2xl mb-3">ğŸ“</div>
                      <h4 className="font-bold mb-2">×˜×œ×¤×•×Ÿ</h4>
                      <p className="text-gray-600">{site.content.contact.phone}</p>
                    </div>
                    <div className="bg-white p-6 rounded-lg shadow-md">
                      <div className="text-2xl mb-3">ğŸ“§</div>
                      <h4 className="font-bold mb-2">××™××™×™×œ</h4>
                      <p className="text-gray-600">{site.content.contact.email}</p>
                    </div>
                    <div className="bg-white p-6 rounded-lg shadow-md">
                      <div className="text-2xl mb-3">ğŸ“</div>
                      <h4 className="font-bold mb-2">×›×ª×•×‘×ª</h4>
                      <p className="text-gray-600">{site.content.contact.address}</p>
                    </div>
                    <div className="bg-white p-6 rounded-lg shadow-md">
                      <div className="text-2xl mb-3">ğŸ•’</div>
                      <h4 className="font-bold mb-2">×©×¢×•×ª ×¤×¢×™×œ×•×ª</h4>
                      <p className="text-gray-600">{site.content.contact.hours}</p>
                    </div>
                  </>
                )}
              </div>
              
              {/* WhatsApp Button */}
              {site.content.contact?.whatsapp && (
                <div className="mt-12">
                  <button 
                    className="bg-green-500 hover:bg-green-600 text-white px-8 py-4 rounded-full text-lg font-bold transition-colors shadow-lg"
                    onClick={() => window.open(`https://wa.me/972${site.content.contact.whatsapp.replace(/[^0-9]/g, '')}`, '_blank')}
                  >
                    ğŸ’¬ ×©×œ×— ×”×•×“×¢×” ×‘×•×•×˜×¡××¤
                  </button>
                </div>
              )}
            </div>
          </div>

          {/* Footer */}
          <footer className="bg-gray-800 text-white py-8 px-8">
            <div className="max-w-4xl mx-auto text-center">
              <h4 className="text-xl font-bold mb-4" style={{ fontFamily: selectedFont }}>
                {site.content.hero?.title || site.name}
              </h4>
              <p className="text-gray-300 mb-4" style={{ fontFamily: selectedFont }}>
                {site.content.hero?.subtitle || '×©×™×¨×•×ª ××§×¦×•×¢×™ ×•×××™×Ÿ'}
              </p>
              <div className="text-sm text-gray-400">
                Â© 2025 ×›×œ ×”×–×›×•×™×•×ª ×©××•×¨×•×ª | ×¢×•×¦×‘ ×•× ×‘× ×” ×¢× â¤ï¸ ×¢×œ ×™×“×™ WebMaster Pro
              </div>
            </div>
          </footer>
        </div>
      </div>
    );
  };

  return (
    <div className="min-h-screen bg-gray-50" dir="rtl">
      {/* Top Toolbar */}
      <div className="bg-white border-b border-gray-200 px-6 py-4">
        <div className="flex items-center justify-between">
          <div className="flex items-center gap-4">
            <div className="flex items-center gap-2">
              <Wand2 className="text-purple-600" size={24} />
              <span className="font-bold text-xl">WebMaster Pro</span>
              <span className="text-sm bg-purple-100 text-purple-600 px-2 py-1 rounded-full">
                {Object.keys(demoSites).length} ××ª×¨×™×
              </span>
            </div>
            
            <select 
              value={currentSite}
              onChange={(e) => setCurrentSite(e.target.value)}
              className="px-3 py-2 border border-gray-300 rounded-lg bg-white min-w-[250px]"
            >
              {Object.entries(demoSites).map(([key, site]) => (
                <option key={key} value={key}>
                  {site.name} â€¢ {site.price}
                </option>
              ))}
            </select>
          </div>

          <div className="flex items-center gap-4">
            <DeviceSelector />
            
            <button
              onClick={() => setAiMode(!aiMode)}
              className={`flex items-center gap-2 px-4 py-2 rounded-lg transition-all ${
                aiMode ? 'bg-gradient-to-r from-purple-600 to-pink-600 text-white shadow-lg' : 'bg-gray-100 text-gray-700'
              }`}
            >
              <Brain size={16} />
              AI ×¢×•×–×¨
            </button>

            <button 
              className="flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors"
              onClick={() => setLastSaved(new Date())}
            >
              <Save size={16} />
              ×©××•×¨
            </button>
          </div>
        </div>
      </div>

      <div className="flex h-[calc(100vh-73px)]">
        {/* Left Panel - Basic Tools */}
        <div className="w-80 bg-white border-l border-gray-200 overflow-y-auto">
          <div className="p-4">
            <h3 className="font-bold text-lg mb-4 flex items-center gap-2">
              <Settings size={20} />
              ×›×œ×™× ×‘×¡×™×¡×™×™×
            </h3>
            
            <div className="space-y-4">
              <div className="flex bg-gray-100 rounded-lg p-1">
                {Object.keys(basicTools).map(tool => (
                  <button
                    key={tool}
                    onClick={() => setActivePanel(tool)}
                    className={`flex-1 py-2 px-2 rounded-md transition-all text-sm ${
                      activePanel === tool ? 'bg-white shadow-sm text-blue-600' : 'text-gray-600'
                    }`}
                  >
                    {tool === 'sites' && '××ª×¨×™×'}
                    {tool === 'text' && '×˜×§×¡×˜'}
                    {tool === 'design' && '×¢×™×¦×•×‘'}
                  </button>
                ))}
              </div>

              {/* Font Selection */}
              {activePanel === 'text' && (
                <div className="space-y-4">
                  <div>
                    <h4 className="font-medium mb-2">×‘×—×™×¨×ª ×¤×•× ×˜</h4>
                    <select 
                      value={selectedFont}
                      onChange={(e) => setSelectedFont(e.target.value)}
                      className="w-full p-2 border border-gray-300 rounded-lg"
                    >
                      {availableFonts.map(font => (
                        <option key={font.name} value={font.value}>
                          {font.name} - {font.type}
                        </option>
                      ))}
                    </select>
                  </div>
                  <div>
                    <h4 className="font-medium mb-2">×¦×‘×¢ ×˜×§×¡×˜</h4>
                    <input
                      type="color"
                      value={selectedColor}
                      onChange={(e) => setSelectedColor(e.target.value)}
                      className="w-full h-10 border border-gray-300 rounded-lg"
                    />
                  </div>
                </div>
              )}

              {/* Color Palette */}
              {activePanel === 'design' && (
                <div className="space-y-4">
                  <div>
                    <h4 className="font-medium mb-2">×¤×œ×˜×ª ×¦×‘×¢×™×</h4>
                    <div className="grid grid-cols-5 gap-2">
                      {colorPalettes[siteData.palette || 'business']?.map((color, idx) => (
                        <div
                          key={idx}
                          className="w-10 h-10 rounded-lg cursor-pointer border-2 border-gray-200 hover:border-gray-400 transition-colors"
                          style={{ backgroundColor: color }}
                          onClick={() => setSelectedColor(color)}
                          title={color}
                        />
                      ))}
                    </div>
                  </div>
                </div>
              )}

              {/* Sites Overview */}
              {activePanel === 'sites' && (
                <div className="space-y-4">
                  <div className="bg-blue-50 p-4 rounded-lg">
                    <h4 className="font-bold mb-2">ğŸ“Š ×¡×˜×˜×™×¡×˜×™×§×•×ª</h4>
                    <div className="grid grid-cols-2 gap-2 text-sm">
                      <div>××ª×¨×™×: {Object.keys(demoSites).length}</div>
                      <div>×§×˜×’×•×¨×™×•×ª: 3</div>
                    </div>
                  </div>
                  <div>
                    <h4 className="font-medium mb-2">×¨×©×™××ª ××ª×¨×™×</h4>
                    {Object.entries(demoSites).map(([key, site]) => (
                      <div
                        key={key}
                        className={`p-2 mb-2 rounded-lg cursor-pointer transition-colors ${
                          currentSite === key ? 'bg-blue-100 border border-blue-300' : 'bg-gray-50 hover:bg-gray-100'
                        }`}
                        onClick={() => setCurrentSite(key)}
                      >
                        <div className="font-medium text-sm">{site.name}</div>
                        <div className="text-xs text-gray-500">{site.category} â€¢ {site.price}</div>
                      </div>
                    ))}
                  </div>
                </div>
              )}
            </div>
          </div>
        </div>

        {/* Main Workspace */}
        <div className="flex-1 flex flex-col">
          <div className="flex-1 p-6 overflow-auto">
            <div className="h-full flex items-center justify-center">
              <PreviewFrame />
            </div>
          </div>

          {/* Bottom Status Bar */}
          <div className="bg-white border-t border-gray-200 px-6 py-3">
            <div className="flex items-center justify-between text-sm text-gray-600">
              <div>
                {isEditing ? (
                  <span className="text-blue-600 font-medium">ğŸ–Šï¸ ×¢×•×¨×š: {isEditing}</span>
                ) : (
                  <span>ğŸ’¡ ×œ×—×¥ ×¢×œ ×˜×§×¡×˜ ×›×œ×©×”×• ×›×“×™ ×œ×¢×¨×•×š ××•×ª×•</span>
                )}
              </div>
              <div className="flex items-center gap-4">
                {lastSaved ? (
                  <>
                    <div className="w-2 h-2 bg-green-400 rounded-full"></div>
                    <span>× ×©××¨: {lastSaved.toLocaleTimeString('he-IL', { hour: '2-digit', minute: '2-digit' })}</span>
                  </>
                ) : (
                  <span>××“×™×˜×•×¨ ×¤×¢×™×œ</span>
                )}
              </div>
            </div>
          </div>
        </div>

        {/* Right Panel - AI Assistant */}
        {aiMode && (
          <div className="w-80 bg-gradient-to-b from-purple-50 to-pink-50 border-r border-purple-200 flex flex-col">
            <div className="p-4 border-b border-purple-200">
              <h3 className="font-bold text-lg mb-2 flex items-center gap-2 text-purple-800">
                <Brain size={20} />
                AI ×¢×•×–×¨ ××ª×§×“×
              </h3>
              <p className="text-sm text-purple-600">
                ×©××œ ××•×ª×™ ×›×œ ×©××œ×” ×¢×œ ×¢×™×¦×•×‘, ×ª×•×›×Ÿ ××• ×§×•×“
              </p>
            </div>

            {/* Quick Actions */}
            <div className="p-4 border-b border-purple-200">
              <h4 className="font-medium mb-3 text-purple-800">×¤×¢×•×œ×•×ª ××”×™×¨×•×ª</h4>
              <div className="space-y-2">
                {quickAIActions.map((action, index) => (
                  <button
                    key={index}
                    onClick={() => executeQuickAction(action)}
                    className="w-full text-right p-3 bg-white rounded-lg hover:bg-purple-50 transition-colors border border-purple-100"
                  >
                    <div className="flex items-center gap-2">
                      <span className="text-lg">{action.icon}</span>
                      <span className="text-sm">{action.text}</span>
                    </div>
                  </button>
                ))}
              </div>
            </div>

            {/* Chat Area */}
            <div className="flex-1 flex flex-col">
              <div className="flex-1 p-4 overflow-y-auto space-y-3">
                {aiChat.length === 0 && (
                  <div className="text-center text-gray-500 mt-8">
                    <Sparkles size={32} className="mx-auto mb-3 text-purple-400" />
                    <p className="font-medium mb-2">×©×œ×•×! ×× ×™ ×¢×•×–×¨ ×”-AI ğŸ¤–</p>
                    <p className="text-sm">×¢×•×‘×“ ×¢×œ <strong>{siteData.name}</strong></p>
                  </div>
                )}
                
                {aiChat.map((message, index) => (
                  <div
                    key={index}
                    className={`p-3 rounded-lg ${
                      message.type === 'user'
                        ? 'bg-blue-100 text-blue-800 mr-4'
                        : 'bg-white text-gray-800 ml-4 border border-purple-100'
                    }`}
                  >
                    {message.content}
                  </div>
                ))}
                
                {isAiProcessing && (
                  <div className="bg-white p-3 rounded-lg ml-4 border border-purple-100">
                    <div className="flex items-center gap-2">
                      <div className="animate-spin w-4 h-4 border-2 border-purple-600 border-t-transparent rounded-full"></div>
                      <span>AI ×—×•×©×‘...</span>
                    </div>
                  </div>
                )}
              </div>

              {/* Input Area */}
              <div className="p-4 border-t border-purple-200">
                <div className="flex gap-2">
                  <textarea
                    value={aiInput}
                    onChange={(e) => setAiInput(e.target.value)}
                    placeholder="×©××œ ××•×ª×™ ×›×œ ×©××œ×”..."
                    className="flex-1 p-3 border border-purple-200 rounded-lg resize-none focus:border-purple-400 focus:ring-2 focus:ring-purple-200 focus:outline-none"
                    rows={2}
                    onKeyDown={(e) => {
                      if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        sendToAI();
                      }
                    }}
                  />
                  <button
                    onClick={sendToAI}
                    disabled={isAiProcessing || !aiInput.trim()}
                    className="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                  >
                    <MessageSquare size={16} />
                  </button>
                </div>
              </div>
            </div>
          </div>
        )}
      </div>
    </div>
  );
};

export default WebMasterProEditor;
